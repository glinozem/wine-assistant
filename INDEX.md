# Wine Assistant — INDEX

Актуальная навигация по документации и ключевым точкам проекта.
Обновлено: 2025-12-17.

## Документы

- **README.md** — обзор проекта, архитектура, запуск (Docker Compose), основные эндпойнты API и примеры запросов.
- **QUICK_REFERENCE.md** — «шпаргалка» по самым частым командам и сценариям: запуск/проверка, быстрый smoke-check, типовые запросы к API, диагностика.
- **CHANGELOG.md** — история изменений по релизам/итерациям.
- **project-structure.txt** — структура репозитория (файлы/папки как в рабочей директории и tracked в Git).

## Что изменилось в проекте (важное для разработчика)

### UI «витрина» (`/ui`)
- UI обслуживается самим API как статическая страница: `GET /ui`.
- Реализована корректная постраничная догрузка: UI больше не «застревает» на первых 30 позициях — список подгружается дальше по мере прокрутки.
- По умолчанию включён фильтр **«Только в наличии»** (`in_stock=true`).
- Для изображений SKU используется эндпойнт вида: `/sku/{code}/image` (с фоллбеком на заглушку).
- Для карточки SKU подгружаются детали и (опционально) графики `price-history` и `inventory-history` (Chart.js через CDN; при недоступности CDN UI показывает подсказку вместо графиков).

### Очистка тестовых данных (PostgreSQL)
- Добавлен/уточнён скрипт **`scripts/cleanup_test_data.py`**:
  - Поддерживает работу в режиме **dry-run** (по умолчанию) и **apply** (`--apply`).
  - Читает параметры подключения из `.env` (и/или `PG*`, `DB_*` переменных окружения).
  - Умеет удалять тестовые записи по **prefix** (`--prefix`) и/или по точным **pattern** (`--pattern`).
  - Учитывает FK-зависимости (сначала дочерние таблицы, затем `products`).
- Практика использования:
  - Сначала запуск без `--apply` (смотрим «Planned deletions»),
  - затем запуск с `--apply`.

## Быстрые ссылки внутри репозитория

- UI: `api/templates/ui.html`
- Скрипты: `scripts/`
  - `cleanup_test_data.py` — очистка тестовых данных
  - `quick_smoke_check.ps1` — быстрые проверки окружения/интеграции
  - `sync_inventory_history.py` — утилиты синхронизации/экспорта истории остатков (если используется в вашем workflow)
- БД и миграции: `db/` и `db/migrations/`
- Observability (если подключено вторым compose-файлом): `observability/`
- CI/CD: `.github/workflows/`

## Рекомендованный рабочий процесс

1. Запуск инфраструктуры (БД/сервисы) через Docker Compose.
2. Проверка `/health` и базового поиска `/api/v1/products/search`.
3. Проверка UI (`/ui`), что:
   - грузится список,
   - догружаются страницы при прокрутке,
   - карточка SKU открывается,
   - изображения и графики ведут себя корректно.
4. Перед «чисткой» тестовых данных — запуск `cleanup_test_data.py` в dry-run, затем `--apply`.

---

Если вы добавляете новые документы — обновляйте этот INDEX, чтобы он оставался «точкой входа» в документацию.
