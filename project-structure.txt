wine-assistant/

# Назначение
# project-structure.txt — “ручной” справочник по структуре репозитория и роли каталогов/файлов.
# project-structure-auto.txt — автоматически сгенерированный снимок файловой структуры (tree /F /A).

# Легенда
# [PUBLIC]   — то, на что опираются пользователи репозитория: запуск, API, официальная документация, контракты.
# [INTERNAL] — внутренняя реализация, эксплуатационные скрипты, миграции, тестовые утилиты.
# [OPTIONAL] — компоненты, которые можно не поднимать для минимального демо (например, observability).

wine-assistant/
├── api/                                        # Flask-приложение и HTTP-эндпоинты [PUBLIC]
│   ├── app.py                                  # Роутинг /ui и /api/v1/* [PUBLIC]
│   ├── export.py                               # Экспорт XLSX/PDF (поиск, SKU, истории) [PUBLIC]
│   ├── schemas.py                              # Контракты запросов/ответов [PUBLIC]
│   ├── validation.py                           # Бизнес-валидация [INTERNAL]
│   ├── request_middleware.py                   # Middleware: логирование/лимиты/ошибки [INTERNAL]
│   ├── logging_config.py                       # Настройки логирования API [INTERNAL]
│   ├── wsgi.py                                 # WSGI-entrypoint (gunicorn) [PUBLIC]
│   └── templates/
│       └── ui.html                             # Витрина UI (один HTML без SPA) [PUBLIC]
│
├── data/                                       # Данные для разработки/импорта [INTERNAL]
│   └── sample/
│       └── dw_sample_products.csv              # Пример входных данных для dev/CI [PUBLIC]
│   # Примечание: каталоги data/inbox и data/archive используются в практике импорта,
│   # но могут быть локальными (не обязаны быть закоммичены).
│
├── db/                                         # База данных и миграции [PUBLIC/INTERNAL]
│   ├── init.sql                                # Инициализация схемы “с нуля” [INTERNAL]
│   ├── migrate.sh                              # Раннер SQL-миграций (используется migrator в compose) [PUBLIC]
│   ├── migrate.ps1                             # PowerShell-обёртка (Windows) [INTERNAL]
│   └── migrations/                             # SQL-миграции (эволюция схемы) [INTERNAL]
│       ├── 0000_schema_migrations.sql
│       ├── 0001_prices-and-search.sql
│       ├── 0002_price-history-guardrails.sql
│       ├── 0003_inventory-columns-and-asof.sql
│       ├── 0004_diagnostics.sql
│       ├── 0005_price-check.sql
│       ├── 0006_add-idempotency-tables.sql
│       ├── 0007_schema-migrations-view.sql
│       ├── 0008_schema-migrations-view.sql
│       ├── 0009_schema-migrations-view-fix.sql
│       ├── 0010_price-list-quarantine.sql
│       ├── 0011_product_prices_partitioning.sql
│       ├── 0011_products_extra_fields.sql
│       ├── 0012_wineries.sql
│       ├── 2025-10-14-diagnostics.sql
│       ├── 2025-10-14-price-check.sql
│       ├── 2025-10-14-price-history-guardrails.sql
│       └── 2025-10-14-prices-and-search.sql
│
├── etl/                                        # ETL-утилиты прайса [INTERNAL]
│   ├── mapping_template.json                   # Маппинг колонок поставщика → внутренние поля [PUBLIC]
│   ├── run_daily.py                            # Ежедневный прогон ETL (entrypoint) [INTERNAL]
│   └── utils.py                                # Общие ETL-помощники [INTERNAL]
│
├── jobs/                                       # Фоновые джобы обслуживания/данных [INTERNAL]
│   ├── ingest_dw_price.py                      # Загрузка прайса в DWH/целевую БД [INTERNAL]
│   └── cleanup_old_partitions.py               # Очистка старых партиций цен [INTERNAL]
│
├── scripts/                                    # CLI и операционные скрипты [INTERNAL]
│   ├── load_csv.py                             # Импорт Excel/CSV (основной CLI) [INTERNAL]
│   ├── load_utils.py                           # Утилиты импорта (DB, upsert, нормализация) [INTERNAL]
│   ├── data_quality.py                         # Гейты качества/карантин [INTERNAL]
│   ├── idempotency.py                          # Идемпотентность импорта [INTERNAL]
│   ├── date_extraction.py                      # Извлечение дат/ASOF [INTERNAL]
│   ├── sync_inventory_history.py               # Синхронизация истории остатков [INTERNAL]
│   ├── load_wineries.py                        # Загрузка справочника wineries [INTERNAL]
│   ├── load_wineries_enrichment.py             # Обогащение wineries [INTERNAL]
│   ├── normalize_wineries_suppliers.py         # Нормализация wineries/suppliers [INTERNAL]
│   ├── check_wineries_vs_products.py           # Сверки wineries vs products [INTERNAL]
│   ├── extract_wineries_from_pdf.py            # Извлечение wineries из PDF [INTERNAL]
│   ├── enrich_producers.py                     # Обогащение данных по производителям [INTERNAL]
│   ├── migrate.ps1                             # Удобный запуск миграций (Windows) [INTERNAL]
│   ├── quick_smoke_check.ps1                   # Быстрый smoke-check (Windows) [INTERNAL]
│   ├── manual_smoke_check.ps1                  # Расширенный smoke-check (Windows) [INTERNAL]
│   ├── run_integration_tests.ps1               # Запуск интеграционных тестов (Windows) [INTERNAL]
│   └── setup_scheduler.ps1                     # Планировщик задач (Windows) [INTERNAL]
│
├── docs/                                       # Документация [PUBLIC]
│   ├── requirements.md                         # Требования [PUBLIC]
│   ├── manual-smoke-check.md                   # Канонический manual smoke-check [PUBLIC]
│   ├── ROADMAP_v3_RU.md                        # Актуальная дорожная карта [PUBLIC]
│   ├── README_UPDATE_SUMMARY.md                # Сводка изменений README/доков [PUBLIC]
│   ├── pr-93-summary.md                        # Конспект по PR #93 [INTERNAL]
│   ├── roadmap_sprint7+.md                     # Ранние roadmap-версии [INTERNAL]
│   ├── roadmap_sprint7+_v2.md                  # Ранние roadmap-версии [INTERNAL]
│   ├── BEFORE_AFTER_COMPARISON.md              # Сравнения/история изменений [INTERNAL]
│   └── dev/                                    # Снапшоты и заметки разработки [INTERNAL]
│       ├── dev-setup-windows.md
│       ├── cheatsheet-from-clean-clone-to-green-tests.md
│       ├── export-web-ui.md
│       ├── issue-83-84-notes.md
│       ├── issue-85-partitioning-notes.md
│       ├── issue-91-summary.md
│       ├── README-before*.md
│       ├── README.auto_images*.md
│       ├── README.*dd*.md
│       ├── PR_body_*.md
│       └── logging-events*.md
│
├── observability/                              # Loki/Promtail/Grafana (опционально) [OPTIONAL]
│   ├── README.md
│   ├── loki-config.yml
│   ├── promtail-config.yml
│   └── grafana/
│       ├── dashboards/
│       │   └── wine-assistant-api.json
│       └── provisioning/
│           ├── datasources/datasources.yml
│           └── dashboards/dashboards.yml
│
├── tests/                                      # Автотесты [INTERNAL]
│   ├── README.md
│   ├── conftest.py
│   ├── cors-test.html
│   ├── fixtures/
│   │   ├── schema.sql
│   │   └── schema_prices.sql
│   ├── unit/
│   ├── integration/
│   └── e2e/                                    # Заготовка пакета [OPTIONAL]
│
├── .github/                                    # GitHub Actions / релизы [INTERNAL]
│   ├── changelog-config.json
│   ├── release-drafter.yml
│   └── workflows/
│       ├── changelog-on-release.yml
│       ├── ci.yml
│       ├── release-drafter.yml
│       ├── secrets.yml
│       └── semgrep.yml
│
├── .hooks/
│   └── block_keys.py                           # Локальная защита от утечек секретов [INTERNAL]
│
├── .coveragerc                                 # Coverage config [INTERNAL]
├── .dockerignore                               # Docker build context ignores [INTERNAL]
├── .env.example                                # Пример переменных окружения (без секретов) [PUBLIC]
├── .gitattributes                              # Git attributes [INTERNAL]
├── .gitignore                                  # Git ignore rules [INTERNAL]
├── .gitleaks.toml                              # Gitleaks config [INTERNAL]
├── .pre-commit-config.yaml                     # Pre-commit hooks [INTERNAL]
│
├── Dockerfile                                  # Образ API [PUBLIC]
├── docker-compose.yml                          # Локальный стенд (db + migrator + api + adminer) [PUBLIC]
├── docker-compose.observability.yml            # Стенд observability (Grafana/Loki/Promtail) [PUBLIC][OPTIONAL]
├── Makefile                                    # Команды разработки/CI [PUBLIC]
├── pyproject.toml                              # Конфиг проекта (инструменты/настройки) [PUBLIC]
├── pytest.ini                                  # Настройки pytest [INTERNAL]
├── requirements.txt                            # Python зависимости [PUBLIC]
│
├── README.md                                   # Главный README [PUBLIC]
├── CHANGELOG.md                                # История изменений [PUBLIC]
├── INDEX.md                                    # Навигация по проекту/докам [PUBLIC]
├── QUICK_REFERENCE.md                          # Шпаргалка команд/сценариев [PUBLIC]
├── PROTECTION_CHECK.txt                        # Служебный маркер/проверка [INTERNAL]
├── project-structure.txt                       # Этот файл [PUBLIC]
└── project-structure-auto.txt                  # Автоснимок структуры (генерируется) [INTERNAL]
