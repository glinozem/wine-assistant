wine-assistant/

# Легенда:
# [PUBLIC API]    — то, на что опираются внешние пользователи/интеграции (HTTP API, официальная дока, dev-entrypoints).
# [INTERNAL]      — внутренняя реализация, инфраструктура, тесты, служебные скрипты.
# [EXPERIMENTAL]  — экспериментальные части, структура и контракты могут меняться.

├── api/                              # Flask-приложение и HTTP-эндпоинты [PUBLIC API]
│   ├── app.py                        # Точка входа Flask-приложения, регистрация роутов [PUBLIC API]
│   ├── export.py                     # Эндпоинты экспорта: поисковый XLSX/PDF, SKU-карточки и т.п. [PUBLIC API]
│   ├── logging_config.py             # Конфигурация логирования для API [INTERNAL]
│   ├── request_middleware.py         # Общая обработка запросов/ответов (middleware) [INTERNAL]
│   ├── schemas.py                    # Схемы запросов/ответов (REST-контракты) [PUBLIC API]
│   ├── validation.py                 # Бизнес-валидация входящих данных [INTERNAL]
│   └── wsgi.py                       # WSGI-обёртка для деплоя (gunicorn/uwsgi и т.п.) [PUBLIC API]

├── data/                             # Рабочие данные прайса поставщика [INTERNAL]
│   ├── inbox/                        # Входящие Excel-файлы прайсов (ручная выкладка) [INTERNAL]
│   ├── archive/                      # Архив обработанных файлов/прайсов [INTERNAL]
│   └── sample/
│       └── dw_sample_products.csv    # Пример входных данных для разработки и тестов [INTERNAL]

├── db/                               # Схема БД и миграции [INTERNAL]
│   ├── init.sql                      # Инициализация схемы БД “с нуля” [INTERNAL]
│   ├── migrate.ps1                   # PowerShell-обёртка вокруг миграций [INTERNAL]
│   ├── migrate.sh                    # Bash-обёртка вокруг миграций [INTERNAL]
│   └── migrations/                   # SQL-миграции для эволюции схемы [INTERNAL]
│       ├── 0000_schema_migrations.sql
│       ├── 0001_prices-and-search.sql
│       ├── 0002_price-history-guardrails.sql
│       ├── 0003_inventory-columns-and-asof.sql
│       ├── 0004_diagnostics.sql
│       ├── 0005_price-check.sql
│       ├── 0006_add-idempotency-tables.sql
│       ├── 0007_schema-migrations-view.sql
│       ├── 0008_schema-migrations-view.sql
│       ├── 0009_schema-migrations-view-fix.sql
│       ├── 0010_price-list-quarantine.sql           # Карантин “грязных” строк прайса [INTERNAL]
│       ├── 0011_product_prices_partitioning.sql     # Партиционирование product_prices [INTERNAL]
│       ├── 2025-10-14-*.sql                         # Зафиксированные миграции старого формата [INTERNAL]
│       └── ...                                      # Новые миграции по мере развития схемы

├── docs/                             # Проектная документация [PUBLIC API]
│   ├── dev/                          # История README и тех. заметки по разработке [INTERNAL]
│   │   ├── cheatsheet-from-clean-clone-to-green-tests.md
│   │   ├── dev-setup-windows.md
│   │   ├── issue-83-84-notes.md
│   │   ├── issue-85-partitioning-notes.md
│   │   ├── issue-91-summary.md
│   │   ├── README-before*.md         # Снапшоты README во времени
│   │   └── ...                       # Прочие рабочие заметки
│   ├── dev-checklist.ps1             # Скрипт/чеклист для ежедневной dev-рутины [INTERNAL]
│   ├── pr-93-summary.md              # Конспект по PR #93 (для истории) [INTERNAL]
│   ├── requirements.md               # Функциональные/тех. требования к системе [PUBLIC API]
│   ├── roadmap_sprint7+.md           # Ранняя дорожная карта [INTERNAL][EXPERIMENTAL]
│   ├── roadmap_sprint7+_v2.md        # Обновлённая карта [INTERNAL][EXPERIMENTAL]
│   └── ROADMAP_v3_RU.md              # Актуальная дорожная карта (основной источник) [PUBLIC API]

├── etl/                              # Локальные ETL-утилиты для прайса [INTERNAL]
│   ├── mapping_template.json         # Шаблон маппинга колонок поставщика → внутренний формат [PUBLIC API]
│   ├── run_daily.py                  # Скрипт ежедневного прогона ETL (entrypoint под планировщик) [INTERNAL]
│   ├── utils.py                      # Общие помощники ETL (чтение файлов, SHA и т.п.) [INTERNAL]
│   └── image_extractor.py            # Извлечение картинок из Excel и сохранение в static/images [INTERNAL]

├── jobs/                             # Фоновые джобы для DWH/обслуживания [INTERNAL][EXPERIMENTAL]
│   ├── ingest_dw_price.py            # Загрузка прайса в DWH/целевую БД [INTERNAL][EXPERIMENTAL]
│   └── cleanup_old_partitions.py     # Очистка устаревших партиций цен [INTERNAL][EXPERIMENTAL]

├── scripts/                          # Вспомогательные скрипты для разработчиков/ops [INTERNAL]
│   ├── data_quality.py               # Проверки качества данных (качественные гейты) [INTERNAL]
│   ├── date_extraction.py            # Извлечение дат из текстов/имен файлов [INTERNAL]
│   ├── idempotency.py                # Помощники по идемпотентности операций [INTERNAL]
│   ├── load_csv.py                   # CLI для загрузки Excel/CSV, включая авто-импорт фото [INTERNAL]
│   ├── load_utils.py                 # Общие утилиты для сценариев загрузки [INTERNAL]
│   ├── migrate.ps1                   # Удобный запуск миграций под Windows [INTERNAL]
│   ├── run_integration_tests.ps1     # Скрипт запуска интеграционных тестов [INTERNAL]
│   └── setup_scheduler.ps1           # Настройка планировщика задач (Windows) [INTERNAL]

├── tests/                            # Автотесты (API, ETL, утилиты) [INTERNAL]
│   ├── README.md                     # Пояснения к структуре и уровням тестирования [INTERNAL]
│   ├── __init__.py
│   ├── conftest.py                   # Общие фикстуры (приложение, БД, данные) [INTERNAL]
│   ├── cors-test.html                # Ручная проверка CORS из браузера [INTERNAL]
│   ├── fixtures/                     # SQL-фикстуры для тестовых БД [INTERNAL]
│   │   ├── schema.sql
│   │   └── schema_prices.sql
│   ├── e2e/                          # E2E-слой (заготовка пакета) [INTERNAL][EXPERIMENTAL]
│   │   └── __init__.py
│   ├── integration/                  # Интеграционные тесты (API + БД + ETL) [INTERNAL]
│   │   ├── __init__.py
│   │   ├── api_test_utils.py         # Общие утилиты для интеграционных API-тестов [INTERNAL]
│   │   ├── conftest.py               # Специфичные фикстуры для интеграции [INTERNAL]
│   │   ├── test_api_products_search_happy.py
│   │   ├── test_api_export_search.py                 # Экспорт списка товаров [INTERNAL]
│   │   ├── test_api_export_sku_and_price_history.py  # Экспорт карточек SKU и истории цен [INTERNAL]
│   │   └── test_price_import_etl.py                  # E2E: импорт прайса и проверка истории цен [INTERNAL]
│   ├── unit/                         # Юнит-тесты бизнес-логики и утилит [INTERNAL]
│   │   ├── __init__.py
│   │   ├── test_data_quality.py
│   │   ├── test_date_extraction.py
│   │   ├── test_health.py
│   │   ├── test_idempotency.py
│   │   ├── test_load_csv.py
│   │   ├── test_load_utils.py
│   │   ├── test_schemas.py
│   │   └── test_validation.py
│   ├── test_api_health.py
│   ├── test_api_limits_and_security.py
│   ├── test_api_products_happy.py
│   ├── test_api_products_validation.py
│   └── test_api_search_validation.py

├── .github/                          # CI/CD-конфигурация GitHub Actions [INTERNAL]
│   ├── changelog-config.json         # Настройки генерации changelog [INTERNAL]
│   ├── release-drafter.yml           # Общий конфиг release-drafter [INTERNAL]
│   └── workflows/                    # Workflows GitHub Actions [INTERNAL]
│       ├── changelog-on-release.yml
│       ├── ci.yml
│       ├── release-drafter.yml
│       ├── secrets.yml
│       └── semgrep.yml

├── .hooks/
│   └── block_keys.py                 # Локальный pre-commit hook: блокировка ключей/секретов [INTERNAL]

├── .dockerignore                     # Исключения для docker build context [INTERNAL]
├── .coveragerc                       # Конфигурация coverage.py [INTERNAL]
├── .env.example                      # Пример переменных окружения (.env) [PUBLIC API]
├── .gitattributes                    # Атрибуты Git (текст/бинарные и т.п.) [INTERNAL]
├── .gitignore                        # Игнорируемые файлы/директории Git [INTERNAL]
├── .gitleaks.toml                    # Конфиг gitleaks (поиск секретов) [INTERNAL]
├── .pre-commit-config.yaml           # Настройка pre-commit-хуков [INTERNAL]

├── CHANGELOG.md                      # История изменений проекта [PUBLIC API]
├── Dockerfile                        # Официальный образ приложения [PUBLIC API]
├── docker-compose.yml                # Docker-компоуз для локального стенда [PUBLIC API]
├── Makefile                          # Удобные make-цели для разработки и CI [INTERNAL]
├── PROTECTION_CHECK.txt              # Служебный маркер/проверка защитных механизмов [INTERNAL]
├── project-structure.txt             # Описание структуры проекта (этот файл) [PUBLIC API]
├── project-structure-auto.txt        # Автоматический снимок файловой структуры (service) [INTERNAL]
├── pyproject.toml                    # Основной конфиг проекта и зависимостей [PUBLIC API]
├── pytest.ini                        # Конфигурация pytest (маркеры/опции) [INTERNAL]
├── README.md                         # Главный README: обзор и быстрый старт [PUBLIC API]
└── requirements.txt                  # Файл зависимостей (при необходимости вне pyproject) [INTERNAL]
