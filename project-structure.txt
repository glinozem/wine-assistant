wine-assistant/

# Легенда:
# [PUBLIC API]    — то, на что опираются внешние пользователи/интеграции (HTTP API, официальная дока, dev-entrypoints).
# [INTERNAL]      — внутренняя реализация, инфраструктура, тесты, служебные скрипты.
# [EXPERIMENTAL]  — экспериментальные части, структура и контракты могут меняться.

├── api/                              # Flask-приложение и HTTP-эндпоинты [PUBLIC API]
│   ├── app.py                        # Точка входа Flask-приложения, регистрация роутов [PUBLIC API]
│   ├── logging_config.py             # Конфигурация логирования для API [INTERNAL]
│   ├── request_middleware.py         # Общая обработка запросов/ответов (middleware) [INTERNAL]
│   ├── schemas.py                    # Схемы запросов/ответов (REST-контракты) [PUBLIC API]
│   ├── validation.py                 # Бизнес-валидация входящих данных [INTERNAL]
│   └── wsgi.py                       # WSGI-обёртка для деплоя (gunicorn/uwsgi и т.п.) [PUBLIC API]

├── data/
│   └── sample/
│       └── dw_sample_products.csv    # Пример входных данных для разработки и тестов [INTERNAL]

├── db/                               # Схема БД и миграции [INTERNAL]
│   ├── init.sql                      # Инициализация схемы БД с нуля [INTERNAL]
│   ├── migrate.ps1                   # PowerShell-обёртка вокруг миграций [INTERNAL]
│   ├── migrate.sh                    # Bash-обёртка вокруг миграций [INTERNAL]
│   └── migrations/                   # SQL-миграции для эволюции схемы [INTERNAL]
│       ├── 0000_schema_migrations.sql
│       ├── 0001_prices-and-search.sql
│       ├── 0002_price-history-guardrails.sql
│       ├── 0003_inventory-columns-and-asof.sql
│       ├── 0004_diagnostics.sql
│       ├── 0005_price-check.sql
│       ├── 0006_add-idempotency-tables.sql
│       ├── 0007_schema-migrations-view.sql
│       ├── 0008_schema-migrations-view.sql
│       └── 0009_schema-migrations-view-fix.sql

├── docs/                             # Проектная документация [PUBLIC API]
│   ├── dev/                          # История изменения README/заметки по девелопменту [INTERNAL]
│   │   ├── issue-91-summary.md
│   │   ├── README-before06112025.md
│   │   ├── README-before07112025.md
│   │   ├── README-before07112025-01.md
│   │   ├── README-before15112025.md
│   │   ├── README-before17112025.md
│   │   ├── README-before17112025-01.md
│   │   ├── README-before18112025.md
│   │   ├── README-before18112025-01.md
│   │   ├── README-before19112025.md
│   │   ├── README-before19112025-01.md
│   │   └── README-before21112025.md
│   ├── dev-checklist.ps1             # Скрипт/чеклист для ежедневной дев-рутины [INTERNAL]
│   ├── pr-93-summary.md              # Конспект по PR #93 (для истории) [INTERNAL]
│   ├── requirements.md               # Функциональные/тех. требования к системе [PUBLIC API]
│   ├── roadmap_sprint7+.md           # Roadmap, ранняя версия [INTERNAL][EXPERIMENTAL]
│   ├── roadmap_sprint7+_v2.md        # Roadmap, обновлённая версия [INTERNAL][EXPERIMENTAL]
│   └── ROADMAP_v3_RU.md              # Актуальная дорожная карта (основной источник) [PUBLIC API]

├── etl/                              # Локальные ETL-утилиты для прайса [INTERNAL]
│   ├── mapping_template.json         # Шаблон маппинга колонок поставщика → внутренний формат [PUBLIC API]
│   ├── run_daily.py                  # Скрипт ежедневного прогона ETL (entrypoint под планировщик) [INTERNAL]
│   └── utils.py                      # Общие помощники ETL (чтение файлов, SHA, и т.п.) [INTERNAL]

├── jobs/
│   └── ingest_dw_price.py            # Джоба загрузки прайса в DWH/целевую БД [INTERNAL][EXPERIMENTAL]

├── scripts/                          # Вспомогательные скрипты для разработчиков/ops [INTERNAL]
│   ├── date_extraction.py            # Извлечение дат из текстов/имен файлов [INTERNAL]
│   ├── idempotency.py                # Помощники по идемпотентности операций [INTERNAL]
│   ├── load_csv.py                   # CLI для загрузки CSV в БД/систему [INTERNAL]
│   ├── load_utils.py                 # Общие утилиты для сценариев загрузки [INTERNAL]
│   ├── migrate.ps1                   # Удобный запуск миграций под Windows [INTERNAL]
│   ├── run_integration_tests.ps1     # Скрипт запуска интеграционных тестов [INTERNAL]
│   └── setup_scheduler.ps1           # Настройка планировщика задач (Windows) [INTERNAL]

├── tests/                            # Автотесты (API, ETL, утилиты) [INTERNAL]
│   ├── README.md                     # Пояснения к структуре и уровням тестирования [INTERNAL]
│   ├── __init__.py
│   ├── conftest.py                   # Общие фикстуры (приложение, БД, данные) [INTERNAL]
│   ├── cors-test.html                # Ручная проверка CORS из браузера [INTERNAL]
│   ├── fixtures/                     # SQL-фикстуры для тестовых БД [INTERNAL]
│   │   ├── schema.sql
│   │   └── schema_prices.sql
│   ├── e2e/                          # E2E-слой (сейчас только заготовка пакета) [INTERNAL][EXPERIMENTAL]
│   │   └── __init__.py
│   ├── integration/                  # Интеграционные тесты (API + БД + ETL) [INTERNAL]
│   │   ├── __init__.py
│   │   ├── api_test_utils.py         # Общие утилиты для интеграционных API-тестов [INTERNAL]
│   │   ├── conftest.py               # Специфичные фикстуры для интеграции [INTERNAL]
│   │   ├── test_api_products_search_happy.py  # Happy-путь поиска по каталогу [INTERNAL]
│   │   └── test_price_import_etl.py           # E2E: импорт прайса и проверка истории цен [INTERNAL]
│   ├── unit/                         # Юнит-тесты бизнес-логики и утилит [INTERNAL]
│   │   ├── __init__.py
│   │   ├── test_date_extraction.py
│   │   ├── test_health.py
│   │   ├── test_idempotency.py
│   │   ├── test_load_csv.py
│   │   ├── test_load_utils.py
│   │   ├── test_schemas.py
│   │   └── test_validation.py
│   ├── test_api_health.py            # Тесты health-check API [INTERNAL]
│   ├── test_api_limits_and_security.py       # Лимиты и базовая безопасность API [INTERNAL]
│   ├── test_api_products_happy.py            # Happy-путь продуктов/цен API [INTERNAL]
│   ├── test_api_products_validation.py       # Валидация входных данных продуктов [INTERNAL]
│   └── test_api_search_validation.py         # Валидация параметров поиска [INTERNAL]

├── .github/                          # CI/CD-конфигурация GitHub Actions [INTERNAL]
│   ├── changelog-config.json         # Настройки генерации changelog [INTERNAL]
│   ├── release-drafter.yml           # Основной конфиг release-drafter [INTERNAL]
│   └── workflows/                    # Workflows GitHub Actions [INTERNAL]
│       ├── changelog-on-release.yml
│       ├── ci.yml
│       ├── release-drafter.yml
│       ├── secrets.yml
│       └── semgrep.yml

├── .hooks/
│   └── block_keys.py                 # Локальный pre-commit hook: блокировка ключей/секретов [INTERNAL]

├── .dockerignore                     # Исключения для docker build context [INTERNAL]
├── .coveragerc                       # Конфигурация coverage.py [INTERNAL]
├── .env.example                      # Пример переменных окружения (.env) [PUBLIC API]
├── .gitattributes                    # Атрибуты Git (текст/бинарные и т.п.) [INTERNAL]
├── .gitignore                        # Игнорируемые файлы/директории Git [INTERNAL]
├── .gitleaks.toml                    # Конфиг gitleaks (поиск секретов) [INTERNAL]
├── .pre-commit-config.yaml           # Настройка pre-commit хуков [INTERNAL]

├── CHANGELOG.md                      # История изменений проекта [PUBLIC API]
├── Dockerfile                        # Официальный образ приложения [PUBLIC API]
├── docker-compose.yml                # Docker-компоуз для локального стенда [PUBLIC API]
├── Makefile                          # Удобные make-цели для разработки и CI [INTERNAL]
├── PROTECTION_CHECK.txt              # Служебный маркер/проверка защитных механизмов [INTERNAL]
├── project-structure.txt             # Описание структуры проекта (этот файл) [PUBLIC API]
├── pyproject.toml                    # Основной конфиг проекта и зависимостей [PUBLIC API]
├── pytest.ini                        # Конфигурация pytest (маркеры/опции) [INTERNAL]
├── README.md                         # Главный README: обзор и быстрый старт [PUBLIC API]
└── requirements.txt                  # Файл зависимостей (при необходимости вне pyproject) [INTERNAL]
