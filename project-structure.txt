# Wine Assistant — Project Structure

Generated: 2025-12-21 (Europe/Helsinki)

This document summarizes the repository layout (tracked files) and highlights the DR/backups additions introduced on 2025-12-21.

## Key entrypoints
- API: api/app.py (Flask app), api/wsgi.py (WSGI entrypoint)
- DB: db/init.sql, db/migrate.sh, db/migrations/*.sql
- Compose: docker-compose.yml (core stack), docker-compose.storage.yml (MinIO stack), docker-compose.observability.yml (metrics/logs)
- Make tasks: Makefile (backup/restore, MinIO tooling, DR smoke tests)

## Repository tree (tracked, depth ≤ 5)
.
├── .dockerignore
├── .env.example
├── .gitattributes
├── .github
│   ├── changelog-config.json
│   ├── release-drafter.yml
│   └── workflows
│       ├── changelog-on-release.yml
│       ├── ci.yml
│       ├── release-drafter.yml
│       ├── secrets.yml
│       └── semgrep.yml
├── .gitignore
├── .gitleaks.toml
├── .hooks
│   └── block_keys.py
├── .pre-commit-config.yaml
├── CHANGELOG.md
├── Dockerfile
├── INDEX.md
├── Makefile
├── PROTECTION_CHECK.txt
├── QUICK_REFERENCE.md
├── README.md
├── api
│   ├── app.py
│   ├── export.py
│   ├── logging_config.py
│   ├── request_middleware.py
│   ├── schemas.py
│   ├── templates
│   │   └── ui.html
│   ├── validation.py
│   └── wsgi.py
├── data
│   └── sample
│       └── dw_sample_products.csv
├── db
│   ├── init.sql
│   ├── migrate.ps1
│   ├── migrate.sh
│   └── migrations
│       ├── 0000_schema_migrations.sql
│       ├── 0001_prices-and-search.sql
│       ├── 0002_price-history-guardrails.sql
│       ├── 0003_inventory-columns-and-asof.sql
│       ├── 0004_diagnostics.sql
│       ├── 0005_price-check.sql
│       ├── 0006_add-idempotency-tables.sql
│       ├── 0007_schema-migrations-view.sql
│       ├── 0008_schema-migrations-view.sql
│       ├── 0009_schema-migrations-view-fix.sql
│       ├── 0010_price-list-quarantine.sql
│       ├── 0011_product_prices_partitioning.sql
│       ├── 0011_products_extra_fields.sql
│       ├── 0012_wineries.sql
│       ├── 2025-10-14-diagnostics.sql
│       ├── 2025-10-14-price-check.sql
│       ├── 2025-10-14-price-history-guardrails.sql
│       └── 2025-10-14-prices-and-search.sql
├── docker-compose.observability.yml
├── docker-compose.storage.yml
├── docker-compose.yml
├── docs
│   ├── BEFORE_AFTER_COMPARISON.md
│   ├── README_UPDATE_SUMMARY.md
│   ├── ROADMAP_v3_RU.md
│   ├── dev
│   │   ├── PR_DESCRIPTION.md
│   │   ├── PR_body_ru_extended_wineries_sku_20251130dd30112025.md
│   │   ├── README-before06112025.md
│   │   ├── README-before07112025-01.md
│   │   ├── README-before07112025.md
│   │   ├── README-before15112025.md
│   │   ├── README-before17112025-01.md
│   │   ├── README-before17112025.md
│   │   ├── README-before18112025-01.md
│   │   ├── README-before18112025.md
│   │   ├── README-before19112025-01.md
│   │   ├── README-before19112025.md
│   │   ├── README-before21112025.md
│   │   ├── README-before22112025.md
│   │   ├── README-before24112025.md
│   │   ├── README-before28112025.md
│   │   ├── README-before30112025.md
│   │   ├── README.auto_images.ru-28112025.md
│   │   ├── README.auto_images.ru.extended-28112025.md
│   │   ├── README.extradd04122025.md
│   │   ├── README.ru-additiondd28112025.md
│   │   ├── README.wineriesdd30112025.md
│   │   ├── READMEdd04122025.md
│   │   ├── backup-dr-runbook.md
│   │   ├── cheatsheet-from-clean-clone-to-green-tests.md
│   │   ├── cleanup-test-data.md
│   │   ├── dev-setup-windows.md
│   │   ├── export-web-ui.md
│   │   ├── gitignore.md
│   │   ├── how-to-create-analysis-bundle.md
│   │   ├── issue-83-84-notes.md
│   │   ├── issue-85-partitioning-notes.md
│   │   ├── issue-91-summary.md
│   │   ├── logging-eventsdd05122025.md
│   │   ├── manual-smoke-checkdd03122025.md
│   │   ├── pricing-rules.md
│   │   ├── producer_site_image_url_readme_ru.md
│   │   ├── readme-inventory-and-chartsdd03122025.md
│   │   ├── readme_block_new_products_fields_ru.md
│   │   ├── readme_wine_fields_export.md
│   │   ├── release-notes-2025-12-16.md
│   │   ├── release-notes-2025-12-21.md
│   │   ├── web-ui.md
│   │   └── windows-powershell-http.md
│   ├── dev-checklist.ps1
│   ├── manual-smoke-check.md
│   ├── pr-93-summary.md
│   ├── requirements.md
│   ├── roadmap_sprint7+.md
│   └── roadmap_sprint7+_v2.md
├── etl
│   ├── image_extractor.py
│   ├── mapping_template.json
│   ├── run_daily.py
│   └── utils.py
├── jobs
│   ├── cleanup_old_partitions.py
│   └── ingest_dw_price.py
├── observability
│   ├── README.md
│   ├── grafana
│   │   ├── dashboards
│   │   │   └── wine-assistant-api.json
│   │   └── provisioning
│   │       ├── dashboards
│   │       │   └── dashboards.yml
│   │       └── datasources
│   │           └── datasources.yml
│   ├── loki-config.yml
│   └── promtail-config.yml
├── ops
│   └── backup
│       ├── Dockerfile
│       └── backup.sh
├── project-structure.txt
├── pyproject.toml
├── pytest.ini
├── requirements.txt
├── scripts
│   ├── __init__.py
│   ├── backfill_current_prices.py
│   ├── bundle.ps1
│   ├── check_wineries_vs_products.py
│   ├── cleanup_test_data.py
│   ├── data_quality.py
│   ├── date_extraction.py
│   ├── dr_smoke.ps1
│   ├── enrich_producers.py
│   ├── extract_wineries_from_pdf.py
│   ├── idempotency.py
│   ├── load_csv.py
│   ├── load_utils.py
│   ├── load_wineries.py
│   ├── load_wineries_enrichment.py
│   ├── make_analysis_bundle.ps1
│   ├── manual_smoke_check.ps1
│   ├── migrate.ps1
│   ├── minio_backups.py
│   ├── normalize_wineries_suppliers.py
│   ├── quick_smoke_check.ps1
│   ├── run_integration_tests.ps1
│   ├── setup_scheduler.ps1
│   ├── smoke_backup_restore.ps1
│   └── sync_inventory_history.py
├── tests
│   ├── README.md
│   ├── __init__.py
│   ├── conftest.py
│   ├── cors-test.html
│   ├── e2e
│   │   └── __init__.py
│   ├── fixtures
│   │   ├── schema.sql
│   │   └── schema_prices.sql
│   ├── integration
│   │   ├── __init__.py
│   │   ├── api_test_utils.py
│   │   ├── conftest.py
│   │   ├── test_api_export_search.py
│   │   ├── test_api_export_sku_and_price_history.py
│   │   ├── test_api_products_search_happy.py
│   │   └── test_price_import_etl.py
│   ├── test_api_health.py
│   ├── test_api_limits_and_security.py
│   ├── test_api_products_happy.py
│   ├── test_api_products_validation.py
│   ├── test_api_search_validation.py
│   └── unit
│       ├── __init__.py
│       ├── test_data_quality.py
│       ├── test_date_extraction.py
│       ├── test_export_service.py
│       ├── test_health.py
│       ├── test_idempotency.py
│       ├── test_load_csv.py
│       ├── test_load_utils.py
│       ├── test_schemas.py
│       └── test_validation.py
└── .coveragerc

## DR / backups additions (2025-12-21)
- MinIO “remote-like” storage for local dev/DR testing:
  - docker-compose.storage.yml
  - scripts/minio_backups.py (CLI: list / prune / download-latest)
- DR smoke tests (restore verification):
  - scripts/dr_smoke.ps1 (modes: truncate / dropvolume)
  - scripts/smoke_backup_restore.ps1 (lightweight helper)
- Optional backup container (rclone + pg_dump), profile `backup`:
  - ops/backup/Dockerfile
  - ops/backup/backup.sh
  - docker-compose.yml: service `backup` (profile: backup)

## Expected untracked runtime directories (ignored)
- backups/      (local pg_dump artifacts; pruned by BACKUP_KEEP)
- restore_tmp/  (download-latest destination)
- .venv/        (local virtualenv)
- htmlcov/      (pytest-cov output)
