# Wine Assistant РІР‚вЂќ API & ETL

[![CI](https://github.com/glinozem/wine-assistant/actions/workflows/ci.yml/badge.svg)](../../actions/workflows/ci.yml)
[![Tests](https://github.com/glinozem/wine-assistant/actions/workflows/test.yml/badge.svg)](../../actions/workflows/test.yml)
[![Release Drafter](https://github.com/glinozem/wine-assistant/actions/workflows/release-drafter.yml/badge.svg)](../../actions/workflows/release-drafter.yml)
[![Changelog on Release](https://github.com/glinozem/wine-assistant/actions/workflows/changelog-on-release.yml/badge.svg)](../../actions/workflows/changelog-on-release.yml)

Р СљР С‘Р Р…Р С‘-РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓ Р Т‘Р В»РЎРЏ Р С—Р С•Р С‘РЎРѓР С”Р В° Р Р†Р С‘Р Р…, РЎвЂ¦РЎР‚Р В°Р Р…Р ВµР Р…Р С‘РЎРЏ Р С—РЎР‚Р В°Р в„–РЎРѓ-Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦ Р С‘ Р С‘РЎРѓРЎвЂљР С•РЎР‚Р С‘Р С‘ РЎвЂ Р ВµР Р…/Р С•РЎРѓРЎвЂљР В°РЎвЂљР С”Р С•Р Р†.
API Р Р…Р В° Flask + PostgreSQL (pg_trgm, pgvector), Р В·Р В°Р С–РЎР‚РЎС“Р В·Р С”Р В° Excel/CSV.

**Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ:** 0.4.0 (Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 3 РІР‚вЂќ Security & Rate Limiting)

---

## СЂСџвЂњвЂ Р РЋР С•Р Т‘Р ВµРЎР‚Р В¶Р В°Р Р…Р С‘Р Вµ

- [Р В§РЎвЂљР С• Р Р…Р С•Р Р†Р С•Р С–Р С• Р Р† Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљР Вµ 3](#РЎвЂЎРЎвЂљР С•-Р Р…Р С•Р Р†Р С•Р С–Р С•-Р Р†-РЎРѓР С—РЎР‚Р С‘Р Р…РЎвЂљР Вµ-3)
- [Р СћРЎР‚Р ВµР В±Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ](#РЎвЂљРЎР‚Р ВµР В±Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ)
- [Р вЂРЎвЂ№РЎРѓРЎвЂљРЎР‚РЎвЂ№Р в„– РЎРѓРЎвЂљР В°РЎР‚РЎвЂљ](#Р В±РЎвЂ№РЎРѓРЎвЂљРЎР‚РЎвЂ№Р в„–-РЎРѓРЎвЂљР В°РЎР‚РЎвЂљ)
  - [1) Р СџР С•Р Т‘Р Р…РЎРЏРЎвЂљРЎРЉ Р вЂР вЂќ](#1-Р С—Р С•Р Т‘Р Р…РЎРЏРЎвЂљРЎРЉ-Р В±Р Т‘)
  - [1.5) Р СџРЎР‚Р С‘Р СР ВµР Р…Р С‘РЎвЂљРЎРЉ Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ (РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ!)](#15-Р С—РЎР‚Р С‘Р СР ВµР Р…Р С‘РЎвЂљРЎРЉ-Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘-РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ)
  - [2) Р РЋР С•Р В·Р Т‘Р В°РЎвЂљРЎРЉ .env](#2-РЎРѓР С•Р В·Р Т‘Р В°РЎвЂљРЎРЉ-env)
  - [3) Р Р€РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С‘РЎвЂљРЎРЉ Р В·Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР С‘](#3-РЎС“РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С‘РЎвЂљРЎРЉ-Р В·Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР С‘)
  - [4) Р вЂ”Р В°Р С–РЎР‚РЎС“Р В·Р С‘РЎвЂљРЎРЉ Р Т‘Р В°Р Р…Р Р…РЎвЂ№Р Вµ](#4-Р В·Р В°Р С–РЎР‚РЎС“Р В·Р С‘РЎвЂљРЎРЉ-Р Т‘Р В°Р Р…Р Р…РЎвЂ№Р Вµ)
  - [5) Р вЂ”Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљРЎРЉ API](#5-Р В·Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљРЎРЉ-api)
  - [РІСљвЂ¦ Р В§Р ВµР С”Р В»Р С‘РЎРѓРЎвЂљ Р В·Р В°Р С—РЎС“РЎРѓР С”Р В°](#-РЎвЂЎР ВµР С”Р В»Р С‘РЎРѓРЎвЂљ-Р В·Р В°Р С—РЎС“РЎРѓР С”Р В°)
- [API](#api)
  - [Health & Readiness](#health--readiness)
  - [Rate Limiting](#rate-limiting)
  - [/search](#search)
  - [/catalog/search](#catalogsearch)
  - [/sku/РІР‚В¦](#sku)
  - [Swagger / OpenAPI](#swagger--openapi)
  - [Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†](#Р С—РЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№-Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†)
- [Р вЂєР С•Р С–Р С‘Р С”Р В° РЎвЂ Р ВµР Р… Р С‘ РЎРѓР С”Р С‘Р Т‘Р С•Р С”](#Р В»Р С•Р С–Р С‘Р С”Р В°-РЎвЂ Р ВµР Р…-Р С‘-РЎРѓР С”Р С‘Р Т‘Р С•Р С”)
- [CORS Configuration](#cors-configuration)
- [Docker Health Monitoring](#docker-health-monitoring)
- [Docker API Service](#docker-api-service)
- [Adminer (SQL UI)](#adminer-sql-ui)
- [Р СљР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р вЂР вЂќ](#Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘-Р В±Р Т‘)
- [ETL / Р В·Р В°Р С–РЎР‚РЎС“Р В·РЎвЂЎР С‘Р С”](#etl--Р В·Р В°Р С–РЎР‚РЎС“Р В·РЎвЂЎР С‘Р С”)
- [СЂСџвЂќВ§ Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ Р С—РЎР‚Р С•Р В±Р В»Р ВµР С](#-РЎР‚Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ-Р С—РЎР‚Р С•Р В±Р В»Р ВµР С)
- [CI/CD Р С‘ CHANGELOG](#cicd-Р С‘-changelog)
- [Roadmap](#roadmap)

---

## СЂСџвЂ вЂў Р В§РЎвЂљР С• Р Р…Р С•Р Р†Р С•Р С–Р С• Р Р† Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљР Вµ 3

### Rate Limiting & Security

Р вЂќР С•Р В±Р В°Р Р†Р В»Р ВµР Р…Р В° Р В·Р В°РЎвЂ°Р С‘РЎвЂљР В° Р С•РЎвЂљ Р В·Р В»Р С•РЎС“Р С—Р С•РЎвЂљРЎР‚Р ВµР В±Р В»Р ВµР Р…Р С‘Р в„– Р С‘ DDoS-Р В°РЎвЂљР В°Р С”:

#### **Rate Limiting** СЂСџвЂќвЂ™
- **Р СџРЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р Вµ РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљРЎвЂ№:** 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ (Р СР С•Р В¶Р Р…Р С• Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р С‘РЎвЂљРЎРЉ)
- **Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№Р Вµ РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљРЎвЂ№ (API key):** 1000 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ (Р СР С•Р В¶Р Р…Р С• Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р С‘РЎвЂљРЎРЉ)
- **Rate limit headers:** Р С’Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р Вµ Р В·Р В°Р С–Р С•Р В»Р С•Р Р†Р С”Р С‘ Р Р† Р С”Р В°Р В¶Р Т‘Р С•Р С Р С•РЎвЂљР Р†Р ВµРЎвЂљР Вµ:
  - `X-RateLimit-Limit` РІР‚вЂќ Р СР В°Р С”РЎРѓР С‘Р СРЎС“Р С Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†
  - `X-RateLimit-Remaining` РІР‚вЂќ Р С•РЎРѓРЎвЂљР В°Р В»Р С•РЎРѓРЎРЉ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†
  - `X-RateLimit-Reset` РІР‚вЂќ Unix timestamp РЎРѓР В±РЎР‚Р С•РЎРѓР В°
  - `Retry-After` РІР‚вЂќ РЎРѓР ВµР С”РЎС“Р Р…Р Т‘ Р Т‘Р С• РЎРѓР В±РЎР‚Р С•РЎРѓР В°
- **HTTP 429:** Р СџРЎР‚Р С‘ Р С—РЎР‚Р ВµР Р†РЎвЂ№РЎв‚¬Р ВµР Р…Р С‘Р С‘ Р В»Р С‘Р СР С‘РЎвЂљР В° Р Р†Р С•Р В·Р Р†РЎР‚Р В°РЎвЂ°Р В°Р ВµРЎвЂљРЎРѓРЎРЏ `Too Many Requests`
- **Р вЂњР С‘Р В±Р С”Р В°РЎРЏ Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р В°:** Р В§Р ВµРЎР‚Р ВµР В· environment variables (Р Р†Р С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘Р Вµ/Р Р†РЎвЂ№Р С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘Р Вµ, Р С‘Р В·Р СР ВµР Р…Р ВµР Р…Р С‘Р Вµ Р В»Р С‘Р СР С‘РЎвЂљР С•Р Р†)
- **Production-ready:** Р СџР С•Р Т‘Р Т‘Р ВµРЎР‚Р В¶Р С”Р В° Redis Р Т‘Р В»РЎРЏ РЎР‚Р В°РЎРѓР С—РЎР‚Р ВµР Т‘Р ВµР В»РЎвЂР Р…Р Р…РЎвЂ№РЎвЂ¦ РЎРѓР С‘РЎРѓРЎвЂљР ВµР С

#### **Security Improvements** СЂСџвЂєРЋРїС‘РЏ
- Р ВРЎРѓР С—РЎР‚Р В°Р Р†Р В»Р ВµР Р…РЎвЂ№ SQL injection РЎС“РЎРЏР В·Р Р†Р С‘Р СР С•РЎРѓРЎвЂљР С‘ Р Р† history endpoints
- Р вЂќР С•Р В±Р В°Р Р†Р В»Р ВµР Р…РЎвЂ№ Semgrep Р В°Р Р…Р Р…Р С•РЎвЂљР В°РЎвЂ Р С‘Р С‘ Р Т‘Р В»РЎРЏ false positives
- Р Р€Р В»РЎС“РЎвЂЎРЎв‚¬Р ВµР Р…Р В° Р Р†Р В°Р В»Р С‘Р Т‘Р В°РЎвЂ Р С‘РЎРЏ Р С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°РЎвЂљР ВµР В»РЎРЉРЎРѓР С”Р С•Р С–Р С• Р Р†Р Р†Р С•Р Т‘Р В°

---

## Р СћРЎР‚Р ВµР В±Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ

- **Python** 3.11+ (Р С—Р С•Р Т‘Р С•Р в„–Р Т‘РЎвЂРЎвЂљ 3.10/3.12, Р Р…Р С• РЎвЂљР ВµРЎРѓРЎвЂљР С‘РЎР‚РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ Р Р…Р В° 3.11)
- **pip**, **virtualenv** (РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ)
- **Docker** + **Docker Compose**
- Р ВР Р…РЎвЂљР ВµРЎР‚Р Р…Р ВµРЎвЂљ Р Т‘Р В»РЎРЏ РЎС“РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С”Р С‘ Р В·Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР ВµР в„– (`openpyxl`, `psycopg2-binary`, `Flask-Limiter`, РІР‚В¦)

---

## Р вЂРЎвЂ№РЎРѓРЎвЂљРЎР‚РЎвЂ№Р в„– РЎРѓРЎвЂљР В°РЎР‚РЎвЂљ

### 1) Р СџР С•Р Т‘Р Р…РЎРЏРЎвЂљРЎРЉ Р вЂР вЂќ
```powershell
docker compose up -d
```

**Р В Р ВµР В·РЎС“Р В»РЎРЉРЎвЂљР В°РЎвЂљ:**
- Р вЂР вЂќ: `127.0.0.1:15432` (host) РІвЂ вЂ™ Р С”Р С•Р Р…РЎвЂљР ВµР в„–Р Р…Р ВµРЎР‚ `db:5432`
- Adminer: http://localhost:18080

**СЂСџРЏТђ Healthcheck:**
- Р С’Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р В°РЎРЏ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° Р В·Р Т‘Р С•РЎР‚Р С•Р Р†РЎРЉРЎРЏ Р вЂР вЂќ Р С”Р В°Р В¶Р Т‘РЎвЂ№Р Вµ 10 РЎРѓР ВµР С”РЎС“Р Р…Р Т‘
- Adminer Р В·Р В°Р С—РЎС“РЎРѓР С”Р В°Р ВµРЎвЂљРЎРѓРЎРЏ РЎвЂљР С•Р В»РЎРЉР С”Р С• Р С—Р С•РЎРѓР В»Р Вµ Р С–Р С•РЎвЂљР С•Р Р†Р Р…Р С•РЎРѓРЎвЂљР С‘ Р вЂР вЂќ
- Р С’Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р в„– Р С—Р ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓР С” Р С—РЎР‚Р С‘ РЎРѓР В±Р С•РЎРЏРЎвЂ¦ (`restart: unless-stopped`)

**Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓР В°:**
```powershell
# Р вЂќР С•Р В»Р В¶Р ВµР Р… Р В±РЎвЂ№РЎвЂљРЎРЉ РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓ (healthy)
docker compose ps
```

СЂСџвЂ™РЋ **Р С› РЎРѓРЎвЂ¦Р ВµР СР Вµ Р вЂР вЂќ:** `db/init.sql` РЎРѓР С•Р В·Р Т‘Р В°РЎвЂРЎвЂљ Р С—Р С•Р В»Р Р…РЎС“РЎР‹ РЎР‚Р В°Р В±Р С•РЎвЂЎРЎС“РЎР‹ РЎРѓРЎвЂ¦Р ВµР СРЎС“ РЎРѓ РЎвЂљР В°Р В±Р В»Р С‘РЎвЂ Р В°Р СР С‘, Р С‘Р Р…Р Т‘Р ВµР С”РЎРѓР В°Р СР С‘ Р С‘ РЎвЂћРЎС“Р Р…Р С”РЎвЂ Р С‘РЎРЏР СР С‘. Р вЂќР В»РЎРЏ Р В±РЎвЂ№РЎРѓРЎвЂљРЎР‚Р С•Р С–Р С• РЎРѓРЎвЂљР В°РЎР‚РЎвЂљР В° РЎР‚Р В°Р В·РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р С‘ РЎРЊРЎвЂљР С•Р С–Р С• Р Т‘Р С•РЎРѓРЎвЂљР В°РЎвЂљР С•РЎвЂЎР Р…Р С•. Р вЂќР В»РЎРЏ production-Р С•Р С”РЎР‚РЎС“Р В¶Р ВµР Р…Р С‘РЎРЏ **РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ Р С—РЎР‚Р С‘Р СР ВµР Р…Р С‘РЎвЂљРЎРЉ Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘** (РЎРѓР С. РЎв‚¬Р В°Р С– 1.5).

---

### 1.5) Р СџРЎР‚Р С‘Р СР ВµР Р…Р С‘РЎвЂљРЎРЉ Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ (РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ!)

```powershell
# Р СџРЎР‚Р С‘Р СР ВµР Р…Р С‘РЎвЂљ Р Р†РЎРѓР Вµ *.sql Р С‘Р В· db/migrations Р С—Р С• Р В°Р В»РЎвЂћР В°Р Р†Р С‘РЎвЂљРЎС“
powershell -ExecutionPolicy Bypass -File .\scripts\migrate.ps1
```

**Р СљР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р Т‘Р С•Р В±Р В°Р Р†Р В»РЎРЏРЎР‹РЎвЂљ:**
- СЂСџвЂќвЂ™ **Guardrails:** Constraints Р Р…Р В° Р С—Р ВµРЎР‚Р ВµР С”РЎР‚РЎвЂ№РЎвЂљР С‘РЎРЏ Р С‘Р Р…РЎвЂљР ВµРЎР‚Р Р†Р В°Р В»Р С•Р Р† РЎвЂ Р ВµР Р…, Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р С‘ Р Р…Р ВµР С•РЎвЂљРЎР‚Р С‘РЎвЂ Р В°РЎвЂљР ВµР В»РЎРЉР Р…Р С•РЎРѓРЎвЂљР С‘
- СЂСџвЂњР‰ **Р вЂќР С‘Р В°Р С–Р Р…Р С•РЎРѓРЎвЂљР С‘Р С”Р В°:** Р вЂ”Р В°Р С—РЎР‚Р С•РЎРѓРЎвЂ№ Р Т‘Р В»РЎРЏ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р С‘ РЎвЂ Р ВµР В»Р С•РЎРѓРЎвЂљР Р…Р С•РЎРѓРЎвЂљР С‘ Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦
- РІС™РЋ **Р С›Р С—РЎвЂљР С‘Р СР С‘Р В·Р В°РЎвЂ Р С‘Р С‘:** Р вЂќР С•Р С—Р С•Р В»Р Р…Р С‘РЎвЂљР ВµР В»РЎРЉР Р…РЎвЂ№Р Вµ Р С‘Р Р…Р Т‘Р ВµР С”РЎРѓРЎвЂ№ Р С‘ Р Р…Р С•РЎР‚Р СР В°Р В»Р С‘Р В·Р В°РЎвЂ Р С‘РЎРЏ Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦ Р Т‘Р В»РЎРЏ production

---

**СЂСџвЂњРЉ Р СџРЎР‚Р С‘Р СР ВµРЎвЂЎР В°Р Р…Р С‘Р Вµ Р С• РЎвЂ¦Р С•Р В»Р С•Р Т‘Р Р…Р С•Р С РЎРѓРЎвЂљР В°РЎР‚РЎвЂљР Вµ:**

`db/init.sql` РЎРѓР С•Р Т‘Р ВµРЎР‚Р В¶Р С‘РЎвЂљ Р С—Р С•Р В»Р Р…РЎС“РЎР‹ РЎРѓРЎвЂ¦Р ВµР СРЎС“ Р Т‘Р В»РЎРЏ Р В±РЎвЂ№РЎРѓРЎвЂљРЎР‚Р С•Р С–Р С• РЎРѓРЎвЂљР В°РЎР‚РЎвЂљР В°:
- РІСљвЂ¦ Р вЂ™РЎРѓР Вµ РЎвЂљР В°Р В±Р В»Р С‘РЎвЂ РЎвЂ№ (products, product_prices, inventory, inventory_history)
- РІСљвЂ¦ Р вЂ™РЎРѓР Вµ Р С”Р С•Р В»Р С•Р Р…Р С”Р С‘ (Р Р†Р С”Р В»РЎР‹РЎвЂЎР В°РЎРЏ price_list_rub, price_final_rub, stock_total, reserved, stock_free)
- РІСљвЂ¦ Р С›РЎРѓР Р…Р С•Р Р†Р Р…РЎвЂ№Р Вµ Р С‘Р Р…Р Т‘Р ВµР С”РЎРѓРЎвЂ№ Р С‘ РЎвЂћРЎС“Р Р…Р С”РЎвЂ Р С‘Р С‘ (upsert_price, upsert_inventory)
- РІСљвЂ¦ Р вЂР В°Р В·Р С•Р Р†РЎвЂ№Р Вµ constraints (PRIMARY KEY, FOREIGN KEY, CHECK)

**Р СљР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р Т‘Р С•Р В±Р В°Р Р†Р В»РЎРЏРЎР‹РЎвЂљ:**
- СЂСџвЂќвЂ™ Advanced constraints (EXCLUDE Р Т‘Р В»РЎРЏ Р С—РЎР‚Р ВµР Т‘Р С•РЎвЂљР Р†РЎР‚Р В°РЎвЂ°Р ВµР Р…Р С‘РЎРЏ Р С—Р ВµРЎР‚Р ВµР С”РЎР‚РЎвЂ№РЎвЂљР С‘Р в„– Р Р†РЎР‚Р ВµР СР ВµР Р…Р Р…РЎвЂ№РЎвЂ¦ Р С‘Р Р…РЎвЂљР ВµРЎР‚Р Р†Р В°Р В»Р С•Р Р†)
- СЂСџвЂќРЊ Р вЂќР С‘Р В°Р С–Р Р…Р С•РЎРѓРЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р Вµ Р В·Р В°Р С—РЎР‚Р С•РЎРѓРЎвЂ№ Р Т‘Р В»РЎРЏ Р С”Р С•Р Р…РЎвЂљРЎР‚Р С•Р В»РЎРЏ Р С”Р В°РЎвЂЎР ВµРЎРѓРЎвЂљР Р†Р В° Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦
- СЂСџС™Р‚ Production-РЎРѓР С—Р ВµРЎвЂ Р С‘РЎвЂћР С‘РЎвЂЎР Р…РЎвЂ№Р Вµ Р С•Р С—РЎвЂљР С‘Р СР С‘Р В·Р В°РЎвЂ Р С‘Р С‘

**Р вЂ™РЎвЂ№Р Р†Р С•Р Т‘:**
- **Dev-Р С•Р С”РЎР‚РЎС“Р В¶Р ВµР Р…Р С‘Р Вµ:** Р СљР С•Р В¶Р Р…Р С• РЎР‚Р В°Р В±Р С•РЎвЂљР В°РЎвЂљРЎРЉ РЎРѓРЎР‚Р В°Р В·РЎС“ Р С—Р С•РЎРѓР В»Р Вµ `docker compose up -d`
- **Production:** Р С›Р В±РЎРЏР В·Р В°РЎвЂљР ВµР В»РЎРЉР Р…Р С• Р Р†РЎвЂ№Р С—Р С•Р В»Р Р…Р С‘РЎвЂљР Вµ Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р Т‘Р В»РЎРЏ Р СР В°Р С”РЎРѓР С‘Р СР В°Р В»РЎРЉР Р…Р С•Р в„– Р Р…Р В°Р Т‘РЎвЂР В¶Р Р…Р С•РЎРѓРЎвЂљР С‘

---

### 2) Р РЋР С•Р В·Р Т‘Р В°РЎвЂљРЎРЉ .env

Р РЋР С”Р С•Р С—Р С‘РЎР‚РЎС“Р в„–РЎвЂљР Вµ `.env.example` Р Р† `.env` Р С‘ Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–РЎвЂљР Вµ:

```ini
# .env
PGHOST=127.0.0.1
PGPORT=15432
PGUSER=postgres
PGPASSWORD=dev_local_pw
PGDATABASE=wine_db

# API
API_KEY=mytestkey_Р СР С‘Р Р…Р С‘Р СРЎС“Р С_32_РЎРѓР С‘Р СР Р†Р С•Р В»Р В°_Р Т‘Р В»РЎРЏ_Р В±Р ВµР В·Р С•Р С—Р В°РЎРѓР Р…Р С•РЎРѓРЎвЂљР С‘
FLASK_HOST=127.0.0.1
FLASK_PORT=18000
FLASK_DEBUG=1

# Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ API (Р Т‘Р В»РЎРЏ healthcheck)
APP_VERSION=0.4.0

# CORS (Р Т‘Р В»РЎРЏ РЎвЂћРЎР‚Р С•Р Р…РЎвЂљР ВµР Р…Р Т‘Р В°)
CORS_ORIGINS=*  # Р В Р В°Р В·РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р В°: * | Production: https://myapp.com,http://localhost:3000

# Rate Limiting (Р Р…Р С•Р Р†Р С•Р Вµ Р Р† v0.4.0)
RATE_LIMIT_ENABLED=1                    # Р вЂ™Р С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ/Р Р†РЎвЂ№Р С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ (1/0)
RATE_LIMIT_PUBLIC=100/hour             # Р вЂєР С‘Р СР С‘РЎвЂљ Р Т‘Р В»РЎРЏ Р С—РЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№РЎвЂ¦ endpoints
RATE_LIMIT_PROTECTED=1000/hour         # Р вЂєР С‘Р СР С‘РЎвЂљ Р Т‘Р В»РЎРЏ Р В·Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№РЎвЂ¦ endpoints
# RATE_LIMIT_STORAGE_URL=redis://localhost:6379  # Redis Р Т‘Р В»РЎРЏ production (Р С•Р С—РЎвЂ Р С‘Р С•Р Р…Р В°Р В»РЎРЉР Р…Р С•)
```

---

### 3) Р Р€РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С‘РЎвЂљРЎРЉ Р В·Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР С‘

```powershell
# Р РЋР С•Р В·Р Т‘Р В°РЎвЂљРЎРЉ Р Р†Р С‘РЎР‚РЎвЂљРЎС“Р В°Р В»РЎРЉР Р…Р С•Р Вµ Р С•Р С”РЎР‚РЎС“Р В¶Р ВµР Р…Р С‘Р Вµ (РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ)
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# Р Р€РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С‘РЎвЂљРЎРЉ Р В·Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР С‘
pip install -r requirements.txt
```

СЂСџвЂњВ¦ Р вЂ”Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР С‘ Р Р†Р С”Р В»РЎР‹РЎвЂЎР В°РЎР‹РЎвЂљ:
- `openpyxl` РІР‚вЂќ РЎР‚Р В°Р В±Р С•РЎвЂљР В° РЎРѓ Excel
- `Flask-Limiter` РІР‚вЂќ rate limiting
- `flasgger` РІР‚вЂќ Swagger UI

---

### 4) Р вЂ”Р В°Р С–РЎР‚РЎС“Р В·Р С‘РЎвЂљРЎРЉ Р Т‘Р В°Р Р…Р Р…РЎвЂ№Р Вµ

Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ Р ВµР Т‘Р С‘Р Р…РЎвЂ№Р в„– РЎРѓР С”РЎР‚Р С‘Р С—РЎвЂљ `scripts/load_csv.py`.

**Excel (РЎРѓ РЎС“РЎвЂЎРЎвЂРЎвЂљР С•Р С РЎРѓР С”Р С‘Р Т‘Р С”Р С‘ Р С‘Р В· РЎРЏРЎвЂЎР ВµР в„–Р С”Р С‘ S5):**

```powershell
$FILE = "data\inbox\Р СџРЎР‚Р В°Р в„–РЎРѓ_2025_01_20.xlsx"
python scripts\load_csv.py --excel "$FILE" --asof 2025-01-20 --discount-cell S5 --prefer-discount-cell
```

**CSV (Р С—РЎР‚Р С‘Р СР ВµРЎР‚ Р С‘Р В· Р С”Р С•Р СР С—Р В»Р ВµР С”РЎвЂљР В°):**

```powershell
python scripts\load_csv.py --csv data\sample\dw_sample_products.csv
```

---

### 5) Р вЂ”Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљРЎРЉ API

```powershell
python api\app.py
# Р ВР В»Р С‘ РЎРѓ Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р В°Р СР С‘ Р С‘Р В· .env: FLASK_HOST=127.0.0.1, FLASK_PORT=18000
```

**Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° Р С–Р С•РЎвЂљР С•Р Р†Р Р…Р С•РЎРѓРЎвЂљР С‘:**

```powershell
# Р вЂР В°Р В·Р С•Р Р†РЎвЂ№Р в„– healthcheck
Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"

# Liveness probe
Invoke-WebRequest -Uri "http://127.0.0.1:18000/live" | ConvertFrom-Json

# Readiness probe (Р Т‘Р ВµРЎвЂљР В°Р В»РЎРЉР Р…Р В°РЎРЏ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В°)
Invoke-WebRequest -Uri "http://127.0.0.1:18000/ready" | ConvertFrom-Json

# Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ API
Invoke-WebRequest -Uri "http://127.0.0.1:18000/version" | ConvertFrom-Json

# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° rate limit headers
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
Write-Host "Rate Limit: $($response.Headers['X-RateLimit-Limit'])"
Write-Host "Remaining: $($response.Headers['X-RateLimit-Remaining'])"
```

---

### РІСљвЂ¦ Р В§Р ВµР С”Р В»Р С‘РЎРѓРЎвЂљ Р В·Р В°Р С—РЎС“РЎРѓР С”Р В°

Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ, РЎвЂЎРЎвЂљР С• Р Р†РЎРѓР Вµ РЎв‚¬Р В°Р С–Р С‘ Р Р†РЎвЂ№Р С—Р С•Р В»Р Р…Р ВµР Р…РЎвЂ№:

- [ ] Docker Р В·Р В°Р С—РЎС“РЎвЂ°Р ВµР Р…
- [ ] `docker compose up -d` Р Р†РЎвЂ№Р С—Р С•Р В»Р Р…Р ВµР Р…
- [ ] (Р С›Р С—РЎвЂ Р С‘Р С•Р Р…Р В°Р В»РЎРЉР Р…Р С•) Р СљР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р С—РЎР‚Р С‘Р СР ВµР Р…Р ВµР Р…РЎвЂ№ (`.\scripts\migrate.ps1`)
- [ ] `.env` РЎРѓР С•Р В·Р Т‘Р В°Р Р… Р С‘ Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р ВµР Р… (Р Р†Р С”Р В»РЎР‹РЎвЂЎР В°РЎРЏ `RATE_LIMIT_*` Р С—Р ВµРЎР‚Р ВµР СР ВµР Р…Р Р…РЎвЂ№Р Вµ)
- [ ] Р вЂ”Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР С‘ РЎС“РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р В»Р ВµР Р…РЎвЂ№ (`pip install -r requirements.txt`)
- [ ] Р вЂќР В°Р Р…Р Р…РЎвЂ№Р Вµ Р В·Р В°Р С–РЎР‚РЎС“Р В¶Р ВµР Р…РЎвЂ№ (`scripts\load_csv.py`)
- [ ] API Р В·Р В°Р С—РЎС“РЎвЂ°Р ВµР Р… Р С‘ Р С•РЎвЂљР Р†Р ВµРЎвЂЎР В°Р ВµРЎвЂљ Р Р…Р В° `/health`, `/live`, `/ready`
- [ ] Rate limiting РЎР‚Р В°Р В±Р С•РЎвЂљР В°Р ВµРЎвЂљ (Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ headers `X-RateLimit-*`)

---

## API

### Health & Readiness

#### **GET /health**
Р СџРЎР‚Р С•РЎРѓРЎвЂљР С•Р в„– healthcheck Р Т‘Р В»РЎРЏ Р С•Р В±РЎР‚Р В°РЎвЂљР Р…Р С•Р в„– РЎРѓР С•Р Р†Р СР ВµРЎРѓРЎвЂљР С‘Р СР С•РЎРѓРЎвЂљР С‘.

```http
GET /health
```

**Р С›РЎвЂљР Р†Р ВµРЎвЂљ:**
```json
{
  "ok": true
}
```

**Rate Limit:** 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ (Р С—РЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р в„– endpoint)

---

#### **GET /live** СЂСџвЂ вЂў
Liveness probe РІР‚вЂќ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЏР ВµРЎвЂљ, Р В¶Р С‘Р Р† Р В»Р С‘ Р С—РЎР‚Р С•РЎвЂ Р ВµРЎРѓРЎРѓ (Р В±Р ВµР В· Р С•Р В±РЎР‚Р В°РЎвЂ°Р ВµР Р…Р С‘РЎРЏ Р С” Р вЂР вЂќ).

```http
GET /live
```

**Р С›РЎвЂљР Р†Р ВµРЎвЂљ:**
```json
{
  "status": "alive",
  "version": "0.4.0",
  "timestamp": "2025-10-28T19:03:38.813229Z",
  "uptime_seconds": 3600
}
```

**Р СџР С•Р В»РЎРЏ:**
- `status` РІР‚вЂќ Р Р†РЎРѓР ВµР С–Р Т‘Р В° "alive" (Р ВµРЎРѓР В»Р С‘ Р С—РЎР‚Р С•РЎвЂ Р ВµРЎРѓРЎРѓ РЎР‚Р В°Р В±Р С•РЎвЂљР В°Р ВµРЎвЂљ)
- `version` РІР‚вЂќ Р Р†Р ВµРЎР‚РЎРѓР С‘РЎРЏ API Р С‘Р В· `APP_VERSION` env
- `timestamp` РІР‚вЂќ РЎвЂљР ВµР С”РЎС“РЎвЂ°Р ВµР Вµ Р Р†РЎР‚Р ВµР СРЎРЏ (UTC, ISO 8601)
- `uptime_seconds` РІР‚вЂќ РЎРѓР С”Р С•Р В»РЎРЉР С”Р С• РЎРѓР ВµР С”РЎС“Р Р…Р Т‘ РЎР‚Р В°Р В±Р С•РЎвЂљР В°Р ВµРЎвЂљ Р С—РЎР‚Р С•РЎвЂ Р ВµРЎРѓРЎРѓ

**Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°Р Р…Р С‘Р Вµ:**
- Kubernetes liveness probe
- Docker HEALTHCHECK
- Р СљР С•Р Р…Р С‘РЎвЂљР С•РЎР‚Р С‘Р Р…Р С– (Prometheus, Datadog)

**Rate Limit:** 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ

---

#### **GET /ready** СЂСџвЂ вЂў
Readiness probe РІР‚вЂќ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЏР ВµРЎвЂљ Р С–Р С•РЎвЂљР С•Р Р†Р Р…Р С•РЎРѓРЎвЂљРЎРЉ Р С” Р С•Р В±РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р Вµ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†.

```http
GET /ready
```

**Р Р€РЎРѓР С—Р ВµРЎв‚¬Р Р…РЎвЂ№Р в„– Р С•РЎвЂљР Р†Р ВµРЎвЂљ (200 OK):**
```json
{
  "status": "ready",
  "timestamp": "2025-10-28T18:17:37.635353Z",
  "version": "0.4.0",
  "checks": {
    "database": {
      "status": "up",
      "latency_ms": 3.26,
      "version": "PostgreSQL 16.10",
      "tables": [
        "inventory",
        "inventory_history",
        "product_prices",
        "products"
      ],
      "indexes": [
        "idx_inventory_code_free",
        "idx_inventory_history_code_time",
        "ux_product_prices_code_from"
      ],
      "constraints": [
        "chk_product_prices_nonneg"
      ]
    }
  },
  "response_time_ms": 48.89
}
```

**Р С›РЎв‚¬Р С‘Р В±Р С”Р В° (503 Service Unavailable):**
```json
{
  "status": "not_ready",
  "timestamp": "2025-10-28T18:22:19.438239Z",
  "version": "0.4.0",
  "checks": {
    "database": {
      "status": "down",
      "error": "connection to server at \"127.0.0.1\", port 15432 failed: Connection refused"
    }
  },
  "response_time_ms": 2038.53
}
```

**Р В§РЎвЂљР С• Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЏР ВµРЎвЂљРЎРѓРЎРЏ:**
1. РІСљвЂ¦ Р СџР С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘Р Вµ Р С” PostgreSQL
2. РІСљвЂ¦ Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ Р вЂР вЂќ (PostgreSQL 16+)
3. РІСљвЂ¦ Р СњР В°Р В»Р С‘РЎвЂЎР С‘Р Вµ 4 РЎвЂљР В°Р В±Р В»Р С‘РЎвЂ 
4. РІСљвЂ¦ Р СњР В°Р В»Р С‘РЎвЂЎР С‘Р Вµ 3 Р С”РЎР‚Р С‘РЎвЂљР С‘РЎвЂЎР Р…РЎвЂ№РЎвЂ¦ Р С‘Р Р…Р Т‘Р ВµР С”РЎРѓР С•Р Р†
5. РІСљвЂ¦ Р СњР В°Р В»Р С‘РЎвЂЎР С‘Р Вµ CHECK constraint

**Rate Limit:** 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ

---

#### **GET /version** СЂСџвЂ вЂў
Р вЂ™Р С•Р В·Р Р†РЎР‚Р В°РЎвЂ°Р В°Р ВµРЎвЂљ РЎвЂљР С•Р В»РЎРЉР С”Р С• Р Р†Р ВµРЎР‚РЎРѓР С‘РЎР‹ API.

```http
GET /version
```

**Р С›РЎвЂљР Р†Р ВµРЎвЂљ:**
```json
{
  "version": "0.4.0"
}
```

**Rate Limit:** 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ

---

### Rate Limiting

API Р В·Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р… Р С•РЎвЂљ Р В·Р В»Р С•РЎС“Р С—Р С•РЎвЂљРЎР‚Р ВµР В±Р В»Р ВµР Р…Р С‘Р в„– РЎРѓ Р С—Р С•Р СР С•РЎвЂ°РЎРЉРЎР‹ rate limiting.

#### **Р вЂєР С‘Р СР С‘РЎвЂљРЎвЂ№ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†:**

| Р СћР С‘Р С— endpoint | Р вЂєР С‘Р СР С‘РЎвЂљ Р С—Р С• РЎС“Р СР С•Р В»РЎвЂЎР В°Р Р…Р С‘РЎР‹ | Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ |
|--------------|-------------------|---------|
| **Р СџРЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р Вµ** | 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ | `/health`, `/search`, `/catalog/search` |
| **Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№Р Вµ (API key)** | 1000 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ | `/sku/*`, `/sku/*/price-history` |

#### **Rate limit headers:**

Р С™Р В°Р В¶Р Т‘РЎвЂ№Р в„– Р С•РЎвЂљР Р†Р ВµРЎвЂљ РЎРѓР С•Р Т‘Р ВµРЎР‚Р В¶Р С‘РЎвЂљ Р С‘Р Р…РЎвЂћР С•РЎР‚Р СР В°РЎвЂ Р С‘РЎР‹ Р С• РЎвЂљР ВµР С”РЎС“РЎвЂ°Р ВµР С РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓР Вµ Р В»Р С‘Р СР С‘РЎвЂљР С•Р Р†:

```http
X-RateLimit-Limit: 100              # Р СљР В°Р С”РЎРѓР С‘Р СРЎС“Р С Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р† Р Р† РЎвЂЎР В°РЎРѓ
X-RateLimit-Remaining: 99           # Р С›РЎРѓРЎвЂљР В°Р В»Р С•РЎРѓРЎРЉ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†
X-RateLimit-Reset: 1730138509       # Unix timestamp РЎРѓР В±РЎР‚Р С•РЎРѓР В° РЎРѓРЎвЂЎРЎвЂРЎвЂљРЎвЂЎР С‘Р С”Р В°
Retry-After: 3600                   # Р РЋР ВµР С”РЎС“Р Р…Р Т‘ Р Т‘Р С• РЎРѓР В±РЎР‚Р С•РЎРѓР В°
```

**Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° headers Р Р† PowerShell:**
```powershell
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
Write-Host "Limit: $($response.Headers['X-RateLimit-Limit'])"
Write-Host "Remaining: $($response.Headers['X-RateLimit-Remaining'])"
Write-Host "Reset: $($response.Headers['X-RateLimit-Reset'])"
```

---

#### **HTTP 429 РІР‚вЂќ Too Many Requests**

Р СџРЎР‚Р С‘ Р С—РЎР‚Р ВµР Р†РЎвЂ№РЎв‚¬Р ВµР Р…Р С‘Р С‘ Р В»Р С‘Р СР С‘РЎвЂљР В° API Р Р†Р С•Р В·Р Р†РЎР‚Р В°РЎвЂ°Р В°Р ВµРЎвЂљ:

```http
HTTP/1.1 429 Too Many Requests
Content-Type: application/json; charset=utf-8
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1730138509
Retry-After: 3600

{
  "error": "rate_limit_exceeded",
  "message": "Too many requests. Please try again later.",
  "retry_after": "3600"
}
```

**Р СџР С•Р В»РЎРЏ:**
- `error` РІР‚вЂќ РЎвЂљР С‘Р С— Р С•РЎв‚¬Р С‘Р В±Р С”Р С‘ (Р Р†РЎРѓР ВµР С–Р Т‘Р В° "rate_limit_exceeded")
- `message` РІР‚вЂќ Р С•Р С—Р С‘РЎРѓР В°Р Р…Р С‘Р Вµ Р Т‘Р В»РЎРЏ Р С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°РЎвЂљР ВµР В»РЎРЏ
- `retry_after` РІР‚вЂќ РЎРѓР ВµР С”РЎС“Р Р…Р Т‘ Р Т‘Р С• РЎРѓР В±РЎР‚Р С•РЎРѓР В° РЎРѓРЎвЂЎРЎвЂРЎвЂљРЎвЂЎР С‘Р С”Р В°

---

#### **Р СњР В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р В° РЎвЂЎР ВµРЎР‚Р ВµР В· environment variables:**

```ini
# .env
RATE_LIMIT_ENABLED=1                    # Р вЂ™Р С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ/Р Р†РЎвЂ№Р С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ (1/0)
RATE_LIMIT_PUBLIC=100/hour             # Р вЂєР С‘Р СР С‘РЎвЂљ Р Т‘Р В»РЎРЏ Р С—РЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№РЎвЂ¦ endpoints
RATE_LIMIT_PROTECTED=1000/hour         # Р вЂєР С‘Р СР С‘РЎвЂљ Р Т‘Р В»РЎРЏ Р В·Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№РЎвЂ¦ endpoints
# RATE_LIMIT_STORAGE_URL=redis://localhost:6379  # Redis Р Т‘Р В»РЎРЏ production (Р С•Р С—РЎвЂ Р С‘Р С•Р Р…Р В°Р В»РЎРЉР Р…Р С•)
```

**Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р С‘:**

```ini
# Р Р€Р Р†Р ВµР В»Р С‘РЎвЂЎР ВµР Р…Р Р…РЎвЂ№Р Вµ Р В»Р С‘Р СР С‘РЎвЂљРЎвЂ№ Р Т‘Р В»РЎРЏ dev Р С•Р С”РЎР‚РЎС“Р В¶Р ВµР Р…Р С‘РЎРЏ
RATE_LIMIT_PUBLIC=1000/hour
RATE_LIMIT_PROTECTED=10000/hour

# Р вЂР С•Р В»Р ВµР Вµ РЎРѓРЎвЂљРЎР‚Р С•Р С–Р С‘Р Вµ Р В»Р С‘Р СР С‘РЎвЂљРЎвЂ№ Р Т‘Р В»РЎРЏ production
RATE_LIMIT_PUBLIC=50/hour
RATE_LIMIT_PROTECTED=500/hour

# Р вЂєР С‘Р СР С‘РЎвЂљРЎвЂ№ Р С—Р С• Р СР С‘Р Р…РЎС“РЎвЂљР В°Р С Р Р†Р СР ВµРЎРѓРЎвЂљР С• РЎвЂЎР В°РЎРѓР С•Р Р†
RATE_LIMIT_PUBLIC=10/minute
RATE_LIMIT_PROTECTED=100/minute

# Р С›РЎвЂљР С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘Р Вµ rate limiting (РЎвЂљР С•Р В»РЎРЉР С”Р С• Р Т‘Р В»РЎРЏ РЎвЂљР ВµРЎРѓРЎвЂљР С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ!)
RATE_LIMIT_ENABLED=0
```

---

#### **Production: Redis Storage**

Р вЂќР В»РЎРЏ РЎР‚Р В°РЎРѓР С—РЎР‚Р ВµР Т‘Р ВµР В»РЎвЂР Р…Р Р…РЎвЂ№РЎвЂ¦ РЎРѓР С‘РЎРѓРЎвЂљР ВµР С (Р Р…Р ВµРЎРѓР С”Р С•Р В»РЎРЉР С”Р С• Р С‘Р Р…РЎРѓРЎвЂљР В°Р Р…РЎРѓР С•Р Р† API Р В·Р В° load balancer) Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ Redis:

```ini
# .env
RATE_LIMIT_STORAGE_URL=redis://redis-host:6379/0
```

**Docker Compose РЎРѓ Redis:**
```yaml
services:
  redis:
    image: redis:7-alpine
    restart: unless-stopped
    ports:
      - "127.0.0.1:6379:6379"

  api:
    environment:
      - RATE_LIMIT_STORAGE_URL=redis://redis:6379/0
    depends_on:
      - redis
```

**Р СџРЎР‚Р ВµР С‘Р СРЎС“РЎвЂ°Р ВµРЎРѓРЎвЂљР Р†Р В° Redis:**
- РІСљвЂ¦ Р С›Р В±РЎвЂ°Р С‘Р в„– РЎРѓРЎвЂЎРЎвЂРЎвЂљРЎвЂЎР С‘Р С” Р Т‘Р В»РЎРЏ Р Р†РЎРѓР ВµРЎвЂ¦ Р С‘Р Р…РЎРѓРЎвЂљР В°Р Р…РЎРѓР С•Р Р† API
- РІСљвЂ¦ Р С’РЎвЂљР С•Р СР В°РЎР‚Р Р…РЎвЂ№Р Вµ Р С•Р С—Р ВµРЎР‚Р В°РЎвЂ Р С‘Р С‘ (thread-safe)
- РІСљвЂ¦ Р С’Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С•Р Вµ Р С‘РЎРѓРЎвЂљР ВµРЎвЂЎР ВµР Р…Р С‘Р Вµ TTL
- РІСљвЂ¦ Р СџР ВµРЎР‚РЎРѓР С‘РЎРѓРЎвЂљР ВµР Р…РЎвЂљР Р…Р С•РЎРѓРЎвЂљРЎРЉ РЎРѓРЎвЂЎРЎвЂРЎвЂљРЎвЂЎР С‘Р С”Р С•Р Р† Р С—РЎР‚Р С‘ Р С—Р ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓР С”Р Вµ

---

#### **Р С›РЎвЂљР С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘Р Вµ rate limiting**

Р вЂќР В»РЎРЏ Р В»Р С•Р С”Р В°Р В»РЎРЉР Р…Р С•Р в„– РЎР‚Р В°Р В·РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р С‘ Р С‘Р В»Р С‘ РЎвЂљР ВµРЎРѓРЎвЂљР С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ:

```powershell
# Р В§Р ВµРЎР‚Р ВµР В· environment variable
$env:RATE_LIMIT_ENABLED = "0"
python api\app.py

# Р ВР В»Р С‘ Р Р† .env
RATE_LIMIT_ENABLED=0
```

РІС™В РїС‘РЏ **Р вЂ™Р Р…Р С‘Р СР В°Р Р…Р С‘Р Вµ:** Р СњР С‘Р С”Р С•Р С–Р Т‘Р В° Р Р…Р Вµ Р С•РЎвЂљР С”Р В»РЎР‹РЎвЂЎР В°Р в„–РЎвЂљР Вµ rate limiting Р Р† production!

---

### /search

Р СџР С•Р С‘РЎРѓР С” Р Р† Р С”Р В°РЎвЂљР В°Р В»Р С•Р С–Р Вµ Р С—Р С• **РЎвЂћР С‘Р Р…Р В°Р В»РЎРЉР Р…Р С•Р в„– РЎвЂ Р ВµР Р…Р Вµ** Р С‘ Р С—Р С•Р В»Р Р…Р С•РЎвЂљР ВµР С”РЎРѓРЎвЂљРЎС“:

```http
GET /search?q=<РЎРѓРЎвЂљРЎР‚Р С•Р С”Р В°>&max_price=<РЎвЂЎР С‘РЎРѓР В»Р С•>&color=<РЎвЂ Р Р†Р ВµРЎвЂљ>&region=<РЎР‚Р ВµР С–Р С‘Р С•Р Р…>&limit=<n>
```

**Р СџР В°РЎР‚Р В°Р СР ВµРЎвЂљРЎР‚РЎвЂ№:**
- `q` РІР‚вЂќ Р С—Р С•Р С‘РЎРѓР С”Р С•Р Р†РЎвЂ№Р в„– Р В·Р В°Р С—РЎР‚Р С•РЎРѓ (Р С•Р С—РЎвЂ Р С‘Р С•Р Р…Р В°Р В»РЎРЉР Р…Р С•)
- `max_price` РІР‚вЂќ Р СР В°Р С”РЎРѓР С‘Р СР В°Р В»РЎРЉР Р…Р В°РЎРЏ РЎвЂ Р ВµР Р…Р В° (РЎвЂћР С‘Р В»РЎРЉРЎвЂљРЎР‚ Р С—Р С• `price_final_rub`)
- `color`, `region`, `style` РІР‚вЂќ РЎвЂћР С‘Р В»РЎРЉРЎвЂљРЎР‚РЎвЂ№ Р С—Р С• Р В°РЎвЂљРЎР‚Р С‘Р В±РЎС“РЎвЂљР В°Р С
- `limit` РІР‚вЂќ Р С”Р С•Р В»Р С‘РЎвЂЎР ВµРЎРѓРЎвЂљР Р†Р С• РЎР‚Р ВµР В·РЎС“Р В»РЎРЉРЎвЂљР В°РЎвЂљР С•Р Р† (Р С—Р С• РЎС“Р СР С•Р В»РЎвЂЎР В°Р Р…Р С‘РЎР‹ 10)

**Р С›РЎРѓР С•Р В±Р ВµР Р…Р Р…Р С•РЎРѓРЎвЂљР С‘:**
- Р В¤Р С‘Р В»РЎРЉРЎвЂљРЎР‚ Р С—Р С• РЎвЂ Р ВµР Р…Р Вµ Р С‘Р Т‘РЎвЂРЎвЂљ Р С—Р С• `price_final_rub` (РЎвЂћР С‘Р Р…Р В°Р В»РЎРЉР Р…Р В°РЎРЏ РЎвЂ Р ВµР Р…Р В° РЎРѓ РЎС“РЎвЂЎРЎвЂРЎвЂљР С•Р С РЎРѓР С”Р С‘Р Т‘Р С”Р С‘)
- Р В Р ВµР В»Р ВµР Р†Р В°Р Р…РЎвЂљР Р…Р С•РЎРѓРЎвЂљРЎРЉ РІР‚вЂќ `pg_trgm.similarity` Р С—Р С• `search_text` (+ fallback Р С—Р С• `title_en`)

**Rate Limit:** 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ

---

### /catalog/search

Р В Р В°РЎРѓРЎв‚¬Р С‘РЎР‚Р ВµР Р…Р Р…РЎвЂ№Р в„– Р С—Р С•Р С‘РЎРѓР С” РЎРѓ Р С—Р В°Р С–Р С‘Р Р…Р В°РЎвЂ Р С‘Р ВµР в„– Р С‘ Р С•РЎРѓРЎвЂљР В°РЎвЂљР С”Р В°Р СР С‘:

```http
GET /catalog/search?q=&max_price=&color=&region=&style=&grape=&in_stock=(true|false)&limit=20&offset=0
```

**Р вЂ™Р С•Р В·Р Р†РЎР‚Р В°РЎвЂ°Р В°Р ВµРЎвЂљ:**
```json
{
  "items": [...],
  "total": 150,
  "limit": 20,
  "offset": 0,
  "query": "Р Р†Р ВµР Р…Р ВµРЎвЂљР С•"
}
```

**Р вЂќР С•Р С—Р С•Р В»Р Р…Р С‘РЎвЂљР ВµР В»РЎРЉР Р…Р С•:**
- Р СџР С•Р В»Р Вµ `in_stock` Р В±Р ВµРЎР‚РЎвЂРЎвЂљРЎРѓРЎРЏ Р С‘Р В· РЎвЂљР В°Р В±Р В»Р С‘РЎвЂ РЎвЂ№ `inventory`
- Р вЂ™РЎвЂ№РЎвЂЎР С‘РЎРѓР В»РЎРЏР ВµР СРЎвЂ№Р Вµ Р С—Р С•Р В»РЎРЏ: `stock_total`, `reserved`, `stock_free`

**Rate Limit:** 100 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ

---

### /sku/РІР‚В¦

**РІС™В РїС‘РЏ Р СћРЎР‚Р ВµР В±РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ API-Р С”Р В»РЎР‹РЎвЂЎ!**

#### Р С™Р В°РЎР‚РЎвЂљР С•РЎвЂЎР С”Р В° РЎвЂљР С•Р Р†Р В°РЎР‚Р В°

```http
GET /sku/<code>
Headers: X-API-Key: <Р Р†Р В°РЎв‚¬_Р С”Р В»РЎР‹РЎвЂЎ>
```

Р вЂ™Р С•Р В·Р Р†РЎР‚Р В°РЎвЂ°Р В°Р ВµРЎвЂљ Р Р†РЎРѓРЎР‹ Р С‘Р Р…РЎвЂћР С•РЎР‚Р СР В°РЎвЂ Р С‘РЎР‹ Р С• РЎвЂљР С•Р Р†Р В°РЎР‚Р Вµ (Р Р†Р С”Р В»РЎР‹РЎвЂЎР В°РЎРЏ `price_list_rub`, `price_final_rub`) Р С‘ РЎвЂљР ВµР С”РЎС“РЎвЂ°РЎС“РЎР‹ РЎвЂ Р ВµР Р…РЎС“ Р С‘Р В· Р С‘РЎРѓРЎвЂљР С•РЎР‚Р С‘Р С‘.

**Rate Limit:** 1000 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ (Р Т‘Р В»РЎРЏ Р С”Р В»Р С‘Р ВµР Р…РЎвЂљР С•Р Р† РЎРѓ API key)

#### Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ РЎвЂ Р ВµР Р…

```http
GET /sku/<code>/price-history?limit=50&offset=0&from=YYYY-MM-DD&to=YYYY-MM-DD
Headers: X-API-Key: <Р Р†Р В°РЎв‚¬_Р С”Р В»РЎР‹РЎвЂЎ>
```

**Rate Limit:** 1000 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ

#### Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ Р С•РЎРѓРЎвЂљР В°РЎвЂљР С”Р С•Р Р†

```http
GET /sku/<code>/inventory-history?limit=50&offset=0&from=YYYY-MM-DD&to=YYYY-MM-DD
Headers: X-API-Key: <Р Р†Р В°РЎв‚¬_Р С”Р В»РЎР‹РЎвЂЎ>
```

**Rate Limit:** 1000 Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/РЎвЂЎР В°РЎРѓ

---

### Swagger / OpenAPI

- `/docs` РІР‚вЂќ Swagger UI РЎРѓ Р С‘Р Р…РЎвЂљР ВµРЎР‚Р В°Р С”РЎвЂљР С‘Р Р†Р Р…Р С•Р в„– Р Т‘Р С•Р С”РЎС“Р СР ВµР Р…РЎвЂљР В°РЎвЂ Р С‘Р ВµР в„–
- `/openapi.json` РІР‚вЂќ OpenAPI 3.0 РЎРѓР С—Р ВµРЎвЂ Р С‘РЎвЂћР С‘Р С”Р В°РЎвЂ Р С‘РЎРЏ

**Р вЂќР С•РЎРѓРЎвЂљРЎС“Р С—:** http://127.0.0.1:18000/docs

**Р В¤РЎС“Р Р…Р С”РЎвЂ Р С‘Р С‘ Swagger UI:**
- СЂСџвЂњвЂ“ Р СџРЎР‚Р С•РЎРѓР СР С•РЎвЂљРЎР‚ Р Р†РЎРѓР ВµРЎвЂ¦ endpoints
- СЂСџвЂќвЂ™ Р СћР ВµРЎРѓРЎвЂљР С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘Р Вµ РЎРѓ API key
- СЂСџвЂњСњ Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†/Р С•РЎвЂљР Р†Р ВµРЎвЂљР С•Р Р†
- СЂСџР‹Р‡ Try it out РІР‚вЂќ Р Р†РЎвЂ№Р С—Р С•Р В»Р Р…Р ВµР Р…Р С‘Р Вµ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р† Р Р…Р В°Р С—РЎР‚РЎРЏР СРЎС“РЎР‹ Р С‘Р В· UI

---

### Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†

**PowerShell:**

```powershell
# Р СџРЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р Вµ РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљРЎвЂ№ (Р В±Р ВµР В· Р С”Р В»РЎР‹РЎвЂЎР В°)
Invoke-WebRequest -Uri "http://127.0.0.1:18000/live" | ConvertFrom-Json
Invoke-WebRequest -Uri "http://127.0.0.1:18000/ready" | ConvertFrom-Json
Invoke-WebRequest -Uri "http://127.0.0.1:18000/version" | ConvertFrom-Json
Invoke-WebRequest -Uri "http://127.0.0.1:18000/search?q=Р Р†Р ВµР Р…Р ВµРЎвЂљР С•&max_price=3000" | ConvertFrom-Json

# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° rate limit headers
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
Write-Host "Limit: $($response.Headers['X-RateLimit-Limit'])"
Write-Host "Remaining: $($response.Headers['X-RateLimit-Remaining'])"

# Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№Р в„– РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљ (РЎРѓ Р С”Р В»РЎР‹РЎвЂЎР С•Р С)
$headers = @{ "X-API-Key" = "mytestkey" }
Invoke-WebRequest -Uri "http://127.0.0.1:18000/sku/D011283" -Headers $headers | ConvertFrom-Json

# Р СћР ВµРЎРѓРЎвЂљ Р С—РЎР‚Р ВµР Р†РЎвЂ№РЎв‚¬Р ВµР Р…Р С‘РЎРЏ Р В»Р С‘Р СР С‘РЎвЂљР В° (Р Р†РЎвЂ№Р С—Р С•Р В»Р Р…Р С‘РЎвЂљР Вµ 101 РЎР‚Р В°Р В·)
1..101 | ForEach-Object {
    try {
        $r = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
        Write-Host "Request $_ : Remaining = $($r.Headers['X-RateLimit-Remaining'])" -ForegroundColor Green
    } catch {
        Write-Host "Request $_ : Rate limit exceeded (429)" -ForegroundColor Red
    }
}
```

**curl:**

```bash
# Р СџРЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р Вµ РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљРЎвЂ№
curl "http://127.0.0.1:18000/live"
curl "http://127.0.0.1:18000/ready"
curl "http://127.0.0.1:18000/version"
curl "http://127.0.0.1:18000/search?q=Р Р†Р ВµР Р…Р ВµРЎвЂљР С•&max_price=3000"

# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° rate limit headers
curl -I "http://127.0.0.1:18000/health"

# Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№Р в„– РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљ
curl -H "X-API-Key: mytestkey" http://127.0.0.1:18000/sku/D011283

# Р СћР ВµРЎРѓРЎвЂљ rate limiting
for i in {1..101}; do
  curl -w "%{http_code}\n" -o /dev/null -s "http://127.0.0.1:18000/health"
done
```

---

## Р вЂєР С•Р С–Р С‘Р С”Р В° РЎвЂ Р ВµР Р… Р С‘ РЎРѓР С”Р С‘Р Т‘Р С•Р С”

Р РЋР С‘РЎРѓРЎвЂљР ВµР СР В° РЎР‚Р В°Р В±Р С•РЎвЂљР В°Р ВµРЎвЂљ РЎРѓ **Р Т‘Р Р†РЎС“Р СРЎРЏ РЎвЂ Р ВµР Р…Р В°Р СР С‘**:

- **`price_list_rub`** РІР‚вЂќ РЎРѓР С—Р С‘РЎРѓР С•РЎвЂЎР Р…Р В°РЎРЏ РЎвЂ Р ВµР Р…Р В° Р С‘Р В· Р С—РЎР‚Р В°Р в„–РЎРѓР В° (Р С”Р С•Р В»Р С•Р Р…Р С”Р В° "Р В¦Р ВµР Р…Р В°" Р С‘Р В»Р С‘ "Р В¦Р ВµР Р…Р В° Р С—РЎР‚Р В°Р в„–РЎРѓ")
- **`price_final_rub`** РІР‚вЂќ РЎвЂћР С‘Р Р…Р В°Р В»РЎРЉР Р…Р В°РЎРЏ РЎвЂ Р ВµР Р…Р В° РЎРѓ РЎС“РЎвЂЎРЎвЂРЎвЂљР С•Р С РЎРѓР С”Р С‘Р Т‘Р С”Р С‘

### Р С›РЎвЂљР С”РЎС“Р Т‘Р В° Р В±Р ВµРЎР‚РЎвЂРЎвЂљРЎРѓРЎРЏ РЎРѓР С”Р С‘Р Т‘Р С”Р В°:

Р РЋР С”Р С‘Р Т‘Р С”Р В° Р С—РЎР‚Р С‘Р СР ВµР Р…РЎРЏР ВµРЎвЂљРЎРѓРЎРЏ Р Р† Р С—Р С•РЎР‚РЎРЏР Т‘Р С”Р Вµ Р С—РЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљР В°:

1. **Р СџРЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљ 1:** Р Р‡РЎвЂЎР ВµР в„–Р С”Р В° S5 Р Р† Excel (Р С—Р С• РЎС“Р СР С•Р В»РЎвЂЎР В°Р Р…Р С‘РЎР‹) РІР‚вЂќ Р ВµРЎРѓР В»Р С‘ Р В·Р В°Р Т‘Р В°Р Р…Р В° Р С‘Р В»Р С‘ `--prefer-discount-cell`
2. **Р СџРЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљ 2:** Р вЂ™РЎвЂљР С•РЎР‚Р В°РЎРЏ РЎРѓРЎвЂљРЎР‚Р С•Р С”Р В° Р В·Р В°Р С–Р С•Р В»Р С•Р Р†Р С”Р В° (Р ВµРЎРѓР В»Р С‘ РЎвЂљР В°Р С РЎС“Р С”Р В°Р В·Р В°Р Р… `0%`, `5%` Р С‘ РЎвЂљ.Р Т‘.)
3. **Р СџРЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљ 3:** Р С™Р С•Р В»Р С•Р Р…Р С”Р В° "Р В¦Р ВµР Р…Р В° РЎРѓР С• РЎРѓР С”Р С‘Р Т‘Р С”Р С•Р в„–" Р С‘Р В· РЎвЂћР В°Р в„–Р В»Р В°
4. **Fallback:** Р вЂўРЎРѓР В»Р С‘ РЎРѓР С”Р С‘Р Т‘Р С”Р С‘ Р Р…Р ВµРЎвЂљ РІР‚вЂќ `price_final_rub = price_list_rub`

### Р Р€Р С—РЎР‚Р В°Р Р†Р В»Р ВµР Р…Р С‘Р Вµ Р С—РЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљР С•Р С:

```powershell
# Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°РЎвЂљРЎРЉ РЎРѓР С”Р С‘Р Т‘Р С”РЎС“ Р С‘Р В· РЎРЏРЎвЂЎР ВµР в„–Р С”Р С‘ S5 (Р С—РЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљ)
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx --prefer-discount-cell

# Р ВР В»Р С‘ РЎвЂЎР ВµРЎР‚Р ВµР В· Р С—Р ВµРЎР‚Р ВµР СР ВµР Р…Р Р…РЎС“РЎР‹ Р С•Р С”РЎР‚РЎС“Р В¶Р ВµР Р…Р С‘РЎРЏ
$env:PREFER_S5 = "1"
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx

# Р ВР В·Р СР ВµР Р…Р С‘РЎвЂљРЎРЉ Р В°Р Т‘РЎР‚Р ВµРЎРѓ РЎРЏРЎвЂЎР ВµР в„–Р С”Р С‘ РЎРѓР С• РЎРѓР С”Р С‘Р Т‘Р С”Р С•Р в„–
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx --discount-cell T3
```

### Р В¤Р С•РЎР‚Р СРЎС“Р В»Р В° РЎР‚Р В°РЎРѓРЎвЂЎРЎвЂРЎвЂљР В°:

```
price_final_rub = price_list_rub Р“вЂ” (1 - discount)
```

**Р вЂ™Р В°Р В¶Р Р…Р С•:** Р вЂ™РЎРѓР Вµ API РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљРЎвЂ№ РЎвЂћР С‘Р В»РЎРЉРЎвЂљРЎР‚РЎС“РЎР‹РЎвЂљ Р С‘ РЎРѓР С•РЎР‚РЎвЂљР С‘РЎР‚РЎС“РЎР‹РЎвЂљ Р С—Р С• **РЎвЂћР С‘Р Р…Р В°Р В»РЎРЉР Р…Р С•Р в„–** РЎвЂ Р ВµР Р…Р Вµ (`price_final_rub`).

---

## CORS Configuration

### Р В§РЎвЂљР С• РЎвЂљР В°Р С”Р С•Р Вµ CORS?

CORS (Cross-Origin Resource Sharing) РІР‚вЂќ Р СР ВµРЎвЂ¦Р В°Р Р…Р С‘Р В·Р С, Р С—Р С•Р В·Р Р†Р С•Р В»РЎРЏРЎР‹РЎвЂ°Р С‘Р в„– Р В±РЎР‚Р В°РЎС“Р В·Р ВµРЎР‚Р В°Р С Р Т‘Р ВµР В»Р В°РЎвЂљРЎРЉ Р В·Р В°Р С—РЎР‚Р С•РЎРѓРЎвЂ№ Р С” API РЎРѓ Р Т‘РЎР‚РЎС“Р С–Р С‘РЎвЂ¦ Р Т‘Р С•Р СР ВµР Р…Р С•Р Р†.

**Р вЂ”Р В°РЎвЂЎР ВµР С Р Р…РЎС“Р В¶Р Р…Р С•:**
- Р СџР С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ РЎвЂћРЎР‚Р С•Р Р…РЎвЂљР ВµР Р…Р Т‘-Р С—РЎР‚Р С‘Р В»Р С•Р В¶Р ВµР Р…Р С‘Р Вµ (React, Vue, Angular)
- Р В Р В°Р В·РЎР‚Р ВµРЎв‚¬Р С‘РЎвЂљРЎРЉ Р В·Р В°Р С—РЎР‚Р С•РЎРѓРЎвЂ№ РЎРѓ `https://myapp.com` Р С” `http://api.myapp.com`
- Р вЂР ВµР В·Р С•Р С—Р В°РЎРѓР Р…Р С• Р С”Р С•Р Р…РЎвЂљРЎР‚Р С•Р В»Р С‘РЎР‚Р С•Р Р†Р В°РЎвЂљРЎРЉ, Р С”РЎвЂљР С• Р СР С•Р В¶Р ВµРЎвЂљ Р С•Р В±РЎР‚Р В°РЎвЂ°Р В°РЎвЂљРЎРЉРЎРѓРЎРЏ Р С” API

### Р СњР В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р В° РЎвЂЎР ВµРЎР‚Р ВµР В· .env
```ini
# Р В Р В°Р В·РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р В°: РЎР‚Р В°Р В·РЎР‚Р ВµРЎв‚¬Р С‘РЎвЂљРЎРЉ Р Р†РЎРѓР Вµ Р С‘РЎРѓРЎвЂљР С•РЎвЂЎР Р…Р С‘Р С”Р С‘
CORS_ORIGINS=*

# Production: РЎвЂљР С•Р В»РЎРЉР С”Р С• Р С”Р С•Р Р…Р С”РЎР‚Р ВµРЎвЂљР Р…РЎвЂ№Р Вµ Р Т‘Р С•Р СР ВµР Р…РЎвЂ№ (РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ!)
CORS_ORIGINS=https://myapp.com,https://www.myapp.com,http://localhost:3000
```

### Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ

**Р В Р В°Р В·РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р В° (РЎвЂћРЎР‚Р С•Р Р…РЎвЂљ Р Р…Р В° localhost:3000):**
```ini
CORS_ORIGINS=http://localhost:3000
```

**Production (Р Р…Р ВµРЎРѓР С”Р С•Р В»РЎРЉР С”Р С• Р Т‘Р С•Р СР ВµР Р…Р С•Р Р†):**
```ini
CORS_ORIGINS=https://myapp.com,https://api.myapp.com,https://admin.myapp.com
```

### Р СћР ВµРЎРѓРЎвЂљР С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘Р Вµ CORS

**Р ВР В· Р В±РЎР‚Р В°РЎС“Р В·Р ВµРЎР‚Р В° (JavaScript):**
```javascript
// Р С›РЎвЂљР С”РЎР‚Р С•Р в„–РЎвЂљР Вµ Р С”Р С•Р Р…РЎРѓР С•Р В»РЎРЉ Р В±РЎР‚Р В°РЎС“Р В·Р ВµРЎР‚Р В° (F12) Р Р…Р В° Р В»РЎР‹Р В±Р С•Р С РЎРѓР В°Р в„–РЎвЂљР Вµ
fetch('http://127.0.0.1:18000/health')
  .then(res => res.json())
  .then(data => console.log('РІСљвЂ¦ CORS works!', data))
  .catch(err => console.error('РІСњРЉ CORS failed:', err));
```

**Р ВР В· PowerShell:**
```powershell
# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° CORS Р В·Р В°Р С–Р С•Р В»Р С•Р Р†Р С”Р С•Р Р†
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
$response.Headers["Access-Control-Allow-Origin"]
# Р вЂќР С•Р В»Р В¶Р Р…Р С• Р Р†РЎвЂ№Р Р†Р ВµРЎРѓРЎвЂљР С‘: *
```

### Р вЂР ВµР В·Р С•Р С—Р В°РЎРѓР Р…Р С•РЎРѓРЎвЂљРЎРЉ

РІС™В РїС‘РЏ **Р вЂ™Р В°Р В¶Р Р…Р С• Р Т‘Р В»РЎРЏ Production:**
- РІСњРЉ **Р СњР Вµ Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ `CORS_ORIGINS=*` Р Р† production!**
- РІСљвЂ¦ Р Р€Р С”Р В°Р В·РЎвЂ№Р Р†Р В°Р в„–РЎвЂљР Вµ РЎвЂљР С•Р В»РЎРЉР С”Р С• Р Р…РЎС“Р В¶Р Р…РЎвЂ№Р Вµ Р Т‘Р С•Р СР ВµР Р…РЎвЂ№
- РІСљвЂ¦ Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ HTTPS Р Т‘Р В»РЎРЏ production Р Т‘Р С•Р СР ВµР Р…Р С•Р Р†
- РІСљвЂ¦ Р В Р ВµР С–РЎС“Р В»РЎРЏРЎР‚Р Р…Р С• Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЏР в„–РЎвЂљР Вµ РЎРѓР С—Р С‘РЎРѓР С•Р С” РЎР‚Р В°Р В·РЎР‚Р ВµРЎв‚¬РЎвЂР Р…Р Р…РЎвЂ№РЎвЂ¦ Р С‘РЎРѓРЎвЂљР С•РЎвЂЎР Р…Р С‘Р С”Р С•Р Р†

---

## Docker Health Monitoring

### Healthcheck Р Т‘Р В»РЎРЏ Р вЂР вЂќ

Docker Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘ Р СР С•Р Р…Р С‘РЎвЂљР С•РЎР‚Р С‘РЎвЂљ Р В·Р Т‘Р С•РЎР‚Р С•Р Р†РЎРЉР Вµ PostgreSQL:

**Р СџР В°РЎР‚Р В°Р СР ВµРЎвЂљРЎР‚РЎвЂ№:**
- **Р С™Р С•Р СР В°Р Р…Р Т‘Р В°:** `pg_isready -U postgres -d wine_db`
- **Р ВР Р…РЎвЂљР ВµРЎР‚Р Р†Р В°Р В»:** Р С™Р В°Р В¶Р Т‘РЎвЂ№Р Вµ 10 РЎРѓР ВµР С”РЎС“Р Р…Р Т‘
- **Timeout:** 5 РЎРѓР ВµР С”РЎС“Р Р…Р Т‘
- **Retries:** 5 Р С—Р С•Р С—РЎвЂ№РЎвЂљР С•Р С” Р Т‘Р С• Р С—РЎР‚Р С‘Р В·Р Р…Р В°Р Р…Р С‘РЎРЏ unhealthy
- **Start period:** 10 РЎРѓР ВµР С”РЎС“Р Р…Р Т‘ Р С–РЎР‚Р ВµР в„–РЎРѓ-Р С—Р ВµРЎР‚Р С‘Р С•Р Т‘ Р С—Р С•РЎРѓР В»Р Вµ РЎРѓРЎвЂљР В°РЎР‚РЎвЂљР В°

**Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓР В°:**
```powershell
# Р РЋРЎвЂљР В°РЎвЂљРЎС“РЎРѓ Р С”Р С•Р Р…РЎвЂљР ВµР в„–Р Р…Р ВµРЎР‚Р С•Р Р† (Р Т‘Р С•Р В»Р В¶Р ВµР Р… Р В±РЎвЂ№РЎвЂљРЎРЉ "healthy")
docker compose ps

# Р вЂќР ВµРЎвЂљР В°Р В»РЎРЉР Р…Р В°РЎРЏ Р С‘Р Р…РЎвЂћР С•РЎР‚Р СР В°РЎвЂ Р С‘РЎРЏ Р С• health checks
docker inspect wine_assistant-db-1 --format='{{.State.Health.Status}}'

# Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ Р С—Р С•РЎРѓР В»Р ВµР Т‘Р Р…Р С‘РЎвЂ¦ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С•Р С”
docker inspect wine_assistant-db-1 --format='{{json .State.Health.Log}}' | ConvertFrom-Json | Select-Object -First 3
```

### Р С’Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р в„– Р С—Р ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓР С”

Р С›Р В±Р В° РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓР В° Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р ВµР Р…РЎвЂ№ РЎРѓ `restart: unless-stopped`:

**Р С™Р С•Р С–Р Т‘Р В° Р С”Р С•Р Р…РЎвЂљР ВµР в„–Р Р…Р ВµРЎР‚РЎвЂ№ Р С—Р ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓРЎвЂљРЎРЏРЎвЂљРЎРѓРЎРЏ Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘:**
- РІСљвЂ¦ Р СџРЎР‚Р С‘ РЎРѓР В±Р С•Р Вµ Р С—РЎР‚Р С•РЎвЂ Р ВµРЎРѓРЎРѓР В° (crash)
- РІСљвЂ¦ Р СџРЎР‚Р С‘ Р С•РЎв‚¬Р С‘Р В±Р С”Р Вµ Р Р† Р С”Р С•Р Р…РЎвЂљР ВµР в„–Р Р…Р ВµРЎР‚Р Вµ
- РІСљвЂ¦ Р СџРЎР‚Р С‘ Р С—Р ВµРЎР‚Р ВµР В·Р В°Р С–РЎР‚РЎС“Р В·Р С”Р Вµ РЎвЂ¦Р С•РЎРѓРЎвЂљР В° Docker

**Р С™Р С•Р С–Р Т‘Р В° Р СњР вЂў Р С—Р ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓРЎвЂљРЎРЏРЎвЂљРЎРѓРЎРЏ:**
- РІСњРЉ Р СџР С•РЎРѓР В»Р Вµ `docker stop` (РЎР‚РЎС“РЎвЂЎР Р…Р В°РЎРЏ Р С•РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С”Р В°)
- РІСњРЉ Р СџР С•РЎРѓР В»Р Вµ `docker compose stop`
- РІСњРЉ Р СџР С•РЎРѓР В»Р Вµ `docker compose down`

### Р вЂ”Р В°Р Р†Р С‘РЎРѓР С‘Р СР С•РЎРѓРЎвЂљР С‘ РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓР С•Р Р†

Adminer Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р ВµР Р… РЎРѓ `depends_on` Р С‘ РЎС“РЎРѓР В»Р С•Р Р†Р С‘Р ВµР С `service_healthy`:
```yaml
depends_on:
  db:
    condition: service_healthy
```

**Р В Р ВµР В·РЎС“Р В»РЎРЉРЎвЂљР В°РЎвЂљ:** Adminer Р В·Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљРЎРѓРЎРЏ РЎвЂљР С•Р В»РЎРЉР С”Р С• Р С—Р С•РЎРѓР В»Р Вµ РЎвЂљР С•Р С–Р С•, Р С”Р В°Р С” Р вЂР вЂќ РЎРѓРЎвЂљР В°Р Р…Р ВµРЎвЂљ `healthy`.

---

## Docker API Service

### Р вЂ”Р В°Р С—РЎС“РЎРѓР С” РЎвЂЎР ВµРЎР‚Р ВµР В· Docker Compose

API РЎвЂљР ВµР С—Р ВµРЎР‚РЎРЉ Р Т‘Р С•РЎРѓРЎвЂљРЎС“Р С—Р ВµР Р… Р С”Р В°Р С” Р С•РЎвЂљР Т‘Р ВµР В»РЎРЉР Р…РЎвЂ№Р в„– РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓ Р Р† Docker:
```powershell
# Р вЂ”Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљРЎРЉ Р Р†РЎРѓР Вµ РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓРЎвЂ№
docker compose up -d

# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С‘РЎвЂљРЎРЉ РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓ
docker compose ps

# Р вЂєР С•Р С–Р С‘ API
docker compose logs -f api

# Р С›РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С‘РЎвЂљРЎРЉ
docker compose down
```

### Р С’РЎР‚РЎвЂ¦Р С‘РЎвЂљР ВµР С”РЎвЂљРЎС“РЎР‚Р В°
```
Docker Compose:
РІвЂќСљРІвЂќР‚ db (PostgreSQL + pgvector)
РІвЂќвЂљ  РІвЂќвЂќРІвЂќР‚ Healthcheck: pg_isready
РІвЂќСљРІвЂќР‚ adminer (Database UI)
РІвЂќвЂљ  РІвЂќвЂќРІвЂќР‚ Р вЂ”Р В°Р Р†Р С‘РЎРѓР С‘РЎвЂљ Р С•РЎвЂљ: db (healthy)
РІвЂќвЂќРІвЂќР‚ api (Flask API)
   РІвЂќСљРІвЂќР‚ Р вЂ”Р В°Р Р†Р С‘РЎРѓР С‘РЎвЂљ Р С•РЎвЂљ: db (healthy)
   РІвЂќвЂќРІвЂќР‚ Healthcheck: curl /ready
```

### Healthcheck Р Т‘Р В»РЎРЏ API

API Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р ВµР Р… РЎРѓ Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р С healthcheck:

**Р СџР В°РЎР‚Р В°Р СР ВµРЎвЂљРЎР‚РЎвЂ№:**
- **Р С™Р С•Р СР В°Р Р…Р Т‘Р В°:** `curl -f http://localhost:8000/ready`
- **Р ВР Р…РЎвЂљР ВµРЎР‚Р Р†Р В°Р В»:** 30 РЎРѓР ВµР С”РЎС“Р Р…Р Т‘
- **Timeout:** 10 РЎРѓР ВµР С”РЎС“Р Р…Р Т‘
- **Retries:** 3 Р С—Р С•Р С—РЎвЂ№РЎвЂљР С”Р С‘
- **Start period:** 40 РЎРѓР ВµР С”РЎС“Р Р…Р Т‘ (Р Р†РЎР‚Р ВµР СРЎРЏ Р Р…Р В° Р С‘Р Р…Р С‘РЎвЂ Р С‘Р В°Р В»Р С‘Р В·Р В°РЎвЂ Р С‘РЎР‹)

**Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В° РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓР В°:**
```powershell
# Р РЋРЎвЂљР В°РЎвЂљРЎС“РЎРѓ Р Р†РЎРѓР ВµРЎвЂ¦ РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓР С•Р Р† (Р Т‘Р С•Р В»Р В¶Р ВµР Р… Р В±РЎвЂ№РЎвЂљРЎРЉ "healthy")
docker compose ps

# Р вЂќР ВµРЎвЂљР В°Р В»РЎРЉР Р…Р В°РЎРЏ Р С‘Р Р…РЎвЂћР С•РЎР‚Р СР В°РЎвЂ Р С‘РЎРЏ Р С• health checks
docker inspect wine_assistant-api-1 --format='{{.State.Health.Status}}'

# Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ Р С—Р С•РЎРѓР В»Р ВµР Т‘Р Р…Р С‘РЎвЂ¦ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С•Р С”
docker inspect wine_assistant-api-1 --format='{{json .State.Health.Log}}' | ConvertFrom-Json | Select-Object -First 3
```

### Р СџР ВµРЎР‚Р ВµР СР ВµР Р…Р Р…РЎвЂ№Р Вµ Р С•Р С”РЎР‚РЎС“Р В¶Р ВµР Р…Р С‘РЎРЏ

API Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р ВµРЎвЂљ РЎРѓР В»Р ВµР Т‘РЎС“РЎР‹РЎвЂ°Р С‘Р Вµ Р С—Р ВµРЎР‚Р ВµР СР ВµР Р…Р Р…РЎвЂ№Р Вµ Р С‘Р В· `.env`:
```ini
# API Service
FLASK_PORT=18000          # Р СџР С•РЎР‚РЎвЂљ Р Р…Р В° РЎвЂ¦Р С•РЎРѓРЎвЂљР Вµ (Р Р†Р Р…РЎС“РЎвЂљРЎР‚Р С‘ Р С”Р С•Р Р…РЎвЂљР ВµР в„–Р Р…Р ВµРЎР‚Р В° Р Р†РЎРѓР ВµР С–Р Т‘Р В° 8000)
API_KEY=your_secret_key   # API Р С”Р В»РЎР‹РЎвЂЎ Р Т‘Р В»РЎРЏ Р В·Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№РЎвЂ¦ РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљР С•Р Р†
APP_VERSION=0.4.0         # Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ API
LOG_LEVEL=INFO            # Р Р€РЎР‚Р С•Р Р†Р ВµР Р…РЎРЉ Р В»Р С•Р С–Р С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ (DEBUG/INFO/WARN/ERROR)
CORS_ORIGINS=*            # CORS origins (Р Т‘Р В»РЎРЏ production РЎС“Р С”Р В°Р В·Р В°РЎвЂљРЎРЉ Р С”Р С•Р Р…Р С”РЎР‚Р ВµРЎвЂљР Р…РЎвЂ№Р Вµ)

# Rate Limiting (Р Р…Р С•Р Р†Р С•Р Вµ Р Р† v0.4.0)
RATE_LIMIT_ENABLED=1                    # Р вЂ™Р С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ/Р Р†РЎвЂ№Р С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ
RATE_LIMIT_PUBLIC=100/hour             # Р СџРЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р Вµ endpoints
RATE_LIMIT_PROTECTED=1000/hour         # Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№Р Вµ endpoints

# Database (Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ Р Т‘Р В»РЎРЏ Р С—Р С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘РЎРЏ)
PGHOST=db                 # Р вЂ™ Docker Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ Р С‘Р СРЎРЏ РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓР В°
PGPORT=5432               # Р вЂ™Р Р…РЎС“РЎвЂљРЎР‚Р ВµР Р…Р Р…Р С‘Р в„– Р С—Р С•РЎР‚РЎвЂљ Р вЂР вЂќ
PGUSER=postgres
PGPASSWORD=dev_local_pw
PGDATABASE=wine_db
```

### Endpoints Р Т‘Р С•РЎРѓРЎвЂљРЎС“Р С—Р Р…РЎвЂ№Р Вµ Р Р† Docker

Р СџР С•РЎРѓР В»Р Вµ Р В·Р В°Р С—РЎС“РЎРѓР С”Р В° API Р Т‘Р С•РЎРѓРЎвЂљРЎС“Р С—Р ВµР Р… Р Р…Р В°:

- **Р СџРЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р Вµ:**
  - http://127.0.0.1:18000/health РІР‚вЂќ Р вЂР В°Р В·Р С•Р Р†Р В°РЎРЏ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р В°
  - http://127.0.0.1:18000/live РІР‚вЂќ Liveness probe
  - http://127.0.0.1:18000/ready РІР‚вЂќ Readiness probe
  - http://127.0.0.1:18000/version РІР‚вЂќ Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ API
  - http://127.0.0.1:18000/search РІР‚вЂќ Р СџР С•Р С‘РЎРѓР С” Р Р†Р С‘Р Р…
  - http://127.0.0.1:18000/catalog/search РІР‚вЂќ Р В Р В°РЎРѓРЎв‚¬Р С‘РЎР‚Р ВµР Р…Р Р…РЎвЂ№Р в„– Р С—Р С•Р С‘РЎРѓР С”
  - http://127.0.0.1:18000/docs РІР‚вЂќ Swagger UI

- **Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№Р Вµ (РЎвЂљРЎР‚Р ВµР В±РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ X-API-Key):**
  - http://127.0.0.1:18000/sku/{code} РІР‚вЂќ Р С™Р В°РЎР‚РЎвЂљР С•РЎвЂЎР С”Р В° РЎвЂљР С•Р Р†Р В°РЎР‚Р В°
  - http://127.0.0.1:18000/sku/{code}/price-history РІР‚вЂќ Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ РЎвЂ Р ВµР Р…
  - http://127.0.0.1:18000/sku/{code}/inventory-history РІР‚вЂќ Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ Р С•РЎРѓРЎвЂљР В°РЎвЂљР С”Р С•Р Р†

### Troubleshooting

#### API unhealthy Р С‘Р В»Р С‘ Р Р…Р Вµ Р В·Р В°Р С—РЎС“РЎРѓР С”Р В°Р ВµРЎвЂљРЎРѓРЎРЏ
```powershell
# 1. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ Р В»Р С•Р С–Р С‘ API
docker compose logs api

# 2. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ, РЎвЂЎРЎвЂљР С• Р вЂР вЂќ healthy
docker compose ps db

# 3. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ Р С—Р С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘Р Вµ Р С” Р вЂР вЂќ Р С‘Р В·Р Р…РЎС“РЎвЂљРЎР‚Р С‘ Р С”Р С•Р Р…РЎвЂљР ВµР в„–Р Р…Р ВµРЎР‚Р В°
docker compose exec api python -c "import psycopg2; print(psycopg2.connect('host=db dbname=wine_db user=postgres password=dev_local_pw'))"

# 4. Р СџР ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљР Вµ РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓ
docker compose restart api

# 5. Р СџР ВµРЎР‚Р ВµРЎРѓР С•Р В·Р Т‘Р В°Р в„–РЎвЂљР Вµ Р С”Р С•Р Р…РЎвЂљР ВµР в„–Р Р…Р ВµРЎР‚РЎвЂ№
docker compose down
docker compose up -d --build
```

#### API Р С—Р С•Р С”Р В°Р В·РЎвЂ№Р Р†Р В°Р ВµРЎвЂљ РЎРѓРЎвЂљР В°РЎР‚РЎС“РЎР‹ Р Р†Р ВµРЎР‚РЎРѓР С‘РЎР‹
```powershell
# Р СџР ВµРЎР‚Р ВµРЎРѓР С•Р В±Р ВµРЎР‚Р С‘РЎвЂљР Вµ Р С•Р В±РЎР‚Р В°Р В·
docker compose build --no-cache api
docker compose up -d
```

#### Р СџР С•РЎР‚РЎвЂљ 18000 Р В·Р В°Р Р…РЎРЏРЎвЂљ
```powershell
# Р ВР В·Р СР ВµР Р…Р С‘РЎвЂљР Вµ Р С—Р С•РЎР‚РЎвЂљ Р Р† .env
FLASK_PORT=18001

# Р СџР ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљР Вµ
docker compose down
docker compose up -d
```

### Production Deployment

Р вЂќР В»РЎРЏ production Р С•Р С”РЎР‚РЎС“Р В¶Р ВµР Р…Р С‘РЎРЏ:

1. **Р ВР В·Р СР ВµР Р…Р С‘РЎвЂљР Вµ Flask Р Р…Р В° Gunicorn:**
```dockerfile
   # Р вЂ™ Dockerfile Р В·Р В°Р СР ВµР Р…Р С‘РЎвЂљР Вµ CMD Р Р…Р В°:
   CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:8000", "api.app:app"]
```

2. **Р Р€РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С‘РЎвЂљР Вµ Gunicorn:**
```
   # Р вЂ™ requirements.txt Р Т‘Р С•Р В±Р В°Р Р†РЎРЉРЎвЂљР Вµ:
   gunicorn==21.2.0
```

3. **Р СњР В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–РЎвЂљР Вµ environment variables:**
```ini
   FLASK_DEBUG=0
   LOG_LEVEL=INFO
   CORS_ORIGINS=https://yourdomain.com
   RATE_LIMIT_STORAGE_URL=redis://redis:6379/0
```

4. **Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ secrets Р Т‘Р В»РЎРЏ Р С—Р В°РЎР‚Р С•Р В»Р ВµР в„–:**
   - Р СњР Вµ РЎвЂ¦РЎР‚Р В°Р Р…Р С‘РЎвЂљР Вµ Р С—Р В°РЎР‚Р С•Р В»Р С‘ Р Р† `.env` Р Р† production
   - Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ Docker secrets Р С‘Р В»Р С‘ AWS Secrets Manager

---

## Adminer (SQL UI)

**URL:** http://localhost:18080

**Р СџР В°РЎР‚Р В°Р СР ВµРЎвЂљРЎР‚РЎвЂ№ Р С—Р С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘РЎРЏ:**
- **System:** PostgreSQL
- **Server:** `db` (Р Р†Р Р…РЎС“РЎвЂљРЎР‚Р С‘ docker-РЎРѓР ВµРЎвЂљР С‘)
- **User:** `postgres`
- **Password:** `dev_local_pw`
- **Database:** `wine_db`

**Р вЂќР В»РЎРЏ Р С—Р С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎР ВµР Р…Р С‘РЎРЏ РЎРѓ РЎвЂ¦Р С•РЎРѓРЎвЂљР В° (psql):**
```bash
psql -h 127.0.0.1 -p 15432 -U postgres -d wine_db
```

---

## Р СљР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р вЂР вЂќ

**SQL-Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘:** `db/migrations/*.sql`

**Р СџРЎР‚Р С•Р С–Р С•Р Р…:**

```powershell
powershell -ExecutionPolicy Bypass -File .\scripts\migrate.ps1
```

**Р СљР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р Р…Р В°Р С”Р В°РЎвЂљРЎвЂ№Р Р†Р В°РЎР‹РЎвЂљ:**
- Advanced constraints (EXCLUDE Р Т‘Р В»РЎРЏ Р В·Р В°Р С—РЎР‚Р ВµРЎвЂљР В° Р С—Р ВµРЎР‚Р ВµР С”РЎР‚РЎвЂ№РЎвЂљР С‘Р в„– Р Р†РЎР‚Р ВµР СР ВµР Р…Р Р…РЎвЂ№РЎвЂ¦ Р С‘Р Р…РЎвЂљР ВµРЎР‚Р Р†Р В°Р В»Р С•Р Р†)
- Р СњР С•РЎР‚Р СР В°Р В»Р С‘Р В·Р В°РЎвЂ Р С‘РЎР‹ Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦ (effective_to Р Р† product_prices)
- Р вЂќР С‘Р В°Р С–Р Р…Р С•РЎРѓРЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р Вµ Р В·Р В°Р С—РЎР‚Р С•РЎРѓРЎвЂ№ Р Т‘Р В»РЎРЏ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р С‘ РЎвЂ Р ВµР В»Р С•РЎРѓРЎвЂљР Р…Р С•РЎРѓРЎвЂљР С‘
- Production-РЎРѓР С—Р ВµРЎвЂ Р С‘РЎвЂћР С‘РЎвЂЎР Р…РЎвЂ№Р Вµ Р С•Р С—РЎвЂљР С‘Р СР С‘Р В·Р В°РЎвЂ Р С‘Р С‘

**Р СџРЎР‚Р С‘Р СР ВµРЎвЂЎР В°Р Р…Р С‘Р Вµ:** `db/init.sql` РЎРѓР С•Р Т‘Р ВµРЎР‚Р В¶Р С‘РЎвЂљ Р В±Р В°Р В·Р С•Р Р†РЎС“РЎР‹ Р С—Р С•Р В»Р Р…РЎС“РЎР‹ РЎРѓРЎвЂ¦Р ВµР СРЎС“ Р Т‘Р В»РЎРЏ РЎР‚Р В°Р В·РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р С‘. Р СљР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р Т‘Р С•Р В±Р В°Р Р†Р В»РЎРЏРЎР‹РЎвЂљ Р Т‘Р С•Р С—Р С•Р В»Р Р…Р С‘РЎвЂљР ВµР В»РЎРЉР Р…РЎвЂ№Р Вµ guardrails, Р Р…Р ВµР С•Р В±РЎвЂ¦Р С•Р Т‘Р С‘Р СРЎвЂ№Р Вµ Р Т‘Р В»РЎРЏ production.

---

## ETL / Р В·Р В°Р С–РЎР‚РЎС“Р В·РЎвЂЎР С‘Р С”

**Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ РЎвЂљР С•Р В»РЎРЉР С”Р С• `scripts/load_csv.py`** Р Т‘Р В»РЎРЏ Р Р†РЎРѓР ВµРЎвЂ¦ Р В·Р В°Р Т‘Р В°РЎвЂЎ Р В·Р В°Р С–РЎР‚РЎС“Р В·Р С”Р С‘ Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦.

### Р вЂ™Р С•Р В·Р СР С•Р В¶Р Р…Р С•РЎРѓРЎвЂљР С‘:

- Р СџР С•Р Т‘Р Т‘Р ВµРЎР‚Р В¶Р С‘Р Р†Р В°Р ВµРЎвЂљ Excel Р С‘ CSV
- Р С’Р Р†РЎвЂљР С•Р С•Р С—РЎР‚Р ВµР Т‘Р ВµР В»РЎРЏР ВµРЎвЂљ РЎРѓРЎвЂљРЎР‚Р С•Р С”РЎС“ Р В·Р В°Р С–Р С•Р В»Р С•Р Р†Р С”Р В° (Р Т‘Р В°Р В¶Р Вµ Р Р† Р СР Р…Р С•Р С–Р С•РЎРѓРЎвЂљРЎР‚Р С•РЎвЂЎР Р…РЎвЂ№РЎвЂ¦ РЎв‚¬Р В°Р С—Р С”Р В°РЎвЂ¦)
- Р ВР В·Р Р†Р В»Р ВµР С”Р В°Р ВµРЎвЂљ РЎРѓР С”Р С‘Р Т‘Р С”РЎС“ Р С‘Р В· РЎРЏРЎвЂЎР ВµР в„–Р С”Р С‘ Excel (Р С—Р С• РЎС“Р СР С•Р В»РЎвЂЎР В°Р Р…Р С‘РЎР‹ S5)
- Р СњР С•РЎР‚Р СР В°Р В»Р С‘Р В·РЎС“Р ВµРЎвЂљ Р С”Р С•Р Т‘РЎвЂ№ РЎвЂљР С•Р Р†Р В°РЎР‚Р С•Р Р† (Р Р†Р В°Р В»Р С‘Р Т‘Р В°РЎвЂ Р С‘РЎРЏ Р С—Р С• regex)
- Р вЂ”Р В°Р С—Р С‘РЎРѓРЎвЂ№Р Р†Р В°Р ВµРЎвЂљ Р Т‘Р В°Р Р…Р Р…РЎвЂ№Р Вµ Р Р†:
  - `products` (Р С•Р В±Р В° РЎвЂљР С‘Р С—Р В° РЎвЂ Р ВµР Р…, Р В°РЎвЂљРЎР‚Р С‘Р В±РЎС“РЎвЂљРЎвЂ№)
  - `product_prices` (Р С‘РЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ РЎвЂ Р ВµР Р…)
  - `inventory` Р С‘ `inventory_history` (Р С•РЎРѓРЎвЂљР В°РЎвЂљР С”Р С‘/РЎР‚Р ВµР В·Р ВµРЎР‚Р Р†РЎвЂ№/РЎРѓР Р†Р С•Р В±Р С•Р Т‘Р Р…РЎвЂ№Р в„– Р С•РЎРѓРЎвЂљР В°РЎвЂљР С•Р С”)

### Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ:

```powershell
# Р вЂ”Р В°Р С–РЎР‚РЎС“Р В·Р С”Р В° РЎРѓ Р Т‘Р В°РЎвЂљР С•Р в„– РЎРѓРЎР‚Р ВµР В·Р В° (Р Т‘Р В»РЎРЏ Р С‘РЎРѓРЎвЂљР С•РЎР‚Р С‘Р С‘)
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx --asof 2025-01-15

# Р Р€Р С”Р В°Р В·Р В°РЎвЂљРЎРЉ Р Т‘РЎР‚РЎС“Р С–РЎС“РЎР‹ РЎРЏРЎвЂЎР ВµР в„–Р С”РЎС“ РЎРѓР С• РЎРѓР С”Р С‘Р Т‘Р С”Р С•Р в„–
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx --discount-cell T3

# Р Р€Р С”Р В°Р В·Р В°РЎвЂљРЎРЉ Р С”Р С•Р Р…Р С”РЎР‚Р ВµРЎвЂљР Р…РЎвЂ№Р в„– Р В»Р С‘РЎРѓРЎвЂљ
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx --sheet "Р С›РЎРѓР Р…Р С•Р Р†Р Р…Р С•Р в„–"
```

СЂСџвЂњСњ **Р Р€РЎРѓРЎвЂљР В°РЎР‚Р ВµР Р†РЎв‚¬Р С‘Р в„– РЎРѓР С”РЎР‚Р С‘Р С—РЎвЂљ:** `etl/run_daily.py` Р С•РЎРѓРЎвЂљР В°Р Р†Р В»Р ВµР Р… Р Т‘Р В»РЎРЏ РЎРѓР С•Р Р†Р СР ВµРЎРѓРЎвЂљР С‘Р СР С•РЎРѓРЎвЂљР С‘, Р Р…Р С• РЎвЂћРЎС“Р Р…Р С”РЎвЂ Р С‘Р С•Р Р…Р В°Р В» Р С•Р С–РЎР‚Р В°Р Р…Р С‘РЎвЂЎР ВµР Р…. Р В Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°РЎвЂљРЎРЉ `scripts/load_csv.py`.

---

## СЂСџвЂќВ§ Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ Р С—РЎР‚Р С•Р В±Р В»Р ВµР С

### Р С›РЎв‚¬Р С‘Р В±Р С”Р В°: `column "price_final_rub" does not exist`

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Р В Р В°Р В±Р С•РЎвЂљР В°Р ВµРЎвЂљР Вµ РЎРѓР С• РЎРѓРЎвЂљР В°РЎР‚Р С•Р в„– Р Р†Р ВµРЎР‚РЎРѓР С‘Р ВµР в„– Р вЂР вЂќ (РЎРѓР С•Р В·Р Т‘Р В°Р Р…Р Р…Р С•Р в„– Р Т‘Р С• Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљР В° 1).

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# Р вЂ™Р В°РЎР‚Р С‘Р В°Р Р…РЎвЂљ 1: Р СџР ВµРЎР‚Р ВµРЎРѓР С•Р В·Р Т‘Р В°РЎвЂљРЎРЉ Р вЂР вЂќ (РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ)
docker compose down -v
docker compose up -d

# Р вЂ™Р В°РЎР‚Р С‘Р В°Р Р…РЎвЂљ 2: Р СџРЎР‚Р С‘Р СР ВµР Р…Р С‘РЎвЂљРЎРЉ Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘ Р Р…Р В° РЎРѓРЎС“РЎвЂ°Р ВµРЎРѓРЎвЂљР Р†РЎС“РЎР‹РЎвЂ°РЎС“РЎР‹ Р вЂР вЂќ
powershell -ExecutionPolicy Bypass -File .\scripts\migrate.ps1
```

---

### Р С›РЎв‚¬Р С‘Р В±Р С”Р В°: `403 Forbidden` Р Р…Р В° `/sku/<code>`

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Р В­Р Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљ РЎвЂљРЎР‚Р ВµР В±РЎС“Р ВµРЎвЂљ API-Р С”Р В»РЎР‹РЎвЂЎ.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# PowerShell
$headers = @{ "X-API-Key" = "mytestkey" }
Invoke-WebRequest -Uri "http://127.0.0.1:18000/sku/D011283" -Headers $headers

# curl
curl -H "X-API-Key: mytestkey" http://127.0.0.1:18000/sku/D011283
```

Р Р€Р В±Р ВµР Т‘Р С‘РЎвЂљР ВµРЎРѓРЎРЉ, РЎвЂЎРЎвЂљР С• Р Р† `.env` РЎС“РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р В»Р ВµР Р… `API_KEY`.

---

### Р С›РЎв‚¬Р С‘Р В±Р С”Р В°: `429 Too Many Requests` СЂСџвЂ вЂў

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Р СџРЎР‚Р ВµР Р†РЎвЂ№РЎв‚¬Р ВµР Р… Р В»Р С‘Р СР С‘РЎвЂљ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# 1. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ headers Р Р† Р С—РЎР‚Р ВµР Т‘РЎвЂ№Р Т‘РЎС“РЎвЂ°Р ВµР С РЎС“РЎРѓР С—Р ВµРЎв‚¬Р Р…Р С•Р С Р С•РЎвЂљР Р†Р ВµРЎвЂљР Вµ
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
Write-Host "Remaining: $($response.Headers['X-RateLimit-Remaining'])"
Write-Host "Reset at: $($response.Headers['X-RateLimit-Reset'])"

# 2. Р СџР С•Р Т‘Р С•Р В¶Р Т‘Р С‘РЎвЂљР Вµ Р Т‘Р С• РЎРѓР В±РЎР‚Р С•РЎРѓР В° РЎРѓРЎвЂЎРЎвЂРЎвЂљРЎвЂЎР С‘Р С”Р В° (Р Р†РЎР‚Р ВµР СРЎРЏ Р Р† Unix timestamp)
# Р ВР В»Р С‘ РЎС“Р Р†Р ВµР В»Р С‘РЎвЂЎРЎРЉРЎвЂљР Вµ Р В»Р С‘Р СР С‘РЎвЂљРЎвЂ№ Р Р† .env:
$env:RATE_LIMIT_PUBLIC = "1000/hour"
docker compose restart api

# 3. Р вЂ™РЎР‚Р ВµР СР ВµР Р…Р Р…Р С• Р С•РЎвЂљР С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљРЎРЉ rate limiting (РЎвЂљР С•Р В»РЎРЉР С”Р С• Р Т‘Р В»РЎРЏ dev!)
$env:RATE_LIMIT_ENABLED = "0"
docker compose restart api
```

---

### Р С›РЎв‚¬Р С‘Р В±Р С”Р В°: `/ready` Р Р†Р С•Р В·Р Р†РЎР‚Р В°РЎвЂ°Р В°Р ВµРЎвЂљ 503

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Р вЂР В°Р В·Р В° Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦ Р Р…Р ВµР Т‘Р С•РЎРѓРЎвЂљРЎС“Р С—Р Р…Р В° Р С‘Р В»Р С‘ Р Р…Р Вµ Р С—РЎР‚Р С•РЎв‚¬Р В»Р В° Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р С‘.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# 1. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ, РЎвЂЎРЎвЂљР С• Р вЂР вЂќ Р В·Р В°Р С—РЎС“РЎвЂ°Р ВµР Р…Р В°
docker compose ps

# 2. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ Р Т‘Р ВµРЎвЂљР В°Р В»Р С‘ Р С•РЎв‚¬Р С‘Р В±Р С”Р С‘
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/ready" -SkipHttpErrorCheck
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 5

# 3. Р вЂ”Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљР Вµ Р вЂР вЂќ, Р ВµРЎРѓР В»Р С‘ Р С•РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р В»Р ВµР Р…Р В°
docker compose up -d

# 4. Р СџРЎР‚Р С‘Р СР ВµР Р…Р С‘РЎвЂљР Вµ Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘Р С‘, Р ВµРЎРѓР В»Р С‘ Р Р…Р Вµ Р С—РЎР‚Р С‘Р СР ВµР Р…Р ВµР Р…РЎвЂ№
powershell -ExecutionPolicy Bypass -File .\scripts\migrate.ps1
```

---

### Adminer Р Р…Р Вµ Р С—Р С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎР В°Р ВµРЎвЂљРЎРѓРЎРЏ Р С” Р вЂР вЂќ

**Р СџРЎР‚Р С•Р В±Р В»Р ВµР СР В°:** Р СњР ВµР Р†Р ВµРЎР‚Р Р…РЎвЂ№Р в„– Server Р С‘Р В»Р С‘ Р С—Р С•РЎР‚РЎвЂљ.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
- **Р вЂ™Р Р…РЎС“РЎвЂљРЎР‚Р С‘ Docker:** Server = `db` (Р Р…Р Вµ `host.docker.internal`)
- **URL:** http://localhost:18080 (Р Р…Р Вµ 8080)
- **Password:** `dev_local_pw` (Р С‘Р В· `.env` РІвЂ вЂ™ `POSTGRES_PASSWORD`)

---

### Р В¦Р ВµР Р…РЎвЂ№ Р Р…Р Вµ РЎРѓР С•Р Р†Р С—Р В°Р Т‘Р В°РЎР‹РЎвЂљ РЎРѓ Р С—РЎР‚Р В°Р в„–РЎРѓР С•Р С

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Р РЋР С”Р С‘Р Т‘Р С”Р В° Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘ Р С—РЎР‚Р С‘Р СР ВµР Р…РЎРЏР ВµРЎвЂљРЎРѓРЎРЏ Р С‘Р В· РЎРЏРЎвЂЎР ВµР в„–Р С”Р С‘ S5 Р С‘Р В»Р С‘ РЎв‚¬Р В°Р С—Р С”Р С‘ РЎвЂћР В°Р в„–Р В»Р В°.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ РЎРЏРЎвЂЎР ВµР в„–Р С”РЎС“ S5 Р Р† Excel (РЎвЂљР В°Р С Р СР С•Р В¶Р ВµРЎвЂљ Р В±РЎвЂ№РЎвЂљРЎРЉ РЎРѓР С”Р С‘Р Т‘Р С”Р В° %, Р Р…Р В°Р С—РЎР‚Р С‘Р СР ВµРЎР‚ 10)
# Р ВР В·Р СР ВµР Р…Р С‘РЎвЂљР Вµ Р С—РЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљ Р С‘РЎРѓРЎвЂљР С•РЎвЂЎР Р…Р С‘Р С”Р В° РЎРѓР С”Р С‘Р Т‘Р С”Р С‘:
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx --prefer-discount-cell

# Р ВР В»Р С‘ Р С•РЎвЂљР С”Р В»РЎР‹РЎвЂЎР С‘РЎвЂљР Вµ Р С—РЎР‚Р С‘Р С•РЎР‚Р С‘РЎвЂљР ВµРЎвЂљ S5:
$env:PREFER_S5 = "0"
python scripts\load_csv.py --excel Р СџРЎР‚Р В°Р в„–РЎРѓ.xlsx
```

---

### API Р Р…Р Вµ Р С•РЎвЂљР Р†Р ВµРЎвЂЎР В°Р ВµРЎвЂљ Р Р…Р В° Р С—Р С•РЎР‚РЎвЂљРЎС“ 8000

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Р СњР ВµРЎРѓРЎвЂљР В°Р Р…Р Т‘Р В°РЎР‚РЎвЂљР Р…РЎвЂ№Р в„– Р С—Р С•РЎР‚РЎвЂљ Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р ВµР Р… Р Р† `.env`.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
- Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ `.env` РІвЂ вЂ™ `FLASK_PORT=18000`
- URL Р Т‘Р С•Р В»Р В¶Р ВµР Р… Р В±РЎвЂ№РЎвЂљРЎРЉ: http://127.0.0.1:18000 (Р Р…Р Вµ 8000)

---

### CSV Р В·Р В°Р С–РЎР‚РЎС“Р В¶Р В°Р ВµРЎвЂљРЎРѓРЎРЏ Р Р…Р Вµ Р С—Р С•Р В»Р Р…Р С•РЎРѓРЎвЂљРЎРЉРЎР‹ (Р С—РЎР‚Р С•Р С—РЎС“РЎРѓР С”Р В°РЎР‹РЎвЂљРЎРѓРЎРЏ РЎРѓРЎвЂљРЎР‚Р С•Р С”Р С‘)

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Р вЂ™ Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦ Р ВµРЎРѓРЎвЂљРЎРЉ Р В·Р В°Р С—РЎРЏРЎвЂљРЎвЂ№Р Вµ Р Р†Р Р…РЎС“РЎвЂљРЎР‚Р С‘ Р В·Р Р…Р В°РЎвЂЎР ВµР Р…Р С‘Р в„–, Р С”Р С•РЎвЂљР С•РЎР‚РЎвЂ№Р Вµ Р В»Р С•Р СР В°РЎР‹РЎвЂљ Р С—Р В°РЎР‚РЎРѓР С‘Р Р…Р С–.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ РЎвЂћР В°Р в„–Р В» CSV - Р В·Р В°Р С—РЎРЏРЎвЂљРЎвЂ№Р Вµ Р Р† Р С”Р С•Р В»Р С•Р Р…Р С”Р В°РЎвЂ¦ Р Т‘Р С•Р В»Р В¶Р Р…РЎвЂ№ Р В±РЎвЂ№РЎвЂљРЎРЉ Р Р† Р С”Р В°Р Р†РЎвЂ№РЎвЂЎР С”Р В°РЎвЂ¦
# Р ВР В»Р С‘ РЎС“Р Т‘Р В°Р В»Р С‘РЎвЂљР Вµ Р В·Р В°Р С—РЎРЏРЎвЂљРЎвЂ№Р Вµ Р С‘Р В· Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦ (Р Р…Р В°Р С—РЎР‚Р С‘Р СР ВµРЎР‚, "Р РЋР С•РЎР‚РЎвЂљ Р С’, Р РЋР С•РЎР‚РЎвЂљ Р вЂ" РІвЂ вЂ™ "Р РЋР С•РЎР‚РЎвЂљ Р С’ Р РЋР С•РЎР‚РЎвЂљ Р вЂ")

# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ Р С”Р С•Р В»Р С‘РЎвЂЎР ВµРЎРѓРЎвЂљР Р†Р С• Р В·Р В°Р С–РЎР‚РЎС“Р В¶Р ВµР Р…Р Р…РЎвЂ№РЎвЂ¦ Р В·Р В°Р С—Р С‘РЎРѓР ВµР в„–:
docker compose exec db psql -U postgres -d wine_db -c "SELECT COUNT(*) FROM products;"
```

---

### Rate limiting Р Р…Р Вµ РЎР‚Р В°Р В±Р С•РЎвЂљР В°Р ВµРЎвЂљ СЂСџвЂ вЂў

**Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°:** Flask-Limiter Р Р…Р Вµ РЎС“РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р В»Р ВµР Р… Р С‘Р В»Р С‘ Р Р…Р ВµР С—РЎР‚Р В°Р Р†Р С‘Р В»РЎРЉР Р…Р С• Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р ВµР Р….

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# 1. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ, РЎвЂЎРЎвЂљР С• Flask-Limiter РЎС“РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р В»Р ВµР Р…
pip list | Select-String "Flask-Limiter"

# 2. Р вЂўРЎРѓР В»Р С‘ Р Р…Р ВµРЎвЂљ - РЎС“РЎРѓРЎвЂљР В°Р Р…Р С•Р Р†Р С‘РЎвЂљР Вµ
pip install Flask-Limiter

# 3. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ .env
Get-Content .env | Select-String "RATE_LIMIT"

# 4. Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ headers Р Р† Р С•РЎвЂљР Р†Р ВµРЎвЂљР Вµ
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
$response.Headers.Keys | Select-String "RateLimit"

# 5. Р СџР ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљР Вµ API
docker compose restart api
```

---

## CI/CD Р С‘ CHANGELOG

- **Release Drafter** РЎвЂћР С•РЎР‚Р СР С‘РЎР‚РЎС“Р ВµРЎвЂљ РЎвЂЎР ВµРЎР‚Р Р…Р С•Р Р†Р С‘Р С”Р С‘ РЎР‚Р ВµР В»Р С‘Р В·Р С•Р Р† Р С—РЎР‚Р С‘ push Р Р† `master`
- Р СџРЎР‚Р С‘ Р С—РЎС“Р В±Р В»Р С‘Р С”Р В°РЎвЂ Р С‘Р С‘/РЎР‚Р ВµР Т‘Р В°Р С”РЎвЂљР С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘Р С‘ РЎР‚Р ВµР В»Р С‘Р В·Р В° РЎвЂљРЎР‚Р С‘Р С–Р С–Р ВµРЎР‚Р С‘РЎвЂљРЎРѓРЎРЏ **Changelog on Release**:
  - Р вЂњР ВµР Р…Р ВµРЎР‚Р С‘РЎР‚РЎС“Р ВµРЎвЂљ `CHANGELOG.md`
  - Р РЋР С•Р В·Р Т‘Р В°РЎвЂРЎвЂљ Р В°Р Р†РЎвЂљР С•-PR `docs/changelog: <tag>`
- Р вЂќР В»РЎРЏ Р Р…Р В°Р Т‘РЎвЂР В¶Р Р…Р С•Р С–Р С• Р В°Р Р†РЎвЂљР С•-PR Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р ВµР С PAT (fine-grained) Р Р† `secrets.ACTIONS_WRITER_PAT`
- Р вЂР ВµР в„–Р Т‘Р В¶Р С‘ Р Р† Р Р…Р В°РЎвЂЎР В°Р В»Р Вµ README Р С—Р С•Р С”Р В°Р В·РЎвЂ№Р Р†Р В°РЎР‹РЎвЂљ РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓРЎвЂ№ CI, Release Drafter, Changelog on Release

---


## СЂСџвЂњР‰ Structured JSON Logging

### Р В§РЎвЂљР С• РЎРЊРЎвЂљР С•?

Р СњР В°РЎвЂЎР С‘Р Р…Р В°РЎРЏ РЎРѓ Р Р†Р ВµРЎР‚РЎРѓР С‘Р С‘ 0.4.1, API Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р ВµРЎвЂљ **structured JSON logging** РІР‚вЂќ Р Р†РЎРѓР Вµ Р В»Р С•Р С–Р С‘ Р В·Р В°Р С—Р С‘РЎРѓРЎвЂ№Р Р†Р В°РЎР‹РЎвЂљРЎРѓРЎРЏ Р Р† РЎвЂћР С•РЎР‚Р СР В°РЎвЂљР Вµ JSON, РЎвЂЎРЎвЂљР С• Р С—Р С•Р В·Р Р†Р С•Р В»РЎРЏР ВµРЎвЂљ Р В»Р ВµР С–Р С”Р С• Р В°Р Р…Р В°Р В»Р С‘Р В·Р С‘РЎР‚Р С•Р Р†Р В°РЎвЂљРЎРЉ Р С‘РЎвЂ¦ Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р СР С‘ РЎРѓР С‘РЎРѓРЎвЂљР ВµР СР В°Р СР С‘ Р СР С•Р Р…Р С‘РЎвЂљР С•РЎР‚Р С‘Р Р…Р С–Р В° (Datadog, ELK, Splunk).

### Р СџРЎР‚Р ВµР С‘Р СРЎС“РЎвЂ°Р ВµРЎРѓРЎвЂљР Р†Р В°

- РІСљвЂ¦ **Р РЋРЎвЂљРЎР‚РЎС“Р С”РЎвЂљРЎС“РЎР‚Р С‘РЎР‚Р С•Р Р†Р В°Р Р…Р Р…Р С•РЎРѓРЎвЂљРЎРЉ** РІР‚вЂќ Р В»Р ВµР С–Р С”Р С• РЎвЂћР С‘Р В»РЎРЉРЎвЂљРЎР‚Р С•Р Р†Р В°РЎвЂљРЎРЉ Р С‘ Р В°Р Р…Р В°Р В»Р С‘Р В·Р С‘РЎР‚Р С•Р Р†Р В°РЎвЂљРЎРЉ
- РІСљвЂ¦ **Request Tracing** РІР‚вЂќ Р С”Р В°Р В¶Р Т‘РЎвЂ№Р в„– Р В·Р В°Р С—РЎР‚Р С•РЎРѓ Р С‘Р СР ВµР ВµРЎвЂљ РЎС“Р Р…Р С‘Р С”Р В°Р В»РЎРЉР Р…РЎвЂ№Р в„– Request ID
- РІСљвЂ¦ **Performance Metrics** РІР‚вЂќ Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С•Р Вµ Р С‘Р В·Р СР ВµРЎР‚Р ВµР Р…Р С‘Р Вµ Р Р†РЎР‚Р ВµР СР ВµР Р…Р С‘ Р Р†РЎвЂ№Р С—Р С•Р В»Р Р…Р ВµР Р…Р С‘РЎРЏ
- РІСљвЂ¦ **Production-ready** РІР‚вЂќ РЎРѓР С•Р Р†Р СР ВµРЎРѓРЎвЂљР С‘Р СР С•РЎРѓРЎвЂљРЎРЉ РЎРѓ РЎРѓР С‘РЎРѓРЎвЂљР ВµР СР В°Р СР С‘ Р СР С•Р Р…Р С‘РЎвЂљР С•РЎР‚Р С‘Р Р…Р С–Р В°

### Р В¤Р С•РЎР‚Р СР В°РЎвЂљ Р В»Р С•Р С–Р С•Р Р†

**Р ВР Р…Р С‘РЎвЂ Р С‘Р В°Р В»Р С‘Р В·Р В°РЎвЂ Р С‘РЎРЏ Р С—РЎР‚Р С‘Р В»Р С•Р В¶Р ВµР Р…Р С‘РЎРЏ:**
```json
{
  "timestamp": 1761708443.734,
  "level": "INFO",
  "logger": "app",
  "module": "logging_config",
  "function": "setup_logging",
  "message": "JSON logging initialized",
  "log_level": "INFO",
  "version": "0.4.0"
}
```

**HTTP Р В·Р В°Р С—РЎР‚Р С•РЎРѓ (Р Р†РЎвЂ¦Р С•Р Т‘РЎРЏРЎвЂ°Р С‘Р в„–):**
```json
{
  "timestamp": 1761708697.329,
  "level": "INFO",
  "logger": "app",
  "message": "Incoming request",
  "request_id": "req_76a01810",
  "method": "GET",
  "path": "/health",
  "query_string": "",
  "client_ip": "172.19.0.1",
  "user_agent": "Mozilla/5.0 ..."
}
```

**HTTP Р В·Р В°Р С—РЎР‚Р С•РЎРѓ (Р В·Р В°Р Р†Р ВµРЎР‚РЎв‚¬РЎвЂР Р…Р Р…РЎвЂ№Р в„–):**
```json
{
  "timestamp": 1761708697.331,
  "level": "INFO",
  "logger": "app",
  "message": "Request completed",
  "request_id": "req_76a01810",
  "method": "GET",
  "path": "/health",
  "status_code": 200,
  "duration_ms": 2.14,
  "response_size_bytes": 17
}
```

### Р СњР В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р В° РЎвЂЎР ВµРЎР‚Р ВµР В· .env
```ini
# Р Р€РЎР‚Р С•Р Р†Р Р…Р С‘ Р В»Р С•Р С–Р С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ
LOG_LEVEL=DEBUG    # Р вЂќР ВµРЎвЂљР В°Р В»РЎРЉР Р…РЎвЂ№Р Вµ Р В»Р С•Р С–Р С‘ (Р Т‘Р В»РЎРЏ РЎР‚Р В°Р В·РЎР‚Р В°Р В±Р С•РЎвЂљР С”Р С‘)
LOG_LEVEL=INFO     # Р РЋРЎвЂљР В°Р Р…Р Т‘Р В°РЎР‚РЎвЂљР Р…РЎвЂ№Р Вµ Р В»Р С•Р С–Р С‘ (Р Т‘Р В»РЎРЏ production) РІР‚вЂќ РЎР‚Р ВµР С”Р С•Р СР ВµР Р…Р Т‘РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ
LOG_LEVEL=WARNING  # Р СћР С•Р В»РЎРЉР С”Р С• Р С—РЎР‚Р ВµР Т‘РЎС“Р С—РЎР‚Р ВµР В¶Р Т‘Р ВµР Р…Р С‘РЎРЏ Р С‘ Р С•РЎв‚¬Р С‘Р В±Р С”Р С‘
LOG_LEVEL=ERROR    # Р СћР С•Р В»РЎРЉР С”Р С• Р С•РЎв‚¬Р С‘Р В±Р С”Р С‘
```

### Request ID Р Р† HTTP Р В·Р В°Р С–Р С•Р В»Р С•Р Р†Р С”Р В°РЎвЂ¦

Р С™Р В°Р В¶Р Т‘РЎвЂ№Р в„– Р С•РЎвЂљР Р†Р ВµРЎвЂљ API РЎРѓР С•Р Т‘Р ВµРЎР‚Р В¶Р С‘РЎвЂљ Р В·Р В°Р С–Р С•Р В»Р С•Р Р†Р С•Р С” `X-Request-ID`, Р С”Р С•РЎвЂљР С•РЎР‚РЎвЂ№Р в„– РЎРѓР С•Р Р†Р С—Р В°Р Т‘Р В°Р ВµРЎвЂљ РЎРѓ `request_id` Р Р† Р В»Р С•Р С–Р В°РЎвЂ¦.

**Р СџРЎР‚Р С‘Р СР ВµРЎР‚ Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ:**
```powershell
# PowerShell
$response = Invoke-WebRequest -Uri "http://127.0.0.1:18000/health"
$response.Headers['X-Request-ID']
# Р вЂ™РЎвЂ№Р Р†Р С•Р Т‘: req_76a01810
```
```bash
# curl
curl -I http://127.0.0.1:18000/health | grep X-Request-ID
# Р вЂ™РЎвЂ№Р Р†Р С•Р Т‘: X-Request-ID: req_76a01810
```

**Р СџРЎР‚Р С‘Р СР ВµР Р…Р ВµР Р…Р С‘Р Вµ:**
- СЂСџС’вЂє Р С›РЎвЂљР В»Р В°Р Т‘Р С”Р В° РІР‚вЂќ Р Р…Р В°Р в„–РЎвЂљР С‘ Р Р†РЎРѓР Вµ Р В»Р С•Р С–Р С‘ Р С”Р С•Р Р…Р С”РЎР‚Р ВµРЎвЂљР Р…Р С•Р С–Р С• Р В·Р В°Р С—РЎР‚Р С•РЎРѓР В°
- СЂСџвЂњС› Р СџР С•Р Т‘Р Т‘Р ВµРЎР‚Р В¶Р С”Р В° РІР‚вЂќ Р С—Р С•Р С—РЎР‚Р С•РЎРѓР С‘РЎвЂљРЎРЉ Р С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°РЎвЂљР ВµР В»РЎРЏ Р С—РЎР‚Р С‘РЎРѓР В»Р В°РЎвЂљРЎРЉ Request ID
- СЂСџвЂњР‰ Р С’Р Р…Р В°Р В»Р С‘РЎвЂљР С‘Р С”Р В° РІР‚вЂќ Р С—РЎР‚Р С•РЎРѓР В»Р ВµР Т‘Р С‘РЎвЂљРЎРЉ Р С—РЎС“РЎвЂљРЎРЉ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР В° РЎвЂЎР ВµРЎР‚Р ВµР В· Р СР С‘Р С”РЎР‚Р С•РЎРѓР ВµРЎР‚Р Р†Р С‘РЎРѓРЎвЂ№

### Р СџРЎР‚Р С•РЎРѓР СР С•РЎвЂљРЎР‚ Р В»Р С•Р С–Р С•Р Р† Р Р† Docker
```powershell
# Р вЂ™РЎРѓР Вµ Р В»Р С•Р С–Р С‘ API
docker compose logs api

# Р СџР С•РЎРѓР В»Р ВµР Т‘Р Р…Р С‘Р Вµ 20 РЎРѓРЎвЂљРЎР‚Р С•Р С”
docker compose logs --tail 20 api

# Р РЋР В»Р ВµР Т‘Р С‘РЎвЂљРЎРЉ Р В·Р В° Р В»Р С•Р С–Р В°Р СР С‘ Р Р† РЎР‚Р ВµР В°Р В»РЎРЉР Р…Р С•Р С Р Р†РЎР‚Р ВµР СР ВµР Р…Р С‘
docker compose logs -f api

# Р В¤Р С‘Р В»РЎРЉРЎвЂљРЎР‚Р В°РЎвЂ Р С‘РЎРЏ Р С—Р С• РЎС“РЎР‚Р С•Р Р†Р Р…РЎР‹ (РЎвЂљР С•Р В»РЎРЉР С”Р С• ERROR)
docker compose logs api | Select-String '"level": "ERROR"'
```

### Р ВР Р…РЎвЂљР ВµР С–РЎР‚Р В°РЎвЂ Р С‘РЎРЏ РЎРѓ РЎРѓР С‘РЎРѓРЎвЂљР ВµР СР В°Р СР С‘ Р СР С•Р Р…Р С‘РЎвЂљР С•РЎР‚Р С‘Р Р…Р С–Р В°

JSON РЎвЂћР С•РЎР‚Р СР В°РЎвЂљ Р С—Р С•Р В·Р Р†Р С•Р В»РЎРЏР ВµРЎвЂљ Р В»Р ВµР С–Р С”Р С• Р С‘Р Р…РЎвЂљР ВµР С–РЎР‚Р С‘РЎР‚Р С•Р Р†Р В°РЎвЂљРЎРЉРЎРѓРЎРЏ РЎРѓ:

- **Datadog** РІР‚вЂќ Р С—РЎР‚Р С•РЎРѓРЎвЂљР С• Р С•РЎвЂљР С—РЎР‚Р В°Р Р†Р В»РЎРЏР в„–РЎвЂљР Вµ Р В»Р С•Р С–Р С‘ РЎвЂЎР ВµРЎР‚Р ВµР В· Р В°Р С–Р ВµР Р…РЎвЂљ
- **ELK Stack** (Elasticsearch, Logstash, Kibana) РІР‚вЂќ Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р в„–РЎвЂљР Вµ Logstash Р Т‘Р В»РЎРЏ Р С—Р В°РЎР‚РЎРѓР С‘Р Р…Р С–Р В°
- **Splunk** РІР‚вЂќ Р С‘Р СР С—Р С•РЎР‚РЎвЂљ JSON Р В»Р С•Р С–Р С•Р Р† Р С‘Р В· Р С”Р С•РЎР‚Р С•Р В±Р С”Р С‘
- **CloudWatch Logs** РІР‚вЂќ Р Т‘Р В»РЎРЏ AWS deployment
- **Google Cloud Logging** РІР‚вЂќ Р Т‘Р В»РЎРЏ GCP deployment

**Р СџРЎР‚Р С‘Р СР ВµРЎР‚ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР В° Р Р† Datadog:**
```
@request_id:req_76a01810
```

**Р СџРЎР‚Р С‘Р СР ВµРЎР‚ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР В° Р Р† Elasticsearch:**
```json
{
  "query": {
    "match": {
      "request_id": "req_76a01810"
    }
  }
}
```

### Troubleshooting

#### Р вЂєР С•Р С–Р С‘ Р Р…Р Вµ Р Р† РЎвЂћР С•РЎР‚Р СР В°РЎвЂљР Вµ JSON

**Р СџРЎР‚Р С•Р В±Р В»Р ВµР СР В°:** Р вЂ™Р С‘Р Т‘Р С‘РЎвЂљР Вµ plain text Р В»Р С•Р С–Р С‘ Р Р†Р СР ВµРЎРѓРЎвЂљР С• JSON.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ, РЎвЂЎРЎвЂљР С• Р СР С•Р Т‘РЎС“Р В»Р С‘ Р С‘Р СР С—Р С•РЎР‚РЎвЂљР С‘РЎР‚Р С•Р Р†Р В°Р Р…РЎвЂ№
Get-Content api\app.py | Select-String "setup_logging"

# Р СџР ВµРЎР‚Р ВµРЎРѓР С•Р В±Р ВµРЎР‚Р С‘РЎвЂљР Вµ Docker Р С•Р В±РЎР‚Р В°Р В·
docker compose build --no-cache api
docker compose up -d
```

#### Р СњР Вµ Р Р†Р С‘Р В¶РЎС“ Request ID Р Р† Р В·Р В°Р С–Р С•Р В»Р С•Р Р†Р С”Р В°РЎвЂ¦

**Р СџРЎР‚Р С•Р В±Р В»Р ВµР СР В°:** Р вЂ”Р В°Р С–Р С•Р В»Р С•Р Р†Р С•Р С” `X-Request-ID` Р С•РЎвЂљРЎРѓРЎС“РЎвЂљРЎРѓРЎвЂљР Р†РЎС“Р ВµРЎвЂљ.

**Р В Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ:**
```powershell
# Р СџРЎР‚Р С•Р Р†Р ВµРЎР‚РЎРЉРЎвЂљР Вµ, РЎвЂЎРЎвЂљР С• middleware Р С—Р С•Р Т‘Р С”Р В»РЎР‹РЎвЂЎРЎвЂР Р…
Get-Content api\app.py | Select-String "setup_request_logging"

# Р СџР ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓРЎвЂљР С‘РЎвЂљР Вµ API
docker compose restart api
```
---

## Roadmap

### РІСљвЂ¦ Р вЂ”Р В°Р Р†Р ВµРЎР‚РЎв‚¬Р ВµР Р…Р С•

**Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 1 РІР‚вЂќ Database Schema & ETL Enhancement:**
- [x] ~~Р РЋР С‘Р Р…РЎвЂ¦РЎР‚Р С•Р Р…Р С‘Р В·Р С‘РЎР‚Р С•Р Р†Р В°РЎвЂљРЎРЉ `db/init.sql` РЎРѓ Р СР С‘Р С–РЎР‚Р В°РЎвЂ Р С‘РЎРЏР СР С‘~~ РІСљвЂ¦
- [x] ~~Р вЂР С‘РЎвЂљР ВµР СР С—Р С•РЎР‚Р В°Р В»РЎРЉР Р…Р В°РЎРЏ Р В°РЎР‚РЎвЂ¦Р С‘РЎвЂљР ВµР С”РЎвЂљРЎС“РЎР‚Р В° Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦~~ РІСљвЂ¦
- [x] ~~Р вЂќР Р†Р Вµ РЎвЂ Р ВµР Р…РЎвЂ№ (price_list_rub, price_final_rub)~~ РІСљвЂ¦
- [x] ~~Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ РЎвЂ Р ВµР Р… Р С‘ Р С•РЎРѓРЎвЂљР В°РЎвЂљР С”Р С•Р Р†~~ РІСљвЂ¦
- [x] ~~Production guardrails (constraints)~~ РІСљвЂ¦
- [x] ~~Р СџРЎР‚Р С•Р Т‘Р Р†Р С‘Р Р…РЎС“РЎвЂљРЎвЂ№Р в„– ETL РЎРѓ Р В°Р Р†РЎвЂљР С•-Р С•Р С—РЎР‚Р ВµР Т‘Р ВµР В»Р ВµР Р…Р С‘Р ВµР С Р С”Р С•Р Т‘Р С‘РЎР‚Р С•Р Р†Р С”Р С‘~~ РІСљвЂ¦

**Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 2 РІР‚вЂќ Production Readiness:**
- [x] ~~Р вЂќР С•Р В±Р В°Р Р†Р С‘РЎвЂљРЎРЉ healthcheck РЎРѓ Р С—РЎР‚Р С•Р Р†Р ВµРЎР‚Р С”Р С•Р в„– Р вЂР вЂќ Р Р† `/ready`~~ РІСљвЂ¦
- [x] ~~Р вЂќР С•Р В±Р В°Р Р†Р С‘РЎвЂљРЎРЉ `/live` liveness probe~~ РІСљвЂ¦
- [x] ~~Р вЂќР С•Р В±Р В°Р Р†Р С‘РЎвЂљРЎРЉ `/version` endpoint~~ РІСљвЂ¦
- [x] ~~Р вЂ™РЎвЂ№Р Р…Р ВµРЎРѓРЎвЂљР С‘ CORS (`flask-cors`) Р Т‘Р В»РЎРЏ РЎвЂћРЎР‚Р С•Р Р…РЎвЂљР В°~~ РІСљвЂ¦
- [x] ~~Docker Compose healthcheck Р Т‘Р В»РЎРЏ Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С•Р С–Р С• Р С—Р ВµРЎР‚Р ВµР В·Р В°Р С—РЎС“РЎРѓР С”Р В°~~ РІСљвЂ¦
- [x] ~~Non-root user Р Р† Docker Р Т‘Р В»РЎРЏ Р В±Р ВµР В·Р С•Р С—Р В°РЎРѓР Р…Р С•РЎРѓРЎвЂљР С‘~~ РІСљвЂ¦

**Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 3 РІР‚вЂќ Security & Rate Limiting:**
- [x] ~~Rate limiting Р Т‘Р В»РЎРЏ Р Р†РЎРѓР ВµРЎвЂ¦ endpoints~~ РІСљвЂ¦
- [x] ~~Р ВРЎРѓР С—РЎР‚Р В°Р Р†Р С‘РЎвЂљРЎРЉ SQL injection РЎС“РЎРЏР В·Р Р†Р С‘Р СР С•РЎРѓРЎвЂљР С‘~~ РІСљвЂ¦
- [x] ~~Р СњР В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р В° РЎвЂЎР ВµРЎР‚Р ВµР В· environment variables~~ РІСљвЂ¦
- [x] ~~Р СџР С•Р Т‘Р Т‘Р ВµРЎР‚Р В¶Р С”Р В° Redis Р Т‘Р В»РЎРЏ distributed rate limiting~~ РІСљвЂ¦
- [x] ~~Rate limit headers Р Р† Р С•РЎвЂљР Р†Р ВµРЎвЂљР В°РЎвЂ¦~~ РІСљвЂ¦
- [x] ~~Swagger/OpenAPI Р Т‘Р С•Р С”РЎС“Р СР ВµР Р…РЎвЂљР В°РЎвЂ Р С‘РЎРЏ~~ РІСљвЂ¦

### СЂСџС™В§ Р вЂ™ РЎР‚Р В°Р В±Р С•РЎвЂљР Вµ

- [ ] Р СџР С•Р С”РЎР‚РЎвЂ№РЎвЂљРЎРЉ `scripts/load_csv.py` РЎвЂљР ВµРЎРѓРЎвЂљР В°Р СР С‘ (Р СР С‘Р Р…Р С‘Р СРЎС“Р С happy-path + РЎР‚Р В°Р В·Р В±Р С•РЎР‚ S5 + Р С”Р С•Р Р…РЎвЂћР В»Р С‘Р С”РЎвЂљРЎС“РЎР‹РЎвЂ°Р С‘Р Вµ РЎвЂ Р ВµР Р…РЎвЂ№)
- [ ] Structured Logging (JSON logging, request tracing, performance metrics)

### СЂСџвЂњвЂ№ Р СџР В»Р В°Р Р…Р С‘РЎР‚РЎС“Р ВµРЎвЂљРЎРѓРЎРЏ

**Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 4 РІР‚вЂќ Testing & Quality:**
- [ ] Testing Infrastructure (pytest, integration tests, API tests)
- [ ] Code coverage >80%
- [ ] Performance tests (load testing, stress testing)
- [ ] End-to-end tests

**Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 5 РІР‚вЂќ Advanced Features:**
- [ ] Р С™Р С•Р Р…РЎРѓР С•Р В»Р С‘Р Т‘Р С‘РЎР‚Р С•Р Р†Р В°РЎвЂљРЎРЉ ETL: РЎС“Р Т‘Р В°Р В»Р С‘РЎвЂљРЎРЉ РЎС“РЎРѓРЎвЂљР В°РЎР‚Р ВµР Р†РЎв‚¬Р С‘Р в„– `etl/run_daily.py`
- [ ] Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р С”Р В»Р С‘Р ВµР Р…РЎвЂљР С•Р Р† (Python `requests`, JavaScript `fetch`)
- [ ] Р СљР ВµРЎвЂљРЎР‚Р С‘Р С”Р С‘ (Р В»Р С•Р С–Р С‘РЎР‚Р С•Р Р†Р В°Р Р…Р С‘Р Вµ Р В·Р В°Р С—РЎР‚Р С•РЎРѓР С•Р Р†, Р Р†РЎР‚Р ВµР СРЎРЏ Р С•РЎвЂљР Р†Р ВµРЎвЂљР В°)
- [ ] Sentry/OpenTelemetry Р С‘Р Р…РЎвЂљР ВµР С–РЎР‚Р В°РЎвЂ Р С‘РЎРЏ (Р С•Р С—РЎвЂ Р С‘Р С•Р Р…Р В°Р В»РЎРЉР Р…Р С•)

**Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 6 РІР‚вЂќ User Features:**
- [ ] Telegram-Р В±Р С•РЎвЂљ Р Т‘Р В»РЎРЏ Р С—Р С•Р С‘РЎРѓР С”Р В° Р С‘ Р С—Р С•Р В»РЎС“РЎвЂЎР ВµР Р…Р С‘РЎРЏ Р С”Р В°РЎР‚РЎвЂљР С•РЎвЂЎР ВµР С” РЎвЂљР С•Р Р†Р В°РЎР‚Р С•Р Р†
- [ ] Р вЂ™Р ВµР С”РЎвЂљР С•РЎР‚Р Р…РЎвЂ№Р в„– Р С—Р С•Р С‘РЎРѓР С” РЎРѓ РЎРЊР СР В±Р ВµР Т‘Р Т‘Р С‘Р Р…Р С–Р В°Р СР С‘ + rerank Р Т‘Р В»РЎРЏ РЎС“Р В»РЎС“РЎвЂЎРЎв‚¬Р ВµР Р…Р С‘РЎРЏ РЎР‚Р ВµР В»Р ВµР Р†Р В°Р Р…РЎвЂљР Р…Р С•РЎРѓРЎвЂљР С‘
- [ ] Export РЎвЂћРЎС“Р Р…Р С”РЎвЂ Р С‘Р С•Р Р…Р В°Р В»РЎРЉР Р…Р С•РЎРѓРЎвЂљРЎРЉ (Excel, PDF, JSON)
- [ ] Advanced filtering (price range, multiple regions, etc.)

---

## СЂСџвЂњСњ Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ Р С‘Р В·Р СР ВµР Р…Р ВµР Р…Р С‘Р в„–

### v0.4.0 РІР‚вЂќ Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 3: Security & Rate Limiting (27 Р С•Р С”РЎвЂљРЎРЏР В±РЎР‚РЎРЏ 2025)

**Р вЂќР С•Р В±Р В°Р Р†Р В»Р ВµР Р…Р С•:**
- РІСљвЂ¦ **Rate Limiting:** Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂљР В° Р С•РЎвЂљ DDoS Р С‘ Р В·Р В»Р С•РЎС“Р С—Р С•РЎвЂљРЎР‚Р ВµР В±Р В»Р ВµР Р…Р С‘Р в„–
  - Р СџРЎС“Р В±Р В»Р С‘РЎвЂЎР Р…РЎвЂ№Р Вµ endpoints: 100 req/hour (Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р В°Р С‘Р Р†Р В°Р ВµРЎвЂљРЎРѓРЎРЏ)
  - Р вЂ”Р В°РЎвЂ°Р С‘РЎвЂ°РЎвЂР Р…Р Р…РЎвЂ№Р Вµ endpoints: 1000 req/hour (Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р В°Р С‘Р Р†Р В°Р ВµРЎвЂљРЎРѓРЎРЏ)
  - Rate limit headers Р Р† Р С”Р В°Р В¶Р Т‘Р С•Р С Р С•РЎвЂљР Р†Р ВµРЎвЂљР Вµ
  - HTTP 429 РЎРѓ Р Т‘Р ВµРЎвЂљР В°Р В»РЎРЉР Р…Р С•Р в„– Р С‘Р Р…РЎвЂћР С•РЎР‚Р СР В°РЎвЂ Р С‘Р ВµР в„–
  - Р СџР С•Р Т‘Р Т‘Р ВµРЎР‚Р В¶Р С”Р В° Redis Р Т‘Р В»РЎРЏ distributed systems
  - Р вЂњР С‘Р В±Р С”Р В°РЎРЏ Р Р…Р В°РЎРѓРЎвЂљРЎР‚Р С•Р в„–Р С”Р В° РЎвЂЎР ВµРЎР‚Р ВµР В· environment variables
- РІСљвЂ¦ **Security Fixes:** Р ВРЎРѓР С—РЎР‚Р В°Р Р†Р В»Р ВµР Р…РЎвЂ№ SQL injection РЎС“РЎРЏР В·Р Р†Р С‘Р СР С•РЎРѓРЎвЂљР С‘
- РІСљвЂ¦ **Documentation:** Р СџР С•Р В»Р Р…Р В°РЎРЏ Р Т‘Р С•Р С”РЎС“Р СР ВµР Р…РЎвЂљР В°РЎвЂ Р С‘РЎРЏ rate limiting Р Р† README

**Р ВР В·Р СР ВµР Р…Р ВµР Р…Р С•:**
- СЂСџвЂќвЂћ `.env.example` РІР‚вЂќ Р Т‘Р С•Р В±Р В°Р Р†Р В»Р ВµР Р…РЎвЂ№ Р С—Р ВµРЎР‚Р ВµР СР ВµР Р…Р Р…РЎвЂ№Р Вµ `RATE_LIMIT_*`
- СЂСџвЂќвЂћ `requirements.txt` РІР‚вЂќ Р Т‘Р С•Р В±Р В°Р Р†Р В»Р ВµР Р… Flask-Limiter
- СЂСџвЂќвЂћ `api/app.py` РІР‚вЂќ Р С‘Р Р…РЎвЂљР ВµР С–РЎР‚Р В°РЎвЂ Р С‘РЎРЏ Flask-Limiter РЎРѓ Р С”Р С•Р Р…РЎвЂћР С‘Р С–РЎС“РЎР‚Р В°РЎвЂ Р С‘Р ВµР в„–

**Dependencies:**
- Flask-Limiter 3.5.0

---

### v0.3.0 РІР‚вЂќ Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 2: Production Readiness (18-21 Р С•Р С”РЎвЂљРЎРЏР В±РЎР‚РЎРЏ 2025)

**Р вЂќР С•Р В±Р В°Р Р†Р В»Р ВµР Р…Р С•:**
- РІСљвЂ¦ `/live` endpoint РІР‚вЂќ Liveness probe (uptime, Р Р†Р ВµРЎР‚РЎРѓР С‘РЎРЏ, timestamp)
- РІСљвЂ¦ `/ready` endpoint РІР‚вЂќ Readiness probe (Р вЂР вЂќ + РЎвЂљР В°Р В±Р В»Р С‘РЎвЂ РЎвЂ№ + Р С‘Р Р…Р Т‘Р ВµР С”РЎРѓРЎвЂ№ + constraints)
- РІСљвЂ¦ `/version` endpoint РІР‚вЂќ Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ API
- РІСљвЂ¦ Р С›РЎвЂљРЎРѓР В»Р ВµР В¶Р С‘Р Р†Р В°Р Р…Р С‘Р Вµ uptime (app.start_time)
- РІСљвЂ¦ Docker API Service РЎРѓ Р В°Р Р†РЎвЂљР С•Р СР В°РЎвЂљР С‘РЎвЂЎР ВµРЎРѓР С”Р С‘Р С healthcheck
- РІСљвЂ¦ CORS configuration РЎвЂЎР ВµРЎР‚Р ВµР В· environment variables
- РІСљвЂ¦ Non-root user Р Р† Docker (appuser)
- РІСљвЂ¦ Graceful service dependencies Р Р† docker-compose.yml

**Р вЂќР С•Р С”РЎС“Р СР ВµР Р…РЎвЂљР В°РЎвЂ Р С‘РЎРЏ:**
- РІСљвЂ¦ Р вЂќР ВµРЎвЂљР В°Р В»РЎРЉР Р…Р С•Р Вµ Р С•Р С—Р С‘РЎРѓР В°Р Р…Р С‘Р Вµ healthcheck РЎРЊР Р…Р Т‘Р С—Р С•Р С‘Р Р…РЎвЂљР С•Р Р†
- РІСљвЂ¦ Р СџРЎР‚Р С‘Р СР ВµРЎР‚РЎвЂ№ Р С‘РЎРѓР С—Р С•Р В»РЎРЉР В·Р С•Р Р†Р В°Р Р…Р С‘РЎРЏ Р Т‘Р В»РЎРЏ Kubernetes/Docker
- РІСљвЂ¦ Troubleshooting Р Т‘Р В»РЎРЏ 503 Service Unavailable
- РІСљвЂ¦ Р В Р В°Р В·Р Т‘Р ВµР В» Р С—РЎР‚Р С• CORS configuration
- РІСљвЂ¦ Р В Р В°Р В·Р Т‘Р ВµР В» Р С—РЎР‚Р С• Docker API Service

---

### v0.2.0 РІР‚вЂќ Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ 1: Database Schema & ETL Enhancement (17 Р С•Р С”РЎвЂљРЎРЏР В±РЎР‚РЎРЏ 2025)

**Р вЂќР С•Р В±Р В°Р Р†Р В»Р ВµР Р…Р С•:**
- РІСљвЂ¦ Р вЂР С‘РЎвЂљР ВµР СР С—Р С•РЎР‚Р В°Р В»РЎРЉР Р…Р В°РЎРЏ Р В°РЎР‚РЎвЂ¦Р С‘РЎвЂљР ВµР С”РЎвЂљРЎС“РЎР‚Р В° Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦
- РІСљвЂ¦ Р вЂќР Р†Р Вµ РЎвЂ Р ВµР Р…РЎвЂ№: price_list_rub + price_final_rub
- РІСљвЂ¦ Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ РЎвЂ Р ВµР Р… (product_prices) РЎРѓ temporal intervals
- РІСљвЂ¦ Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ Р С•РЎРѓРЎвЂљР В°РЎвЂљР С”Р С•Р Р† (inventory_history)
- РІСљвЂ¦ Production guardrails (EXCLUDE constraints, CHECK constraints)
- РІСљвЂ¦ Р СџРЎР‚Р С•Р Т‘Р Р†Р С‘Р Р…РЎС“РЎвЂљРЎвЂ№Р в„– ETL (scripts/load_csv.py)
- РІСљвЂ¦ Р С’Р Р†РЎвЂљР С•-Р С•Р С—РЎР‚Р ВµР Т‘Р ВµР В»Р ВµР Р…Р С‘Р Вµ Р С”Р С•Р Т‘Р С‘РЎР‚Р С•Р Р†Р С”Р С‘ (UTF-8/CP1251/Latin1)
- РІСљвЂ¦ Р ВР В·Р Р†Р В»Р ВµРЎвЂЎР ВµР Р…Р С‘Р Вµ РЎРѓР С”Р С‘Р Т‘Р С”Р С‘ Р С‘Р В· РЎРЏРЎвЂЎР ВµР в„–Р С”Р С‘ Excel (S5)
- РІСљвЂ¦ Р вЂ™Р В°Р В»Р С‘Р Т‘Р В°РЎвЂ Р С‘РЎРЏ Р С”Р С•Р Т‘Р С•Р Р† РЎвЂљР С•Р Р†Р В°РЎР‚Р С•Р Р† (regex)

---

## СЂСџвЂњСњ Р вЂєР С‘РЎвЂ Р ВµР Р…Р В·Р С‘РЎРЏ

MIT

## СЂСџВ¤Сњ Р С™Р С•Р Р…РЎвЂљРЎР‚Р С‘Р В±РЎРЉРЎР‹РЎвЂ Р С‘РЎРЏ

Pull requests Р С—РЎР‚Р С‘Р Р†Р ВµРЎвЂљРЎРѓРЎвЂљР Р†РЎС“РЎР‹РЎвЂљРЎРѓРЎРЏ! Р вЂќР В»РЎРЏ Р С”РЎР‚РЎС“Р С—Р Р…РЎвЂ№РЎвЂ¦ Р С‘Р В·Р СР ВµР Р…Р ВµР Р…Р С‘Р в„– РЎРѓР Р…Р В°РЎвЂЎР В°Р В»Р В° Р С•РЎвЂљР С”РЎР‚Р С•Р в„–РЎвЂљР Вµ issue Р Т‘Р В»РЎРЏ Р С•Р В±РЎРѓРЎС“Р В¶Р Т‘Р ВµР Р…Р С‘РЎРЏ.

---

**Р РЋР Т‘Р ВµР В»Р В°Р Р…Р С• РЎРѓ РІСњВ¤РїС‘РЏ Р Т‘Р В»РЎРЏ Р Р†Р С‘Р Р…Р Р…Р С•Р в„– Р С‘Р Р…Р Т‘РЎС“РЎРѓРЎвЂљРЎР‚Р С‘Р С‘** СЂСџРЊВ·

**Р вЂ™Р ВµРЎР‚РЎРѓР С‘РЎРЏ:** 0.4.0 | **Р вЂќР В°РЎвЂљР В°:** 28 Р С•Р С”РЎвЂљРЎРЏР В±РЎР‚РЎРЏ 2025 | **Р РЋР С—РЎР‚Р С‘Р Р…РЎвЂљ:** 3 (Security & Rate Limiting)
