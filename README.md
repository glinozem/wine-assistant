# üç∑ Wine Assistant

[![CI](https://github.com/glinozem/wine-assistant/workflows/CI/badge.svg)](https://github.com/glinozem/wine-assistant/actions)
[![Tests](https://github.com/glinozem/wine-assistant/workflows/Tests/badge.svg)](https://github.com/glinozem/wine-assistant/actions)
[![Release Drafter](https://github.com/glinozem/wine-assistant/workflows/Release%20Drafter/badge.svg)](https://github.com/glinozem/wine-assistant/actions)
[![Coverage](https://img.shields.io/badge/coverage-60.64%25-green.svg)](https://github.com/glinozem/wine-assistant)
[![Version](https://img.shields.io/badge/version-0.5.0-blue.svg)](https://github.com/glinozem/wine-assistant/releases)
[![Python](https://img.shields.io/badge/python-3.11+-brightgreen.svg)](https://www.python.org/)
[![Docker](https://img.shields.io/badge/docker-compose-blue.svg)](https://docs.docker.com/compose/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

> **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω–∞–º–∏ –Ω–∞ –≤–∏–Ω–æ**
>
> Production‚Äëready Flask API + PostgreSQL (pg_trgm, *–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ* pgvector) —Å –±–∏—Ç–µ–º–ø–æ—Ä–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é –¥–∞–Ω–Ω—ã—Ö, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º ETL, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** 0.5.0 (–°–ø—Ä–∏–Ω—Ç 4a ‚Äî ETL Automation & Data Quality)
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 7 –Ω–æ—è–±—Ä—è 2025

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ß—Ç–æ –Ω–æ–≤–æ–≥–æ](#-—á—Ç–æ-–Ω–æ–≤–æ–≥–æ-–≤-v050)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ETL](#-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π-etl-–∏–º–ø–æ—Ä—Ç)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API](#-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-api)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [Mini: –∫–∞–∫ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –ë–î –≤ CI](#-mini-–∫–∞–∫-–ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è-–±–¥-–≤-ci-github-actions)
- [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
- [–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞](#-–¥–æ—Ä–æ–∂–Ω–∞—è-–∫–∞—Ä—Ç–∞)
- [–£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ](#-—É—á–∞—Å—Ç–∏–µ-–≤-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- üì¶ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º –≤–∏–Ω** ‚Äî –¢–æ–≤–∞—Ä—ã, —Ü–µ–Ω—ã, –æ—Å—Ç–∞—Ç–∫–∏ —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π.
- üìà **–ë–∏—Ç–µ–º–ø–æ—Ä–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ ¬´—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π¬ª –¥–∞—Ç—ã –∏ ¬´—Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ¬ª –≤—Ä–µ–º–µ–Ω–∏.
- üîç **–ü–æ–∏—Å–∫** ‚Äî –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å pg_trgm + —Ñ–∏–ª—å—Ç—Ä—ã.
- üí∞ **–î–≤–æ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω** ‚Äî –ë–∞–∑–æ–≤–∞—è (`price_list_rub`) –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è (`price_final_rub`) —Ü–µ–Ω–∞; –≥–∏–±–∫–∞—è –ª–æ–≥–∏–∫–∞ —Å–∫–∏–¥–æ–∫.
- üìä **–ò—Å—Ç–æ—Ä–∏—è** ‚Äî –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω –∏ –æ—Å—Ç–∞—Ç–∫–æ–≤.
- üì• **ETL-–∫–æ–Ω–≤–µ–π–µ—Ä** ‚Äî –ê–≤—Ç–æ–∏–º–ø–æ—Ä—Ç Excel/CSV —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –∏ –¥–∞—Ç.

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ETL (–ù–û–í–û–ï! v0.5.0)
- ü§ñ **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** ‚Äî –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç (–ü–Ω‚Äì–ü—Ç 12:10 MSK).
- üîê **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî SHA256 fingerprinting; —Ç–∞–±–ª–∏—Ü–∞ `dw_files`.
- üìÖ **–ê–≤—Ç–æ–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã** ‚Äî –ò–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ Excel (—Å—Ç—Ä–æ–∫–∏ 2‚Äì8).
- üìÅ **–ê—Ä—Ö–∏–≤** ‚Äî –£—Å–ø–µ—à–Ω—ã–µ —Ñ–∞–π–ª—ã ‚Üí `data/archive/YYYY-MM-DD/`.
- üìù **–õ–æ–≥–∏** ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON‚Äë–ª–æ–≥–∏ –≤ `logs/import.log`.

### –î–ª—è production
- üõ°Ô∏è **Rate limiting** (Flask‚ÄëLimiter), CORS, API‚ÄëKey.
- üè• **Health** ‚Äî `/live`, `/ready`, `/version`.
- üê≥ **Docker Compose** ‚Äî –°–µ—Ä–≤–∏—Å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ healthchecks.
- üß™ **–¢–µ—Å—Ç—ã** ‚Äî pytest, –ø–æ–∫—Ä—ã—Ç–∏–µ (–Ω–∞ CI: **60.64%**).

---

## üéâ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v0.5.0

### Sprint 4a: ETL Automation & Data Quality ‚ú®

- **ETL –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –ü–Ω‚Äì–ü—Ç 12:10 MSK).
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–æ–∫** —á–µ—Ä–µ–∑ SHA256 –∏ —Ç–∞–±–ª–∏—Ü—É `dw_files`.
- **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `price_date`** –∏–∑ —Ñ–∞–π–ª–∞/Excel‚Äë—à–∞–ø–∫–∏ + fallback.
- **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ** —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏.

#### CI‚Äë—É–ª—É—á—à–µ–Ω–∏—è (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **CI: PostgreSQL 14 –Ω–∞ `localhost:15432` + readiness‚Äë–ø—Ä–æ–±–∞.**
- **CI: –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º** (`tests/fixtures/schema.sql` + `tests/fixtures/schema_prices.sql`, –≤–∫–ª—é—á–∞—è `CREATE EXTENSION IF NOT EXISTS pgcrypto;`).
- **–¢–µ—Å—Ç—ã:** —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è `upsert_records()` –≤ CI (—Ñ–∏–∫—Å–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ö–µ–º –∏ –ø—Ä–æ–≥—Ä–µ–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è).

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         Wine Assistant                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ETL (Excel/CSV, SHA256, Scheduler)  ‚Üí  Flask API  ‚Üí PostgreSQL  ‚îÇ
‚îÇ  ‚Ä¢ Auto-date ‚Ä¢ Archive ‚Ä¢ Logs         ‚Ä¢ Swagger ‚Ä¢ Limits ‚Ä¢ Auth  ‚îÇ
‚îÇ  ‚Ä¢ Idempotency ‚Ä¢ Validation           ‚Ä¢ Health ‚Ä¢ JSON‚Äëlogging    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| Backend | Flask 3.0 | REST API |
| –ë–î | PostgreSQL 16 (–ª–æ–∫–∞–ª—å–Ω–æ), **PostgreSQL 14 (CI)** | –•—Ä–∞–Ω–∏–ª–∏—â–µ |
| –ü–æ–∏—Å–∫ | pg_trgm | Full‚Äëtext –ø–æ —Å—Ö–æ–¥—Å—Ç–≤—É |
| Auth | API‚ÄëKey | –ü—Ä–æ—Å—Ç–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| –õ–∏–º–∏—Ç—ã | Flask‚ÄëLimiter | –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π |
| –õ–æ–≥–∏ | python‚Äëjson‚Äëlogger | JSON‚Äë–ª–æ–≥–∏ |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | Flasgger / OpenAPI | Swagger UI `/docs` |
| ETL | pandas + openpyxl | –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã | Docker Compose | –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ |
| CI | GitHub Actions | –¢–µ—Å—Ç—ã, —Ä–µ–ª–∏–∑—ã |

> ‚ÑπÔ∏è –í –ª–æ–∫–∞–ª—å–Ω–æ–º Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—Ä–∞–∑ `pgvector/pgvector:pg16` (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞), –≤ CI ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `postgres:14` —Ä–∞–¥–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
git clone https://github.com/glinozem/wine-assistant.git
cd wine-assistant

# –ó–∞–ø—É—Å–∫ PostgreSQL + API + Adminer
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose ps
curl http://localhost:18000/health
```

**–ü–æ—Ä—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- üóÑ PostgreSQL: `localhost:15432` (user: `postgres`, pass: `dev_local_pw`, db: `wine_db`)
- üåê API: `http://localhost:18000`
- üõ† Adminer: `http://localhost:18080`

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `.env`

```env
PGHOST=127.0.0.1
PGPORT=15432
PGUSER=postgres
PGPASSWORD=dev_local_pw
PGDATABASE=wine_db

API_KEY=your-secret-api-key-minimum-32-chars
FLASK_HOST=127.0.0.1
FLASK_PORT=18000
FLASK_DEBUG=0
APP_VERSION=0.5.0

CORS_ORIGINS=*
LOG_LEVEL=INFO
RATE_LIMIT_ENABLED=1
RATE_LIMIT_PUBLIC=100/hour
RATE_LIMIT_PROTECTED=1000/hour
```

---

## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ETL (–∏–º–ø–æ—Ä—Ç)

–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–¥–µ–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ README: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `data/inbox` ‚Üí `data/archive`, –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞ (`jobs/ingest_dw_price.py`, `scripts/load_csv.py`), –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `dw_files`, –ª–æ–≥–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.

–°–º. –ø—Ä–∏–º–µ—Ä—ã CLI:
```bash
# –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞—Ç—ã (–∏–∑ —Ñ–∞–π–ª–∞/—à–∞–ø–∫–∏ Excel)
python scripts/load_csv.py --excel "data/inbox/Price_2025_01_20.xlsx"

# –Ø–≤–Ω–∞—è –¥–∞—Ç–∞ –∏ —Å–∫–∏–¥–∫–∞ –∏–∑ —è—á–µ–π–∫–∏
python scripts/load_csv.py --excel "Price.xlsx" --asof 2025-01-20 --discount-cell S5

# CSV
python scripts/load_csv.py --csv "products.csv" --asof 2025-01-20
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

- **Swagger UI:** `http://localhost:18000/docs`
- **Health:** `/health`, `/live`, `/ready`
- **–ü–æ–∏—Å–∫:** `/search`
- **SKU:** `/sku/{code}`, `/sku/{code}/price_history`

> –î–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key`.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–º. `.env.example` –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `.env` –≤—ã—à–µ. –í Docker Compose —Å–µ—Ä–≤–∏—Å API –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–¥–æ—Ä–æ–≤—å—è –ë–î; –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–π (—Å–º. —Ä–∞–∑–¥–µ–ª ¬´–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞¬ª).

---

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
python -m venv .venv
# Windows:
.\.venv\Scripts\Activate.ps1
# Linux/macOS:
source .venv/bin/activate

pip install -r requirements.txt
pre-commit install

# –ë–∞–∑–∞ –≤ Docker
docker compose up -d db

# (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–∏–≥—Ä–∞—Ü–∏–∏/–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
powershell -ExecutionPolicy Bypass -File .\scripts\migrate.ps1

# –ó–∞–ø—É—Å–∫ API
python -m api.main
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –ü–æ–∫—Ä—ã—Ç–∏–µ
pytest --cov=api --cov=scripts --cov=etl --cov-report=term --cov-report=html
# HTML –æ—Ç—á—ë—Ç –±—É–¥–µ—Ç –≤ htmlcov/index.html
```

> –ù–∞ CI —Ç–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: **60.64%**.

---

## üß© Mini: –∫–∞–∫ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –ë–î –≤ CI (GitHub Actions)

> –ö–æ—Ä–æ—Ç–∫–∏–π —Ä–∞–∑—Ä–µ–∑ —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç `test.yml`, —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –Ω–µ –∑–∞–≤–∏—Å–µ–ª–∏ –æ—Ç –≤–Ω–µ—à–Ω–µ–π –ë–î –∏ –±—ã–ª–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã.

**1) Service: PostgreSQL 14 –Ω–∞ `localhost:15432`**
–í `services:` –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `postgres:14` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
```yaml
services:
  postgres:
    image: postgres:14
    env:
      POSTGRES_DB: wine_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: dev_local_pw
    ports:
      - 15432:5432
    options: >-
      --health-cmd="pg_isready -U postgres -d wine_db"
      --health-interval=10s
      --health-timeout=5s
      --health-retries=10
```
*–ü–æ—á–µ–º—É 14?* –ë—ã—Å—Ç—Ä–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–∞ GitHub‚Äë—Ä–∞–Ω–Ω–µ—Ä–µ; –ª–æ–∫–∞–ª—å–Ω–æ –æ—Å—Ç–∞—ë—Ç—Å—è 16 —Å pgvector.

**2) Readiness‚Äë–æ–∂–∏–¥–∞–Ω–∏–µ**
–®–∞–≥ workflow –æ–∂–∏–¥–∞–µ—Ç, –ø–æ–∫–∞ `pg_isready` –≤–µ—Ä–Ω—ë—Ç ¬´–Ω–∞–ª–∏—á–∏–µ¬ª:
```bash
for i in {1..30}; do
  pg_isready -h localhost -p 15432 -U postgres -d wine_db && break
  sleep 2
done
```

**3) –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º**
–°—Ö–µ–º—ã –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–¥–æ** –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:
```bash
# –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–∞ –±—É–¥—É—â–µ–µ (UUID –∏ –ø—Ä.)
psql "postgresql://postgres:dev_local_pw@localhost:15432/wine_db" \
  -c "CREATE EXTENSION IF NOT EXISTS pgcrypto;"

# –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å/—Ñ–∞–π–ª—ã/–∫–æ–Ω–≤–µ—Ä—Ç—ã
psql "postgresql://postgres:dev_local_pw@localhost:15432/wine_db" \
  -f tests/fixtures/schema.sql

# –ü—Ä–æ–¥—É–∫—Ç—ã / –æ—Å—Ç–∞—Ç–∫–∏ / –∏—Å—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ü–µ–Ω
psql "postgresql://postgres:dev_local_pw@localhost:15432/wine_db" \
  -f tests/fixtures/schema_prices.sql
```

**4) –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤**
```bash
export PGHOST=localhost
export PGPORT=15432
export PGUSER=postgres
export PGPASSWORD=dev_local_pw
export PGDATABASE=wine_db
```

**5) –ó–∞–ø—É—Å–∫ pytest —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º**
```bash
pytest -v --cov=api --cov=scripts --cov=etl --cov-report=xml --cov-report=term
```

> ‚úÖ –ò—Ç–æ–≥: —Ç–µ—Å—Ç `test_upsert_records_insert_and_update` –±–æ–ª—å—à–µ –Ω–µ –ø–∞–¥–∞–µ—Ç –∏–∑‚Äë–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü; –∫–æ–Ω–Ω–µ–∫—Ç —Å—Ç–∞–±–∏–ª–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ –ë–î –≥–æ—Ç–æ–≤–∞ –¥–æ —Å—Ç–∞—Ä—Ç–∞ pytest.

**–õ–æ–∫–∞–ª—å–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å CI‚Äë—Å—Ä–µ–¥—É**
```bash
# –ü–æ–¥–Ω—è—Ç—å Postgres 14 –Ω–∞ 15432 (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å 16)
docker run -it --rm -e POSTGRES_PASSWORD=dev_local_pw -e POSTGRES_DB=wine_db \
  -p 15432:5432 postgres:14

# –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—ã
psql "postgresql://postgres:dev_local_pw@localhost:15432/wine_db" -c "CREATE EXTENSION IF NOT EXISTS pgcrypto;"
psql "postgresql://postgres:dev_local_pw@localhost:15432/wine_db" -f tests/fixtures/schema.sql
psql "postgresql://postgres:dev_local_pw@localhost:15432/wine_db" -f tests/fixtures/schema_prices.sql

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest -q
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

**Production checklist (–∫—Ä–∞—Ç–∫–æ):** HTTPS, –Ω–∞–¥—ë–∂–Ω—ã–π `API_KEY`, CORS, —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î, –∞–ª–µ—Ä—Ç—ã, –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–ª–µ–∂–µ–Ω–∏–µ –∑–∞ `/ready`, —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

**Reverse proxy (nginx) –ø—Ä–∏–º–µ—Ä:**
```nginx
location / {
  proxy_pass http://localhost:18000;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

- **Structured logging (JSON)** ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è ELK/Loki/Datadog.
- **Health‚Äë—Å–∫—Ä–∏–ø—Ç—ã** ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `/ready`.
- **DB‚Äë–º–µ—Ç—Ä–∏–∫–∏** ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏, —Ä–∞–∑–º–µ—Ä –ë–î, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

- **401** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `X-API-Key` –∏ –∑–Ω–∞—á–µ–Ω–∏–µ `API_KEY` –≤ `.env`.
- **429** ‚Äî –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç—ã (–∑–∞–≥–æ–ª–æ–≤–∫–∏ `X-RateLimit-*` –ø–æ–¥—Å–∫–∞–∂—É—Ç –¥–µ—Ç–∞–ª–∏).
- **503 –Ω–∞ /ready** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ –ë–î –∏ –Ω–∞–ª–∏—á–∏–µ —Å—Ö–µ–º/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.
- **ETL** ‚Äî –∑–∞–≥–ª—è–Ω–∏—Ç–µ –≤ `logs/import.log`, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç/–∫–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–æ–≤.

---

## üó∫Ô∏è –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

- –°–ø—Ä–∏–Ω—Ç 4b ‚Äî –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/–∫–∞—á–µ—Å—Ç–≤–æ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ E2E —Ç–µ—Å—Ç—ã).
- –°–ø—Ä–∏–Ω—Ç 5 ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π), Telegram‚Äë–±–æ—Ç, —ç–∫—Å–ø–æ—Ä—Ç.
- –°–ø—Ä–∏–Ω—Ç 6+ ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Email/Telegram), –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, multi‚Äëtenant.

---

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

- Conventional Commits, pre‚Äëcommit hooks, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã.
- PR‚Äë—à–∞–±–ª–æ–Ω—ã –∏ Release Drafter ‚Äî —Ä–µ–ª–∏–∑–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ MIT ‚Äî —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE).

---

<div align="center">

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –≤–∏–Ω–Ω–æ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ üç∑**

</div>
