# Rename to .env and fill your secrets

# =============================
# App / Versioning
# =============================
APP_VERSION=0.4.0
PORT=8000

# =============================
# API security & CORS
# =============================
# Сгенерируй ключ:
#   python -c "import secrets; print(secrets.token_urlsafe(32))"
# Используется приложением и интеграционными тестами
# для доступа к защищённым эндпоинтам.
# В продакшене значение должно быть сгенерировано и храниться безопасно.
API_KEY=dev-local-api-key

# Базовый URL API для интеграционных тестов.
# По умолчанию API в docker-compose слушает на http://localhost:18000
API_URL=http://localhost:18000
API_BASE_URL=http://localhost:18000

# --- Tests ---
# По умолчанию интеграционные тесты с БД выключены.
# Включай их через переменную окружения RUN_DB_TESTS=1 в текущей сессии:
#   export RUN_DB_TESTS=1
# или в PowerShell:
#   $env:RUN_DB_TESTS = "1"
RUN_DB_TESTS=0

# Разрешённые источники фронта
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# =============================
# Rate limiting
# =============================
RATE_LIMIT_ENABLED=1
RATE_LIMIT_PUBLIC=100/hour
RATE_LIMIT_PROTECTED=1000/hour
RATE_LIMIT_STORAGE_URL=memory://
# Для продакшна:
# RATE_LIMIT_STORAGE_URL=redis://redis:6379/0

# =============================
# Logging
# =============================
LOG_LEVEL=INFO

# =============================
# Timezone
# =============================
TZ=Europe/Moscow

# =============================
# Database
# =============================
# Эти настройки используются ЛОКАЛЬНЫМ кодом и тестами
# для подключения к БД, поднятой docker-compose на localhost:15432.
# Внутри Docker контейнеры используют db:5432 (см. docker-compose.yml).
DB_HOST=localhost
DB_PORT=15432
DB_NAME=wine_db
DB_USER=postgres
DB_PASSWORD=postgres

# PG* нужны утилитам psql, скриптам миграций и части тестов.
PGHOST=${DB_HOST}
PGPORT=${DB_PORT}
PGUSER=${DB_USER}
PGPASSWORD=${DB_PASSWORD}
PGDATABASE=${DB_NAME}

# Только для первого старта нового тома (используется postgres-образом):
POSTGRES_DB=wine_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

# =============================
# ETL / price-import flags
# =============================
# Если установить в 1/true/True — при расчёте цены будет
# приоритет скидки из ячейки S5 (если она есть).
PREFER_S5=0

# Переопределение даты прайса (YYYY-MM-DD), используется
# в основном в тестах/отладке. Пустое значение = авто-определение.
PRICE_DATE_OVERRIDE=

# =============================
# Gunicorn
# =============================
GUNICORN_WORKERS=2
GUNICORN_THREADS=2
GUNICORN_TIMEOUT=60

# === Wine images (optional) ===
WINE_IMAGE_DIR=static/images
WINE_IMAGE_BASE_URL=https://static.example.com/wines

# Image index cache TTL (seconds): 0 = disabled (rebuild only on image dir mtime change)
# Useful for network shares / FS where dir mtime may not update reliably.
WINE_IMAGE_INDEX_TTL_SECONDS=0
# Example for “once per day” updates:
# WINE_IMAGE_INDEX_TTL_SECONDS=86400
